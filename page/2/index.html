<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="I Never Save Anything For The Swim Back.">
<meta property="og:type" content="website">
<meta property="og:title" content="å½¼å¾—çš„åšå®¢">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="å½¼å¾—çš„åšå®¢">
<meta property="og:description" content="I Never Save Anything For The Swim Back.">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="å½¼å¾—çš„åšå®¢">
<meta name="twitter:description" content="I Never Save Anything For The Swim Back.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>å½¼å¾—çš„åšå®¢</title>
  <link rel="stylesheet" type="text/css" href="/css/prettify.css">
  <link rel="stylesheet" type="text/css" href="/css/github.css">
  <link rel="stylesheet" type="text/css" href="/css/github.min.css">
  <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "all" } } }); </script>
       <script type="text/x-mathjax-config">
         MathJax.Hub.Config({
           tex2jax: {
             inlineMath: [ ['$','$'], ["\\(","\\)"] ],
             processEscapes: true
           }
         });
       </script>
       <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">å½¼å¾—çš„åšå®¢</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/26/Support-Vector-Machine/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Peter Tsung">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/pandas.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å½¼å¾—çš„åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/26/Support-Vector-Machine/" itemprop="url">
                  Support Vector Machine
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-12-26T22:25:51+08:00">
                2017-12-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Machine-Learning/" itemprop="url" rel="index">
                    <span itemprop="name">Machine Learning</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è¿™ä¸ªç®—æ³•ä¸€ç›´å›°æ‰°ç€æˆ‘ï¼Œè™½ç„¶æˆ‘æ²¡æœ‰åœ¨å®é™…ä¸­ä½¿ç”¨è¿‡å®ƒï¼Œä½†æ˜¯æˆ‘æ—©å·²å¬é—»å®ƒçš„å¼ºå¤§ä¹‹å¤„ã€‚ä½†å› ä¸ºé‡Œé¢å……æ»¡ç€å„ç§æ•°å­¦æ¨å¯¼ï¼Œä¸èŠ±ä¸€äº›æ—¶é—´å»ç ”ç©¶å®åœ¨æ˜¯æ— æ³•æ¶ˆåŒ–ã€‚ä½†æ˜¯ï¼Œè§£å†³ææƒ§çš„æœ€å¥½æ–¹æ³•å°±æ˜¯ç›´é¢å®ƒã€‚æˆ‘ä¸€ç›´éƒ½åœ¨çœ‹å„ç§ç›¸å…³ä¹¦ç±ï¼Œä»¥åŠYoutubeä¸Šå„ç§SVMçš„è§†é¢‘ï¼Œå¯è°“æ˜¯å—å°½å„ç§ç…ç†¬ï¼Œå½“ä¸­å¯èƒ½ä¼šå› ä¸ºçœ‹ä¸æ‡‚é‡Œé¢æŸä¸ªå…¬å¼è€Œåç«‹ä¸å®‰ï¼Œç„¶ååˆæ‰¾ä¸åˆ°äººå¯ä»¥æ²Ÿé€šè¯·æ•™ã€‚æ‰€ä»¥åŸºæœ¬ä¸Šè¿™ä¸ª<code>SVM</code>ç®—æ³•æ•´å¤©éƒ½åœ¨æˆ‘çš„è„‘è¢‹é‡Œé¢æŒ¥ä¹‹ä¸å»ï¼Œç„¶ååˆæ²¡åŠæ³•å®Œå…¨ç†æ¸…æ¥šæ¯ä¸€ä¸ªç»†èŠ‚ï¼Œè¿™æ ·å¯¼è‡´æˆ‘æ²¡åŠæ³•ç”¨ä»£ç å¤å†™ä¸€éã€‚æ•´ä¸ªäººéå¸¸ç—›è‹¦ã€‚ä½†ç°åœ¨ï¼Œæˆ‘ç»ˆäºå¯ä»¥æ¥å†™è¿™ä¸ª<code>SVM</code>åˆ†äº«æ–‡ç« äº†ã€‚</p>
<p><code>Support Vector Machine(SVM)</code>ï¼Œä¸­æ–‡æ˜¯æ”¯æŒå‘é‡æœºï¼Œæ˜¯ä¸€ç§äºŒåˆ†ç±»æ¨¡å‹ã€‚å®ƒçš„åŸºæœ¬æ¨¡å‹æ˜¯å®šä¹‰åœ¨ç‰¹å¾ç©ºé—´ä¸Šçš„é—´éš”æœ€å¤§çš„çº¿æ€§åˆ†ç±»å™¨ã€‚ä¸ºä»€ä¹ˆè¦å¼ºè°ƒ<code>é—´éš”æœ€å¤§</code>ï¼Ÿ æ˜¯å› ä¸ºèƒ½å¤Ÿå°†è®­ç»ƒæ ·æœ¬æ­£ç¡®åˆ†å¼€çš„åˆ’åˆ†è¶…å¹³é¢å¯èƒ½æœ‰å¾ˆå¤šï¼Œä½†æ˜¯å¦‚ä½•è¡¡é‡å“ªä¸€ä¸ªæ˜¯æœ€å¥½ï¼Ÿ<code>é—´éš”æœ€å¤§</code>è¿™ä¸€ç‰¹æ€§ä½¿<code>SVM</code>æœ‰åˆ«äº<code>æ„ŸçŸ¥æœº</code>ï¼Œå› ä¸º<code>é—´éš”æœ€å¤§</code>å¯ä»¥ä½¿å¯¹æœªè§ç¤ºä¾‹çš„æ³›åŒ–èƒ½åŠ›æœ€å¼ºï¼Œè€Œä¸”ä¿è¯å¯¹è®­ç»ƒæ ·æœ¬å±€éƒ¨æ‰°åŠ¨çš„â€œå®¹å¿â€æ€§æœ€å¥½ã€‚<img src="/images/Screen%20Shot%202017-12-27%20at%205.30.54%20PM.png" alt="Screen Shot 2017-12-27 at 5.30.54 PM"></p>
<p>æ”¯æŒå‘é‡æœºä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»<code>çº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœºä¸ç¡¬é—´éš”æœ€å¤§åŒ–</code>ã€<code>çº¿æ€§æ”¯æŒå‘é‡æœºä¸è½¯é—´éš”æœ€å¤§åŒ–</code>ä»¥åŠ<code>éçº¿å½¢æ”¯æŒå‘é‡æœºä¸æ ¸å‡½æ•°</code>ã€‚æˆ‘ä¸€å¼€å§‹çœ‹è¿™ä¸‰ä¸ªç±»åˆ«çš„æ—¶å€™ï¼Œæˆ‘å¿ƒé‡Œç®€ç›´å°±æ˜¯æƒ³çˆ†ç²—ã€‚ä¸çŸ¥é“è¯»è€…ä½ ä»¬æœ‰æ²¡æœ‰ç±»ä¼¼çš„æ„Ÿå—ï¼Œå¦‚æœä½ ä»¬æ²¡æœ‰ï¼Œé‚£ä¹ˆä¸‹æ–‡ä½ ä»¬å°±ä¸éœ€è¦çœ‹äº†ã€‚å¯¹äºè·Ÿæˆ‘ä¸€æ ·æ„Ÿå—çš„è¯»è€…ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹åˆ°åº•è¿™ä¸‰ç±»æ”¯æŒå‘é‡æœºåˆ°åº•åœ¨æäº›ä»€ä¹ˆæ¯›çº¿ã€‚</p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æˆ‘ä»¬ç›®å‰æœ‰ä»€ä¹ˆã€‚</p>
<p>åœ¨æ ·æœ¬ç©ºé—´ä¸­ï¼Œåˆ’åˆ†è¶…å¹³é¢å¯ä»¥é€šè¿‡ä»¥ä¸‹çº¿æ€§æ–¹ç¨‹æ¥æè¿°ï¼š <span class="math display">\[
\mathbf{w}^{T}\mathbf{x} + b = 0
\]</span> å…¶ä¸­ï¼Œ <code>w=(w1; w2; ...; wd)</code>ä¸ºæ³•å‘é‡ï¼Œå†³å®šäº†è¶…å¹³é¢çš„æ–¹å‘ï¼›<code>b</code>ä¸ºä½ç§»é¡¹ï¼Œå†³å®šäº†è¶…å¹³é¢ä¸åŸç‚¹ä¹‹é—´çš„è·ç¦»ã€‚ç„¶åæ ·æœ¬ç©ºé—´ä¸­ä»»æ„ç‚¹<code>x</code>åˆ°è¶…å¹³é¢<code>(w, b)</code>çš„è·ç¦»å¯å†™ä¸ºï¼š <span class="math display">\[
r = \frac {|\mathbf{w}^{T}\mathbf{x} + b|}{||\mathbf{w}||}
\]</span> å‡è®¾è¶…å¹³é¢èƒ½å¤Ÿæ­£ç¡®å°†è®­ç»ƒæ ·æœ¬åˆ†ç±»ï¼Œåˆ™æœ‰ï¼š <span class="math display">\[
\left\{ 
\begin{array}{c}
\mathbf{w}^{T}\mathbf{x} + b \ge +1, \ \ \ y_i=+1. \\ 
\mathbf{w}^{T}\mathbf{x} + b \le -1 \ \ \ y_i=-1.\\ 
\end{array}
\right.
\]</span> ç­‰ä»·äº <span class="math display">\[
y_i\cdot(\mathbf{w}^{T}\mathbf{x} + b) \ge +1
\]</span> è·ç¦»è¶…å¹³é¢æœ€è¿‘çš„å‡ ä¸ªè®­ç»ƒæ ·æœ¬èƒ½å¤Ÿä½¿ç­‰å·æˆç«‹ï¼Œå®ƒä»¬è¢«ç§°ä¸ºâ€œæ”¯æŒå‘é‡<code>(Support Vector)</code>â€ï¼Œä¸¤ä¸ªå¼‚ç±»æ”¯æŒå‘é‡è·ç¦»è¶…å¹³é¢çš„è·ç¦»ä¹‹å’Œä¸ºï¼š <span class="math display">\[
\gamma= \frac{2}{||\mathbf{w}||}
\]</span></p>
<h3 id="ä¸€çº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœºä¸ç¡¬é—´éš”æœ€å¤§åŒ–">ä¸€ã€<u>çº¿æ€§å¯åˆ†</u>æ”¯æŒå‘é‡æœºä¸ç¡¬é—´éš”æœ€å¤§åŒ–</h3>
<p>å¯¹äºçº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœºï¼Œæœ‰ä¸€ä¸ªå¾ˆå¥½çš„é¢„æœŸå°±æ˜¯è®­ç»ƒæ•°æ®çš„åˆ†å¸ƒæ²¡æœ‰ä»»ä½•å†²çªæˆ–è€…æ··æ‚ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªè®­ç»ƒæ•°æ®é›†æ˜¯çº¿æ€§å¯åˆ†ã€‚æˆ‘ä»¬éœ€è¦æ‰¾å‡ºèƒ½å¤Ÿå°†ä¸¤ç±»æ•°æ®æ­£ç¡®åˆ’åˆ†å¹¶ä¸”é—´éš”æœ€å¤§çš„ç›´çº¿ã€‚<img src="/images/Screen%20Shot%202017-12-27%20at%2010.05.16%20PM.png" alt="Screen Shot 2017-12-27 at 10.05.16 PM"></p>
<p>æ„é€ å¹¶æ±‚è§£çº¦æŸæœ€ä¼˜åŒ–é—®é¢˜ï¼š <span class="math display">\[
\begin{aligned}
&amp; \mathop{min}_{w, b} \ \ \  \frac{1}{2}||w||^2 \\
\\
&amp; s.t. \ \ \  y_i\cdot(\mathbf{w}^{T}\mathbf{x} + b) - 1\ge 0
\end{aligned}
\]</span> ç„¶åæ„å»ºæ‹‰æ ¼æœ—æ—¥å‡½æ•°: <span class="math display">\[
L(w, b, \alpha) = \frac{1}{2}||w||^2 - \sum_{i=1} ^{N} \alpha_i\cdot((\mathbf{w}^{T}\mathbf{x} + b) - 1)
\]</span> å› æ­¤ï¼Œé—®é¢˜å˜æˆæå¤§æå°é—®é¢˜ï¼š <span class="math display">\[
\mathop{max}_\alpha\mathop{min}_{w, b} L(w, b, \alpha)
\]</span> ï¼ˆ1ï¼‰æ±‚<code>min_{w, b}L(w, b, a)</code> <span class="math display">\[
\begin{aligned}
\frac {\partial L}{\partial w} &amp; = w - \sum_{i}^{N}\alpha_iy_ix_i = 0 \\
\\ 
\frac {\partial L}{\partial b} &amp; = \sum_{i}^{N}\alpha_iy_i = 0
\end{aligned}
\]</span> å¾— <span class="math display">\[
\begin{aligned}
 &amp; w  =  \sum_{i}^{N}\alpha_iy_ix_i  \\
 \\
&amp; \sum_{i}^{N}\alpha_iy_i  = 0
\end{aligned}
\]</span> æ‰€ä»¥å°†è¿™ä¸¤ä¸ªå¼å­ä»£å…¥<code>L(w, b, a)</code>å¾—ï¼š <span class="math display">\[
\mathop{min}_{w, b} L(w, b, \alpha) = \sum_{i=1}^{N}\alpha_i - \frac {1}{2}\sum_{i=1}^{N}\sum_{j=1}^{N}\alpha_i\alpha_jy_iy_j(x_i \cdot x_j)
\]</span> ï¼ˆ2ï¼‰æ±‚<code>min_{w, b} L(w, b, a)å¯¹açš„æå¤§</code>ï¼š <span class="math display">\[
\mathop{max}_{\alpha}  L(w, b, \alpha) = \sum_{i=1}^{N}\alpha_i - \frac {1}{2}\sum_{i=1}^{N}\sum_{j=1}^{N}\alpha_i\alpha_jy_iy_j(x_i \cdot x_j)
\]</span> è¿™ä¸ªé—®é¢˜çš„å¯¹å¶é—®é¢˜æ˜¯ï¼š <span class="math display">\[
\begin{aligned}
&amp; \mathop{min}_{\alpha} \ \ \ L(w, b, \alpha) =\frac {1}{2}\sum_{i=1}^{N}\sum_{j=1}^{N}\alpha_i\alpha_jy_iy_j(x_i \cdot x_j) -  \sum_{i=1}^{N}\alpha_i \\
&amp; s.t \ \ \  \sum_{i=1}^{N}\alpha_iy_i = 0 \\
\\ 
&amp; \ \ \ \ \ \ \ \ \ \alpha_i \ge 0 \\
\\
&amp; \ \ \ \ \ \ \ \ \ y_i\cdot(\mathbf{w}^{T}\mathbf{x} + b) - 1\ge 0 \\
\\ 
&amp; \ \ \ \ \ \ \ \ \ \alpha_i(y_i\cdot(\mathbf{w}^{T}\mathbf{x} + b) - 1) = 0
\end{aligned}
\]</span> æ±‚å¾—æœ€ä¼˜è§£<code>a*=(a1*, a2*, ..., aN*)^T</code></p>
<p>ï¼ˆ3ï¼‰è®¡ç®— <span class="math display">\[
w^{*} = \sum_{i=1}^{N}\alpha_iy_ix_i
\]</span> å¹¶é€‰æ‹©<code>a*</code>çš„ä¸€ä¸ªæ­£åˆ†é‡<code>aj*&gt;0</code>ï¼Œè®¡ç®—å¾— <span class="math display">\[
b^{*} = y_j - \sum_{i=1}^{N}\alpha_{j}^{*}y_i(x_i \cdot x_j)
\]</span> ï¼ˆ4ï¼‰æ±‚å¾—åˆ†ç¦»è¶…å¹³é¢ <span class="math display">\[
w^{*} \cdot x + b^{*} = 0
\]</span> ï¼ˆ5ï¼‰åˆ†ç±»å†³ç­–å‡½æ•° <span class="math display">\[
f(x) = sign(w^{*} \cdot x + b^{*})
\]</span> è§£å†³äº†ã€‚</p>
<p>åœ¨çº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœºä¸­ï¼Œ<code>w*</code>å’Œ<code>b*</code>åªä¾èµ–äºè®­ç»ƒæ•°æ®ä¸­å¯¹åº”<code>aj*&gt;0</code>çš„æ ·æœ¬ç‚¹<code>(xi, yi)</code>ï¼Œè€Œå…¶ä»–æ ·æœ¬ç‚¹å¯¹<code>w*</code>å’Œ<code>b*</code>æ²¡æœ‰å½±å“ã€‚å› æ­¤æˆ‘ä»¬æŠŠè®­ç»ƒæ•°æ®ä¸­å¯¹åº”<code>aj*&gt;0</code>çš„å®ä¾‹ç‚¹ç§°ä¸ºæ”¯æŒå‘é‡ã€‚</p>
<h3 id="äºŒçº¿æ€§æ”¯æŒå‘é‡æœºä¸è½¯é—´éš”æœ€å¤§åŒ–">äºŒã€<u>çº¿æ€§æ”¯æŒ</u>å‘é‡æœºä¸è½¯é—´éš”æœ€å¤§åŒ–</h3>
<p>ä½†æ˜¯è®­ç»ƒæ•°æ®ä¸ä¸€å®šæ€»æ˜¯çº¿æ€§å¯åˆ†ï¼Œæœ‰æ—¶å€™æŸäº›æ ·æœ¬ç‚¹ä¸ä¸€å®šæ»¡è¶³é—´éš”å¤§äºç­‰äº1å¾—çº¦æŸæ¡ä»¶ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹<code>ç¡¬é—´éš”æœ€å¤§åŒ–</code>ä¸º<code>è½¯é—´éš”æœ€å¤§åŒ–</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨æœ€å¤§åŒ–é—´éš”çš„åŒæ—¶ï¼Œä¸æ»¡è¶³çº¦æŸæ¡ä»¶çš„æ ·æœ¬åº”å°½å¯èƒ½å°‘ã€‚</p>
<p>äºæ˜¯ä¼˜åŒ–ç›®æ ‡å¯å†™ä¸º <span class="math display">\[
\mathop{min}_{w, b} \frac{1}{2}||w||^2 + C\sum_{i=1}^{m}\ell_{0/1}(y_i(\mathbf{w}^{T}\mathbf{x} + b )-1)
\]</span> å…¶ä¸­<code>C&gt;0</code>ä½¿ä¸€ä¸ªå¸¸æ•°ï¼Œ<code>ğ“0/1</code>æ˜¯â€œ0/1æŸå¤±å‡½æ•°â€ <span class="math display">\[
\ell_{0/1}{(z)}=
\begin{cases}
1,  &amp; \text{if $z$ &lt;0;} \\[2ex]
0, &amp; \text{otherwise.}
\end{cases}
\]</span> è‹¥<code>C</code>ä¸ºæ— ç©·å¤§æ—¶ï¼Œè¿™æ ·ä¼šè¿«ä½¿æ‰€æœ‰æ ·æœ¬éƒ½è¦æ»¡è¶³åŸå§‹çº¦æŸã€‚å½“<code>C</code>å–æœ‰é™å€¼æ—¶ï¼Œåˆ™å…è®¸ä¸€äº›æ ·æœ¬ä¸æ»¡è¶³çº¦æŸã€‚</p>
<p>ä½†<code>ğ“0/1</code>éå‡¸ã€éè¿ç»­ï¼Œæ•°å­¦æ€§è´¨ä¸å¤ªå¥½ï¼Œä½¿å¾—ä¸æ˜“ç›´æ¥æ±‚è§£ã€‚äºæ˜¯å¸¸ç”¨å…¶ä»–æ›¿ä»£æŸå¤±å‡½æ•°æ¥ä»£æ›¿<code>ğ“0/1</code>ã€‚å®ƒä»¬é€šå¸¸æ˜¯å‡¸çš„è¿ç»­å‡½æ•°ä¸”æ˜¯<code>ğ“0/1</code>çš„ä¸Šç•Œã€‚ <span class="math display">\[
\begin{aligned}
&amp; hinge \ \ loss: \ell_{hinge}(z) = max(0, 1-z) \\
\\
&amp; exponential \ \ loss: \ell_{exp}(z) = exp(-z) \\
\\
&amp; logistic \ \ loss: \ell_{log}(z) = log(1 + exp(-z))
\end{aligned}
\]</span> <img src="/images/Screen%20Shot%202017-12-28%20at%201.24.55%20AM.png" alt="Screen Shot 2017-12-28 at 1.24.55 AM"></p>
<p>å¼•å…¥æ¾å¼›å˜é‡<code>(slack variables)</code>ï¼Œ å¯¹æ¯ä¸ªæ ·æœ¬ç‚¹<code>(xi, yi)</code>å¼•è¿›ä¸€ä¸ªæ¾å¼›å˜é‡<code>ğœ‰i&gt;=0</code>ï¼Œä½¿å‡½æ•°é—´éš”åŠ ä¸Šæ¾å¼›å˜é‡å¤§äºç­‰äº1ã€‚è¿™æ—¶å€™ï¼Œçº¦æŸæ¡ä»¶å˜ä¸ºï¼š <span class="math display">\[
y_i(w \cdot x_i + b )  +  \xi_i \ge 1
\]</span></p>
<p>åŒæ—¶ï¼Œå¯¹æ¯ä¸ªæ¾å¼›å˜é‡<code>ğœ‰i</code>ï¼Œ æ”¯ä»˜ä¸€ä¸ªä»£ä»·<code>ğœ‰i</code>ã€‚è¿™æ—¶å€™ç›®æ ‡å‡½æ•°å˜æˆï¼š <span class="math display">\[
\frac {1}{2} ||w||^2 + C \sum_{i=1}^{N}\xi_{i}
\]</span> è¿™é‡Œï¼Œ<code>C&gt;0</code>ç§°ä¸ºæƒ©ç½šå‚æ•°ï¼Œä¸€èˆ¬ç”±åº”ç”¨é—®é¢˜å†³å®šã€‚<code>C</code>å€¼å¤§æ—¶å¯¹è¯¯åˆ†ç±»çš„æƒ©ç½šå¢å¤§ï¼ŒCå€¼å°æ—¶å¯¹è¯¯åˆ†ç±»çš„æƒ©ç½šå‡å°‘ã€‚ç›®æ ‡å‡½æ•°æœ‰ä¸¤å±‚å«ä¹‰ï¼Œç¬¬ä¸€å±‚æ˜¯å¸Œæœ›é—´éš”å°½å¯èƒ½å¤§ï¼ŒåŒæ—¶ä½¿è¯¯åˆ†ç±»ç‚¹çš„ä¸ªæ•°å°½é‡å°ï¼Œ<code>C</code>æ˜¯è°ƒå’ŒäºŒè€…çš„ç³»æ•°ã€‚</p>
<p>æ„é€ å¹¶æ±‚è§£çº¦æŸæœ€ä¼˜åŒ–é—®é¢˜ï¼š <span class="math display">\[
\begin{aligned}
&amp; \mathop{min}_{w, b, ğœ‰}\ \ \frac {1}{2} ||w||^2 + C \sum_{i=1}^{N}\xi_{i} \\
\\
&amp; s.t.  \ \ y_i(w \cdot x_i + b )  +  \xi_i \ge 1 \\
\\
&amp; \xi_i \ge 0, \ \ i=1, 2, ..., m. 
\end{aligned}
\]</span> ç„¶åæ„å»ºæ‹‰æ ¼æœ—æ—¥å‡½æ•°ï¼š <span class="math display">\[
\begin{aligned}
L(\mathbf{w}, b, \mathbf{\alpha}, \xi, \mu) = \mathop{min}_{w, b, ğœ‰}\ \ &amp; \frac {1}{2} ||w||^2 + C \sum_{i=1}^{N}\xi_{i}   \\
&amp; +\sum_{i=1}^{m}\alpha_i(1- \xi_i - (\mathbf{w}^{T}\mathbf{x} + b )-1)) - \sum_{i=1}^{m}\mu_i\xi_i
\end{aligned}
\]</span> å…¶ä¸­<code>a&gt;=0</code>ï¼Œ<code>ui&gt;=0</code>æ˜¯æ‹‰æ ¼æœ—æ—¥ä¹˜å­ã€‚</p>
<p>ï¼ˆ1ï¼‰ä»¤<code>L(w, b, a, ğœ‰, u)</code>å¯¹<code>w</code>, <code>b</code>, <code>ğœ‰</code>çš„åå¯¼ä¸ºé›¶å¯å¾—ï¼š <span class="math display">\[
\begin{aligned}
\mathbf{w} &amp; = \sum_{i=1}^{N}\alpha_iy_ix_i,  \\
\\
0 &amp;= \sum_{i=0}^{m} \alpha_iy_i \\
C &amp; = \alpha_i + \mu_i
\end{aligned}
\]</span> ï¼ˆ2ï¼‰æ±‚<code>min{w, b,  ğœ‰} L(w, b, a, ğœ‰, u)å¯¹açš„æå¤§</code>ï¼š <span class="math display">\[
\begin{aligned}
&amp; \mathop{min}_{\alpha} \ \ \ \frac {1}{2}\sum_{i=1}^{m}\sum_{j=1}^{m}\alpha_i\alpha_jy_iy_j(x_i \cdot x_j) -  \sum_{i=1}^{N}\alpha_i \\
&amp; s.t \ \ \  \sum_{i=1}^{m}\alpha_iy_i = 0\\
\\ 
&amp; \ \ \ \ \ \ \ \ \  0 \le \alpha_i \le C , \ \ \ \mu_i \ge 0, \\
\\
&amp; \ \ \ \ \ \ \ \ \ y_i\cdot(\mathbf{w}^{T}\mathbf{x} + b) - 1 + \xi_i \ge 0 \\
\\ 
&amp; \ \ \ \ \ \ \ \ \ \alpha_i(y_i\cdot(\mathbf{w}^{T}\mathbf{x} + b) - 1+ \xi_i ) = 0 \\
\\
&amp; \ \ \ \ \ \ \ \ \ \xi_i  \ge 0, \ \ \ \mu_i\xi_i = 0
\end{aligned}
\]</span> ï¼ˆ3ï¼‰è®¡ç®— <span class="math display">\[
w^{*} = \sum_{i=1}^{N}\alpha_iy_ix_i
\]</span> å¹¶é€‰æ‹©<code>a*</code>çš„ä¸€ä¸ªæ­£åˆ†é‡<code>0&lt;=aj*&lt;=C</code>ï¼Œè®¡ç®—å¾— <span class="math display">\[
b^{*} = y_j - \sum_{i=1}^{N}\alpha_{j}^{*}y_i(x_i \cdot x_j)
\]</span> ï¼ˆ4ï¼‰æ±‚å¾—åˆ†ç¦»è¶…å¹³é¢ <span class="math display">\[
w^{*} \cdot x + b^{*} = 0
\]</span> ï¼ˆ5ï¼‰åˆ†ç±»å†³ç­–å‡½æ•° <span class="math display">\[
f(x) = sign(w^{*} \cdot x + b^{*})
\]</span> è§£å†³äº†ã€‚</p>
<h3 id="ä¸‰éçº¿å½¢æ”¯æŒå‘é‡æœºä¸æ ¸å‡½æ•°">ä¸‰ã€<u>éçº¿å½¢æ”¯</u>æŒå‘é‡æœºä¸æ ¸å‡½æ•°</h3>
<p>å¯¹äºçº¿æ€§åˆ†ç±»é—®é¢˜ï¼Œ<code>çº¿æ€§åˆ†ç±»æ”¯æŒå‘é‡æœº</code>æ˜¯ä¸€ç§éå¸¸æœ‰æ•ˆçš„æ–¹æ³•ï¼Œä½†æ˜¯ï¼Œæœ‰æ—¶å€™åˆ†ç±»é—®é¢˜æ˜¯éçº¿æ€§çš„ã€‚<img src="/images/Screen%20Shot%202017-12-28%20at%2011.32.43%20AM.png" alt="Screen Shot 2017-12-28 at 11.32.43 AM"></p>
<p>è¿™æ—¶å€™ï¼Œæƒ³ç”¨ä¸€æ¡ç›´çº¿å»æŠŠè¿™ä¸¤ç±»æ•°æ®è¿›è¡Œæ­£ç¡®åˆ†ç±»æ˜¯ä¸ç°å®çš„ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>éçº¿æ€§æ”¯æŒå‘é‡æœº</code>ã€‚</p>
<p>éçº¿æ€§æ”¯æŒå‘é‡æœºé¦–å…ˆä½¿ç”¨ä¸€ä¸ªå˜æ¢å°†åŸç©ºé—´çš„æ•°æ®æ˜ å°„åˆ°æ–°ç©ºé—´ï¼›ç„¶ååœ¨æ–°ç©ºé—´é‡Œç”¨çº¿æ€§åˆ†ç±»å­¦ä¹ æ–¹æ³•ä»è®­ç»ƒæ•°æ®ä¸­å­¦ä¹ åˆ†ç±»æ¨¡å‹ã€‚å®ç°è¿™ä¸ªè¿‡ç¨‹æœ€ä¸»è¦çš„æ–¹æ³•å°±æ˜¯<code>æ ¸å‡½æ•°(Kernel Function)</code>ã€‚</p>
<p>åœ¨åŸå±æ€§ç©ºé—´ä¸­è®¡ç®—çš„ç›¸ä¼¼åº¦å‡½æ•°<code>K</code>ç§°ä¸º<code>æ ¸å‡½æ•°(Kernel Function)</code>ï¼Œåœ¨æ»¡è¶³<code>MerceråŸç†</code>ï¼Œä¹Ÿå°±æ˜¯è¯´å¿…é¡»å­˜åœ¨ä¸€ä¸ªç›¸åº”çš„å˜æ¢ï¼Œä½¿å¾—è®¡ç®—ä¸€å¯¹å‘é‡çš„æ ¸å‡½æ•°ç­‰ä»·äºåœ¨å˜æ¢åçš„ç©ºé—´ä¸­è®¡ç®—è¿™å¯¹å‘é‡çš„ç‚¹ç§¯ï¼Œèƒ½å¤Ÿä½¿è®¡ç®—ç‚¹ç§¯çš„å¼€é”€æ›´å°ï¼Œè€Œä¸”èƒ½å¤Ÿé¿å…ç»´ç¾éš¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰ <span class="math display">\[
\mathbf{K}(\mathbf{u, \mathbf{v}}) = \mathbf{\Phi}{(\mathbf{u})} \cdot  \mathbf{\Phi}{(\mathbf{v})} = (\mathbf{u} \cdot \mathbf{v} + 1) ^ 2
\]</span> ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„æ ¸å‡½æ•°</p>
<ul>
<li><code>å¤šé¡¹å¼æ ¸å‡½æ•°ï¼ˆpolynomial kernel function)</code></li>
</ul>
<p><span class="math display">\[
K(x, z) = (x \cdot z + 1)^p
\]</span></p>
<p>å¯¹åº”çš„æ”¯æŒå‘é‡æœºæ˜¯ä¸€ä¸ª<code>pæ¬¡å¤šé¡¹å¼åˆ†ç±»å™¨</code>ã€‚</p>
<ul>
<li><code>é«˜æ–¯æ ¸å‡½æ•°(Gaussian kernel function)</code> <span class="math display">\[
K(x, z) = exp\left(-\frac{||x-z||^2}{2\sigma^2}\right)
\]</span> ç„¶åä¸‹é¢æˆ‘ä»¬å°±å¯ä»¥å°è¯•æ±‚è§£æœ€ä¼˜è§£äº†ã€‚</li>
</ul>
<p>ï¼ˆ1ï¼‰é€‰å–é€‚å½“çš„<code>æ ¸å‡½æ•°K(x, z)</code>å’Œé€‚å½“çš„å‚æ•°<code>C</code>ï¼Œæ„é€ å¹¶æ±‚è§£æœ€ä¼˜åŒ–é—®é¢˜ <span class="math display">\[
\begin{aligned}
&amp; \mathop{min}_{\alpha} \ \ \ \frac {1}{2}\sum_{i=1}^{m}\sum_{j=1}^{m}\alpha_i\alpha_jy_iy_j(K(x_i, x_j)) -  \sum_{i=1}^{N}\alpha_i \\
&amp; s.t \ \ \  \sum_{i=1}^{m}\alpha_iy_i = 0\\
\\ 
&amp; \ \ \ \ \ \ \ \ \  0 \le \alpha_i \le C ,  \ \ \ \ i =1, 2, ..., m \\
\end{aligned}
\]</span> æ±‚å¾—æœ€ä¼˜è§£<code>É‘*=(É‘1*, a2*, ..., a*N)^T</code></p>
<p>ï¼ˆ2ï¼‰é€‰æ‹©<code>É‘*</code>çš„ä¸€ä¸ªæ­£åˆ†é‡<code>0&lt;É‘j*&lt;C</code>ï¼Œè®¡ç®— <span class="math display">\[
b^* = y_j - \sum_{i=1}^{N}\alpha_{i}^{*}y_iK(x_i \cdot x_j)
\]</span> ï¼ˆ3ï¼‰æ±‚å¾—åˆ†ç¦»è¶…å¹³é¢ <span class="math display">\[
\sum_{i=1}^{N}\alpha_{i}^{*}y_iK(x \cdot x_i) + b^{*} = 0
\]</span> ï¼ˆ4ï¼‰åˆ†ç±»å†³ç­–å‡½æ•° <span class="math display">\[
f(x) = sign \left (\sum_{i=1}^{N}\alpha_{i}^{*}y_iK(x \cdot x_i) + b^{*}\right)
\]</span> è§£å†³äº†ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬å°±å¯ä»¥ç”¨<code>Python</code>æ¥å†™ä¸€ä¸ª<code>SVMç®—æ³•</code>å•¦</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="im">import</span> time</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="im">import</span> random</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="im">import</span> logging</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="im">from</span> sklearn.cross_validation <span class="im">import</span> train_test_split</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="kw">class</span> SVM(<span class="bu">object</span>):</a>
<a class="sourceLine" id="cb1-10" data-line-number="10"></a>
<a class="sourceLine" id="cb1-11" data-line-number="11">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, kernel<span class="op">=</span><span class="st">&#39;linear&#39;</span>,epsilon <span class="op">=</span> <span class="fl">0.001</span>):</a>
<a class="sourceLine" id="cb1-12" data-line-number="12">        <span class="va">self</span>.kernel <span class="op">=</span> kernel</a>
<a class="sourceLine" id="cb1-13" data-line-number="13">        <span class="va">self</span>.epsilon <span class="op">=</span> epsilon</a>
<a class="sourceLine" id="cb1-14" data-line-number="14"></a>
<a class="sourceLine" id="cb1-15" data-line-number="15">    <span class="kw">def</span> _init_parameters(<span class="va">self</span>, features, labels):</a>
<a class="sourceLine" id="cb1-16" data-line-number="16"></a>
<a class="sourceLine" id="cb1-17" data-line-number="17">        <span class="va">self</span>.X <span class="op">=</span> features</a>
<a class="sourceLine" id="cb1-18" data-line-number="18">        <span class="va">self</span>.Y <span class="op">=</span> labels</a>
<a class="sourceLine" id="cb1-19" data-line-number="19"></a>
<a class="sourceLine" id="cb1-20" data-line-number="20">        <span class="va">self</span>.b <span class="op">=</span> <span class="fl">0.0</span></a>
<a class="sourceLine" id="cb1-21" data-line-number="21">        <span class="va">self</span>.n <span class="op">=</span> <span class="bu">len</span>(features[<span class="dv">0</span>])</a>
<a class="sourceLine" id="cb1-22" data-line-number="22">        <span class="va">self</span>.N <span class="op">=</span> <span class="bu">len</span>(features)</a>
<a class="sourceLine" id="cb1-23" data-line-number="23">        <span class="va">self</span>.alpha <span class="op">=</span> [<span class="fl">0.0</span>] <span class="op">*</span> <span class="va">self</span>.N</a>
<a class="sourceLine" id="cb1-24" data-line-number="24">        <span class="va">self</span>.E <span class="op">=</span> [<span class="va">self</span>._E_(i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">xrange</span>(<span class="va">self</span>.N)]</a>
<a class="sourceLine" id="cb1-25" data-line-number="25"></a>
<a class="sourceLine" id="cb1-26" data-line-number="26">        <span class="va">self</span>.C <span class="op">=</span> <span class="dv">1000</span></a>
<a class="sourceLine" id="cb1-27" data-line-number="27">        <span class="va">self</span>.Max_Interation <span class="op">=</span> <span class="dv">5000</span></a>
<a class="sourceLine" id="cb1-28" data-line-number="28"></a>
<a class="sourceLine" id="cb1-29" data-line-number="29"></a>
<a class="sourceLine" id="cb1-30" data-line-number="30">    <span class="kw">def</span> _satisfy_KKT(<span class="va">self</span>, i):</a>
<a class="sourceLine" id="cb1-31" data-line-number="31">        ygx <span class="op">=</span> <span class="va">self</span>.Y[i] <span class="op">*</span> <span class="va">self</span>._g_(i)</a>
<a class="sourceLine" id="cb1-32" data-line-number="32">        <span class="cf">if</span> <span class="bu">abs</span>(<span class="va">self</span>.alpha[i])<span class="op">&lt;</span><span class="va">self</span>.epsilon:</a>
<a class="sourceLine" id="cb1-33" data-line-number="33">            <span class="cf">return</span> ygx <span class="op">&gt;</span> <span class="dv">1</span> <span class="kw">or</span> ygx <span class="op">==</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb1-34" data-line-number="34">        <span class="cf">elif</span> <span class="bu">abs</span>(<span class="va">self</span>.alpha[i]<span class="op">-</span><span class="va">self</span>.C)<span class="op">&lt;</span><span class="va">self</span>.epsilon:</a>
<a class="sourceLine" id="cb1-35" data-line-number="35">            <span class="cf">return</span> ygx <span class="op">&lt;</span> <span class="dv">1</span> <span class="kw">or</span> ygx <span class="op">==</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb1-36" data-line-number="36">        <span class="cf">else</span>:</a>
<a class="sourceLine" id="cb1-37" data-line-number="37">            <span class="cf">return</span> <span class="bu">abs</span>(ygx<span class="dv">-1</span>) <span class="op">&lt;</span> <span class="va">self</span>.epsilon</a>
<a class="sourceLine" id="cb1-38" data-line-number="38"></a>
<a class="sourceLine" id="cb1-39" data-line-number="39">    <span class="kw">def</span> is_stop(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb1-40" data-line-number="40">        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">xrange</span>(<span class="va">self</span>.N):</a>
<a class="sourceLine" id="cb1-41" data-line-number="41">            satisfy <span class="op">=</span> <span class="va">self</span>._satisfy_KKT(i)</a>
<a class="sourceLine" id="cb1-42" data-line-number="42"></a>
<a class="sourceLine" id="cb1-43" data-line-number="43">            <span class="cf">if</span> <span class="kw">not</span> satisfy:</a>
<a class="sourceLine" id="cb1-44" data-line-number="44">                <span class="cf">return</span> <span class="va">False</span></a>
<a class="sourceLine" id="cb1-45" data-line-number="45">        <span class="cf">return</span> <span class="va">True</span></a>
<a class="sourceLine" id="cb1-46" data-line-number="46"></a>
<a class="sourceLine" id="cb1-47" data-line-number="47">    <span class="kw">def</span> _select_two_parameters(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb1-48" data-line-number="48"></a>
<a class="sourceLine" id="cb1-49" data-line-number="49">        index_list <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">xrange</span>(<span class="va">self</span>.N)]</a>
<a class="sourceLine" id="cb1-50" data-line-number="50"></a>
<a class="sourceLine" id="cb1-51" data-line-number="51">        i1_list_1 <span class="op">=</span> <span class="bu">filter</span>(<span class="kw">lambda</span> i: <span class="va">self</span>.alpha[i] <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> <span class="va">self</span>.alpha[i] <span class="op">&lt;</span> <span class="va">self</span>.C, index_list)</a>
<a class="sourceLine" id="cb1-52" data-line-number="52">        i1_list_2 <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(index_list) <span class="op">-</span> <span class="bu">set</span>(i1_list_1))</a>
<a class="sourceLine" id="cb1-53" data-line-number="53"></a>
<a class="sourceLine" id="cb1-54" data-line-number="54">        i1_list <span class="op">=</span> i1_list_1</a>
<a class="sourceLine" id="cb1-55" data-line-number="55">        i1_list.extend(i1_list_2)</a>
<a class="sourceLine" id="cb1-56" data-line-number="56"></a>
<a class="sourceLine" id="cb1-57" data-line-number="57">        <span class="cf">for</span> i <span class="kw">in</span> i1_list:</a>
<a class="sourceLine" id="cb1-58" data-line-number="58">            <span class="cf">if</span> <span class="va">self</span>._satisfy_KKT(i):</a>
<a class="sourceLine" id="cb1-59" data-line-number="59">                <span class="cf">continue</span></a>
<a class="sourceLine" id="cb1-60" data-line-number="60"></a>
<a class="sourceLine" id="cb1-61" data-line-number="61">            E1 <span class="op">=</span> <span class="va">self</span>.E[i]</a>
<a class="sourceLine" id="cb1-62" data-line-number="62">            max_ <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb1-63" data-line-number="63"></a>
<a class="sourceLine" id="cb1-64" data-line-number="64">            <span class="cf">for</span> j <span class="kw">in</span> index_list:</a>
<a class="sourceLine" id="cb1-65" data-line-number="65">                <span class="cf">if</span> i <span class="op">==</span> j:</a>
<a class="sourceLine" id="cb1-66" data-line-number="66">                    <span class="cf">continue</span></a>
<a class="sourceLine" id="cb1-67" data-line-number="67"></a>
<a class="sourceLine" id="cb1-68" data-line-number="68">                E2 <span class="op">=</span> <span class="va">self</span>.E[j]</a>
<a class="sourceLine" id="cb1-69" data-line-number="69">                <span class="cf">if</span> <span class="bu">abs</span>(E1 <span class="op">-</span> E2) <span class="op">&gt;</span> max_[<span class="dv">0</span>]:</a>
<a class="sourceLine" id="cb1-70" data-line-number="70">                    max_ <span class="op">=</span> (<span class="bu">abs</span>(E1 <span class="op">-</span> E2), j)</a>
<a class="sourceLine" id="cb1-71" data-line-number="71"></a>
<a class="sourceLine" id="cb1-72" data-line-number="72">            <span class="cf">return</span> i, max_[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb1-73" data-line-number="73"></a>
<a class="sourceLine" id="cb1-74" data-line-number="74">    <span class="kw">def</span> _K_(<span class="va">self</span>, x1, x2):</a>
<a class="sourceLine" id="cb1-75" data-line-number="75"></a>
<a class="sourceLine" id="cb1-76" data-line-number="76">        <span class="cf">if</span> <span class="va">self</span>.kernel <span class="op">==</span> <span class="st">&#39;linear&#39;</span>:</a>
<a class="sourceLine" id="cb1-77" data-line-number="77">            <span class="cf">return</span> <span class="bu">sum</span>([x1[k] <span class="op">*</span> x2[k] <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">xrange</span>(<span class="va">self</span>.n)])</a>
<a class="sourceLine" id="cb1-78" data-line-number="78">        <span class="cf">if</span> <span class="va">self</span>.kernel <span class="op">==</span> <span class="st">&#39;poly&#39;</span>:</a>
<a class="sourceLine" id="cb1-79" data-line-number="79">            <span class="cf">return</span> (<span class="bu">sum</span>([x1[k] <span class="op">*</span> x2[k] <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">xrange</span>(<span class="va">self</span>.n)])<span class="op">+</span><span class="dv">1</span>)<span class="op">**</span><span class="dv">3</span></a>
<a class="sourceLine" id="cb1-80" data-line-number="80"></a>
<a class="sourceLine" id="cb1-81" data-line-number="81"></a>
<a class="sourceLine" id="cb1-82" data-line-number="82"></a>
<a class="sourceLine" id="cb1-83" data-line-number="83">        <span class="bu">print</span> <span class="st">&#39;æ²¡æœ‰å®šä¹‰æ ¸å‡½æ•°&#39;</span></a>
<a class="sourceLine" id="cb1-84" data-line-number="84">        <span class="cf">return</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb1-85" data-line-number="85"></a>
<a class="sourceLine" id="cb1-86" data-line-number="86">    <span class="kw">def</span> _g_(<span class="va">self</span>, i):</a>
<a class="sourceLine" id="cb1-87" data-line-number="87"></a>
<a class="sourceLine" id="cb1-88" data-line-number="88">        result <span class="op">=</span> <span class="va">self</span>.b</a>
<a class="sourceLine" id="cb1-89" data-line-number="89"></a>
<a class="sourceLine" id="cb1-90" data-line-number="90">        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">xrange</span>(<span class="va">self</span>.N):</a>
<a class="sourceLine" id="cb1-91" data-line-number="91">            result <span class="op">+=</span> <span class="va">self</span>.alpha[j] <span class="op">*</span> <span class="va">self</span>.Y[j] <span class="op">*</span> <span class="va">self</span>._K_(<span class="va">self</span>.X[i], <span class="va">self</span>.X[j])</a>
<a class="sourceLine" id="cb1-92" data-line-number="92"></a>
<a class="sourceLine" id="cb1-93" data-line-number="93">        <span class="cf">return</span> result</a>
<a class="sourceLine" id="cb1-94" data-line-number="94"></a>
<a class="sourceLine" id="cb1-95" data-line-number="95">    <span class="kw">def</span> _E_(<span class="va">self</span>, i):</a>
<a class="sourceLine" id="cb1-96" data-line-number="96"></a>
<a class="sourceLine" id="cb1-97" data-line-number="97">        <span class="cf">return</span> <span class="va">self</span>._g_(i) <span class="op">-</span> <span class="va">self</span>.Y[i]</a>
<a class="sourceLine" id="cb1-98" data-line-number="98"></a>
<a class="sourceLine" id="cb1-99" data-line-number="99">    <span class="kw">def</span> try_E(<span class="va">self</span>,i):</a>
<a class="sourceLine" id="cb1-100" data-line-number="100">        result <span class="op">=</span> <span class="va">self</span>.b<span class="op">-</span><span class="va">self</span>.Y[i]</a>
<a class="sourceLine" id="cb1-101" data-line-number="101">        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">xrange</span>(<span class="va">self</span>.N):</a>
<a class="sourceLine" id="cb1-102" data-line-number="102">            <span class="cf">if</span> <span class="va">self</span>.alpha[j]<span class="op">&lt;</span><span class="dv">0</span> <span class="kw">or</span> <span class="va">self</span>.alpha[j]<span class="op">&gt;</span><span class="va">self</span>.C:</a>
<a class="sourceLine" id="cb1-103" data-line-number="103">                <span class="cf">continue</span></a>
<a class="sourceLine" id="cb1-104" data-line-number="104">            result <span class="op">+=</span> <span class="va">self</span>.Y[j]<span class="op">*</span><span class="va">self</span>.alpha[j]<span class="op">*</span><span class="va">self</span>._K_(<span class="va">self</span>.X[i],<span class="va">self</span>.X[j])</a>
<a class="sourceLine" id="cb1-105" data-line-number="105">        <span class="cf">return</span> result</a>
<a class="sourceLine" id="cb1-106" data-line-number="106"></a>
<a class="sourceLine" id="cb1-107" data-line-number="107"></a>
<a class="sourceLine" id="cb1-108" data-line-number="108">    <span class="kw">def</span> train(<span class="va">self</span>, features, labels):</a>
<a class="sourceLine" id="cb1-109" data-line-number="109"></a>
<a class="sourceLine" id="cb1-110" data-line-number="110">        <span class="va">self</span>._init_parameters(features, labels)</a>
<a class="sourceLine" id="cb1-111" data-line-number="111"></a>
<a class="sourceLine" id="cb1-112" data-line-number="112">        <span class="cf">for</span> times <span class="kw">in</span> <span class="bu">xrange</span>(<span class="va">self</span>.Max_Interation):</a>
<a class="sourceLine" id="cb1-113" data-line-number="113">            </a>
<a class="sourceLine" id="cb1-114" data-line-number="114">            logging.debug(<span class="st">&#39;iterater </span><span class="sc">%d</span><span class="st">&#39;</span> <span class="op">%</span> times)</a>
<a class="sourceLine" id="cb1-115" data-line-number="115"></a>
<a class="sourceLine" id="cb1-116" data-line-number="116">            i1, i2 <span class="op">=</span> <span class="va">self</span>._select_two_parameters()</a>
<a class="sourceLine" id="cb1-117" data-line-number="117"></a>
<a class="sourceLine" id="cb1-118" data-line-number="118">            L <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, <span class="va">self</span>.alpha[i2] <span class="op">-</span> <span class="va">self</span>.alpha[i1])</a>
<a class="sourceLine" id="cb1-119" data-line-number="119">            H <span class="op">=</span> <span class="bu">min</span>(<span class="va">self</span>.C, <span class="va">self</span>.C <span class="op">+</span> <span class="va">self</span>.alpha[i2] <span class="op">-</span> <span class="va">self</span>.alpha[i1])</a>
<a class="sourceLine" id="cb1-120" data-line-number="120"></a>
<a class="sourceLine" id="cb1-121" data-line-number="121">            <span class="cf">if</span> <span class="va">self</span>.Y[i1] <span class="op">==</span> <span class="va">self</span>.Y[i2]:</a>
<a class="sourceLine" id="cb1-122" data-line-number="122">                L <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, <span class="va">self</span>.alpha[i2] <span class="op">+</span> <span class="va">self</span>.alpha[i1] <span class="op">-</span> <span class="va">self</span>.C)</a>
<a class="sourceLine" id="cb1-123" data-line-number="123">                H <span class="op">=</span> <span class="bu">min</span>(<span class="va">self</span>.C, <span class="va">self</span>.alpha[i2] <span class="op">+</span> <span class="va">self</span>.alpha[i1])</a>
<a class="sourceLine" id="cb1-124" data-line-number="124"></a>
<a class="sourceLine" id="cb1-125" data-line-number="125">            E1 <span class="op">=</span> <span class="va">self</span>.E[i1]</a>
<a class="sourceLine" id="cb1-126" data-line-number="126">            E2 <span class="op">=</span> <span class="va">self</span>.E[i2]</a>
<a class="sourceLine" id="cb1-127" data-line-number="127">            eta <span class="op">=</span> <span class="va">self</span>._K_(<span class="va">self</span>.X[i1], <span class="va">self</span>.X[i1]) <span class="op">+</span> <span class="va">self</span>._K_(<span class="va">self</span>.X[i2], <span class="va">self</span>.X[i2]) <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> <span class="va">self</span>._K_(<span class="va">self</span>.X[i1], <span class="va">self</span>.X[i2])   </a>
<a class="sourceLine" id="cb1-128" data-line-number="128"></a>
<a class="sourceLine" id="cb1-129" data-line-number="129">            alpha2_new_unc <span class="op">=</span> <span class="va">self</span>.alpha[i2] <span class="op">+</span> <span class="va">self</span>.Y[i2] <span class="op">*</span> (E1 <span class="op">-</span> E2) <span class="op">/</span> eta     </a>
<a class="sourceLine" id="cb1-130" data-line-number="130"></a>
<a class="sourceLine" id="cb1-131" data-line-number="131">            alph2_new <span class="op">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb1-132" data-line-number="132">            <span class="cf">if</span> alpha2_new_unc <span class="op">&gt;</span> H:</a>
<a class="sourceLine" id="cb1-133" data-line-number="133">                alph2_new <span class="op">=</span> H</a>
<a class="sourceLine" id="cb1-134" data-line-number="134">            <span class="cf">elif</span> alpha2_new_unc <span class="op">&lt;</span> L:</a>
<a class="sourceLine" id="cb1-135" data-line-number="135">                alph2_new <span class="op">=</span> L</a>
<a class="sourceLine" id="cb1-136" data-line-number="136">            <span class="cf">else</span>:</a>
<a class="sourceLine" id="cb1-137" data-line-number="137">                alph2_new <span class="op">=</span> alpha2_new_unc</a>
<a class="sourceLine" id="cb1-138" data-line-number="138"></a>
<a class="sourceLine" id="cb1-139" data-line-number="139">            alph1_new <span class="op">=</span> <span class="va">self</span>.alpha[i1] <span class="op">+</span> <span class="va">self</span>.Y[i1] <span class="op">*</span> <span class="op">\</span></a>
<a class="sourceLine" id="cb1-140" data-line-number="140">                <span class="va">self</span>.Y[i2] <span class="op">*</span> (<span class="va">self</span>.alpha[i2] <span class="op">-</span> alph2_new)</a>
<a class="sourceLine" id="cb1-141" data-line-number="141"></a>
<a class="sourceLine" id="cb1-142" data-line-number="142">            b_new <span class="op">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb1-143" data-line-number="143">            b1_new <span class="op">=</span> <span class="op">-</span>E1 <span class="op">-</span> <span class="va">self</span>.Y[i1] <span class="op">*</span> <span class="va">self</span>._K_(<span class="va">self</span>.X[i1], <span class="va">self</span>.X[i1]) <span class="op">*</span> (alph1_new <span class="op">-</span> <span class="va">self</span>.alpha[i1]) <span class="op">-</span> <span class="va">self</span>.Y[i2] <span class="op">*</span> <span class="va">self</span>._K_(<span class="va">self</span>.X[i2], <span class="va">self</span>.X[i1]) <span class="op">*</span> (alph2_new <span class="op">-</span> <span class="va">self</span>.alpha[i2]) <span class="op">+</span> <span class="va">self</span>.b</a>
<a class="sourceLine" id="cb1-144" data-line-number="144">            b2_new <span class="op">=</span> <span class="op">-</span>E2 <span class="op">-</span> <span class="va">self</span>.Y[i1] <span class="op">*</span> <span class="va">self</span>._K_(<span class="va">self</span>.X[i1], <span class="va">self</span>.X[i2]) <span class="op">*</span> (alph1_new <span class="op">-</span> <span class="va">self</span>.alpha[i1]) <span class="op">-</span> <span class="va">self</span>.Y[i2] <span class="op">*</span> <span class="va">self</span>._K_(<span class="va">self</span>.X[i2], <span class="va">self</span>.X[i2]) <span class="op">*</span> (alph2_new <span class="op">-</span> <span class="va">self</span>.alpha[i2]) <span class="op">+</span> <span class="va">self</span>.b</a>
<a class="sourceLine" id="cb1-145" data-line-number="145"></a>
<a class="sourceLine" id="cb1-146" data-line-number="146">            <span class="cf">if</span> alph1_new <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> alph1_new <span class="op">&lt;</span> <span class="va">self</span>.C:</a>
<a class="sourceLine" id="cb1-147" data-line-number="147">                b_new <span class="op">=</span> b1_new</a>
<a class="sourceLine" id="cb1-148" data-line-number="148">            <span class="cf">elif</span> alph2_new <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> alph2_new <span class="op">&lt;</span> <span class="va">self</span>.C:</a>
<a class="sourceLine" id="cb1-149" data-line-number="149">                b_new <span class="op">=</span> b2_new</a>
<a class="sourceLine" id="cb1-150" data-line-number="150">            <span class="cf">else</span>:</a>
<a class="sourceLine" id="cb1-151" data-line-number="151">                b_new <span class="op">=</span> (b1_new <span class="op">+</span> b2_new) <span class="op">/</span> <span class="dv">2</span></a>
<a class="sourceLine" id="cb1-152" data-line-number="152"></a>
<a class="sourceLine" id="cb1-153" data-line-number="153">            <span class="va">self</span>.alpha[i1] <span class="op">=</span> alph1_new</a>
<a class="sourceLine" id="cb1-154" data-line-number="154">            <span class="va">self</span>.alpha[i2] <span class="op">=</span> alph2_new</a>
<a class="sourceLine" id="cb1-155" data-line-number="155">            <span class="va">self</span>.b <span class="op">=</span> b_new</a>
<a class="sourceLine" id="cb1-156" data-line-number="156"></a>
<a class="sourceLine" id="cb1-157" data-line-number="157">            <span class="va">self</span>.E[i1] <span class="op">=</span> <span class="va">self</span>._E_(i1)</a>
<a class="sourceLine" id="cb1-158" data-line-number="158">            <span class="va">self</span>.E[i2] <span class="op">=</span> <span class="va">self</span>._E_(i2)</a>
<a class="sourceLine" id="cb1-159" data-line-number="159"></a>
<a class="sourceLine" id="cb1-160" data-line-number="160"></a>
<a class="sourceLine" id="cb1-161" data-line-number="161">    <span class="kw">def</span> _predict_(<span class="va">self</span>,feature):</a>
<a class="sourceLine" id="cb1-162" data-line-number="162">        result <span class="op">=</span> <span class="va">self</span>.b</a>
<a class="sourceLine" id="cb1-163" data-line-number="163"></a>
<a class="sourceLine" id="cb1-164" data-line-number="164">        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">xrange</span>(<span class="va">self</span>.N):</a>
<a class="sourceLine" id="cb1-165" data-line-number="165">            result <span class="op">+=</span> <span class="va">self</span>.alpha[i]<span class="op">*</span><span class="va">self</span>.Y[i]<span class="op">*</span><span class="va">self</span>._K_(feature,<span class="va">self</span>.X[i])</a>
<a class="sourceLine" id="cb1-166" data-line-number="166"></a>
<a class="sourceLine" id="cb1-167" data-line-number="167">        <span class="cf">if</span> result <span class="op">&gt;</span> <span class="dv">0</span>:</a>
<a class="sourceLine" id="cb1-168" data-line-number="168">            <span class="cf">return</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb1-169" data-line-number="169">        <span class="cf">return</span> <span class="dv">-1</span></a>
<a class="sourceLine" id="cb1-170" data-line-number="170"></a>
<a class="sourceLine" id="cb1-171" data-line-number="171">    <span class="kw">def</span> predict(<span class="va">self</span>,features):</a>
<a class="sourceLine" id="cb1-172" data-line-number="172">        results <span class="op">=</span> []</a>
<a class="sourceLine" id="cb1-173" data-line-number="173"></a>
<a class="sourceLine" id="cb1-174" data-line-number="174">        <span class="cf">for</span> feature <span class="kw">in</span> features:</a>
<a class="sourceLine" id="cb1-175" data-line-number="175">            results.append(<span class="va">self</span>._predict_(feature))</a>
<a class="sourceLine" id="cb1-176" data-line-number="176"></a>
<a class="sourceLine" id="cb1-177" data-line-number="177">        <span class="cf">return</span> results</a></code></pre></div>
<p>ä»¥ä¸Šã€‚</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/22/åˆ†ç±»ç»“æœæ··æ·†çŸ©é˜µ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Peter Tsung">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/pandas.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å½¼å¾—çš„åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/22/åˆ†ç±»ç»“æœæ··æ·†çŸ©é˜µ/" itemprop="url">
                  åˆ†ç±»ç»“æœæ··æ·†çŸ©é˜µ
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-12-22T22:25:43+08:00">
                2017-12-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Machine-Learning/" itemprop="url" rel="index">
                    <span itemprop="name">Machine Learning</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <table>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">é¢„æµ‹ç»“æœ</th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>çœŸå®ç»“æœ</strong></td>
<td style="text-align: center;">æ­£ä¾‹ï¼ˆYesï¼‰</td>
<td style="text-align: center;">åä¾‹ï¼ˆNoï¼‰</td>
</tr>
<tr class="even">
<td style="text-align: center;">æ­£ä¾‹ï¼ˆYesï¼‰</td>
<td style="text-align: center;">TP</td>
<td style="text-align: center;">FN</td>
</tr>
<tr class="odd">
<td style="text-align: center;">åä¾‹ï¼ˆNoï¼‰</td>
<td style="text-align: center;">FP</td>
<td style="text-align: center;">TN</td>
</tr>
</tbody>
</table>
<p><span class="math display">\[
\begin{aligned}
Precision  &amp; = \frac {TP}{TP + FP} \\
\\
Recall &amp; = \frac {TP}{TP + FN}
\end{aligned}
\]</span></p>
<ul>
<li><code>æŸ¥å‡†ç‡(Precision)</code>: æŒ‡åœ¨æ‰€æœ‰é¢„æµ‹ä¸ºæ­£ä¾‹çš„æƒ…å†µä¸­ï¼Œé¢„æµ‹æ­£ä¾‹ä¸”å®é™…æ­£ä¾‹çš„æ¯”ä¾‹ã€‚<code>æŸ¥å‡†ç‡</code>å…³æ³¨çš„æ˜¯é¢„æµ‹æ­£ä¾‹æ­£ç¡®å æ‰€æœ‰é¢„æµ‹ä¸ºæ­£ä¾‹æƒ…å†µçš„æ¯”ä¾‹ï¼Œç™½è¯æ–‡å°±æ˜¯è¯´ï¼Œ<code>æŸ¥å‡†ç‡</code>å…³æ³¨çš„æ˜¯ä½ é¢„æµ‹äº†ä¸€å¤§å †æ­£ä¾‹çš„ä¾‹å­ï¼Œç„¶åé‡Œé¢æœ‰å¤šå°‘æ˜¯é¢„æµ‹æ­£ç¡®çš„ï¼Œå°±æ˜¯å‡†ä¸å‡†å˜›ã€‚</li>
<li><code>æŸ¥å…¨ç‡(Recall)</code>: æŒ‡åœ¨å®é™…ä¸ºæ­£ä¾‹çš„æƒ…å†µä¸­ï¼Œé¢„æµ‹ä¸ºæ­£ä¾‹çš„æ¯”ä¾‹ã€‚ç™½è¯æ–‡å°±æ˜¯è¯´ï¼Œ<code>æŸ¥å…¨ç‡</code>å…³æ³¨çš„æ˜¯ä½ æ­£ç¡®é¢„æµ‹äº†ä¸€å¤§å †æ­£ä¾‹ï¼Œæ•°é‡ä¸ºAï¼ŒçœŸå®æƒ…å†µä¸‹æ­£ä¾‹çš„æ•°é‡æ˜¯Bï¼Œç„¶åçœ‹Bé‡Œé¢æœ‰å¤šå°‘æ¯”ä¾‹çš„Aï¼Œç„¶åå»åˆ¤æ–­é¢„æµ‹æ­£ç¡®çš„æƒ…å†µå…¨ä¸å…¨ã€‚</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/18/Naive-Bayes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Peter Tsung">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/pandas.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å½¼å¾—çš„åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/18/Naive-Bayes/" itemprop="url">
                  Naive Bayes
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-12-18T15:25:37+08:00">
                2017-12-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Machine-Learning/" itemprop="url" rel="index">
                    <span itemprop="name">Machine Learning</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><code>Naive Bayes(æœ´ç´ è´å¶æ–¯æ³•)</code>æ˜¯åŸºäºè´å¶æ–¯å®šç†ä¸ç‰¹å¾æ¡ä»¶ç‹¬ç«‹å‡è®¾çš„åˆ†ç±»æ–¹æ³•ï¼Œå¯¹äºç»™å®šçš„è®­ç»ƒæ•°æ®é›†ï¼Œé¦–å…ˆåŸºäºç‰¹å¾æ¡ä»¶ç‹¬ç«‹å‡è®¾å­¦ä¹ è¾“å…¥/è¾“å‡ºçš„è”åˆæ¦‚ç‡åˆ†å¸ƒï¼›ç„¶ååŸºäºæ­¤æ¨¡å‹ï¼Œå¯¹ç»™å®šçš„è¾“å…¥<code>x</code>ï¼Œåˆ©ç”¨è´å¶æ–¯å®šç†æ±‚å‡ºåéªŒæ¦‚ç‡æœ€å¤§çš„è¾“å‡º<code>y</code>ã€‚</p>
<p><code>æœ´ç´ è´å¶æ–¯</code>å¯¹æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒä½œäº†æ¡ä»¶ç‹¬ç«‹æ€§çš„å‡è®¾ï¼Œå…·ä½“åœ°ï¼Œæ¡ä»¶ç‹¬ç«‹æ€§å‡è®¾æ˜¯ï¼š <span class="math display">\[
\begin{aligned}
P(X  =x|Y=c_k)  &amp;= P(X^{(1)}  = x^{(1)}, ï½¥ï½¥ï½¥, X^{(n)}=x^{(n)}|Y=c_k) \\
\\
&amp; = \prod_{j=1}^nP(X^{(j)} = x^{(j)}|Y=c_k)
\end{aligned}
\]</span> ç‹¬ç«‹æ¡ä»¶å‡è®¾å°±æ˜¯è¯´ç”¨äºåˆ†ç±»çš„ç‰¹å¾åœ¨ç±»ç¡®å®šçš„æ¡ä»¶ä¸‹éƒ½æ˜¯æ¡ä»¶ç‹¬ç«‹çš„ï¼Œè¿™ä¸ªå…¬å¼å°±æ˜¯ä¼¼ç„¶å‡½æ•°ã€‚ä»£è¡¨çš„æ˜¯ç»™å®šå‚æ•°åå˜é‡çš„æ¦‚ç‡ã€‚è¿™ä¸€å‡è®¾ä½¿æœ´ç´ è´å¶æ–¯å˜å¾—ç®€å•ï¼Œä½†ä»£ä»·å°±æ˜¯æœ‰æ—¶å€™ä¼šç‰ºç‰²ä¸€å®šçš„åˆ†ç±»å‡†ç¡®ç‡ã€‚</p>
<p><code>æœ´ç´ è´å¶æ–¯</code>åˆ†ç±»æ—¶ï¼Œå¯¹ç»™å®šçš„è¾“å…¥<code>x</code>ï¼Œé€šè¿‡å­¦ä¹ åˆ°çš„æ¨¡å‹è®¡ç®—åéªŒæ¦‚ç‡åˆ†å¸ƒ<code>P(Y=ck|X=x)</code>ï¼Œå°†åéªŒæ¦‚ç‡æœ€å¤§çš„ç±»ä½œä¸º<code>x</code>çš„ç±»è¾“å‡ºã€‚è€ŒåéªŒæ¦‚ç‡è®¡ç®—æ˜¯æ ¹æ®è´å¶æ–¯å®šç†è¿›è¡Œçš„ï¼š <span class="math display">\[
\begin{aligned}
P(Y=c_k|X=x) &amp;  = \frac {P(X=x|Y=c_k)\cdot P(Y=c_k)}{\sum_kP(X=x|Y=c_k)\cdot P(Y=c_k)} \\
\\
&amp; =\frac {P(Y=c_k)\cdot \prod_jP(X^{(j)} |Y=c_k)}{\sum_kP(Y=c_k)\cdot \prod_jP(X^{(j)} |Y=c_k)} \ \ \ k=1, 2, ...,K 
\end{aligned}
\]</span> äºæ˜¯<code>æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨</code>å¯ä»¥è¡¨ç¤ºä¸ºï¼š <span class="math display">\[
y = f(x) = \mathop{\arg\max}_{c_k} \frac {P(Y=c_k)\prod_jP(X^{(j)}=x^{(j)}|Y=c_k)}{\sum_kP(Y=c_k)\cdot \prod_jP(X^{(j)} |Y=c_k)}
\]</span> ç„¶åå…¶å®å¯¹äºæ¯ä¸ª<code>c_k</code>ï¼Œåˆ†æ¯éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¯ä»¥ç®€åŒ–å…¬å¼ï¼š <span class="math display">\[
y = f(x) = \mathop{\arg\max}_{c_k}P(Y=c_k)\prod_jP(X^{(j)}=x^{(j)}|Y=c_k)
\]</span> ä¹Ÿå°±è¯´ï¼Œæœ´ç´ è´å¶æ–¯æ³•çš„å­¦ä¹ ä¸åˆ†ç±»åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol type="1">
<li>è®¡ç®—å…ˆéªŒæ¦‚ç‡åŠæ¡ä»¶æ¦‚ç‡ï¼š</li>
</ol>
<p><span class="math display">\[
\begin{aligned}
&amp; P(Y=c_k) = \frac {\sum_{i=k}^NI(y_i=c_k)}{N},  \ \ \ k=1, 2, ..., K \\
&amp;P(X^{(j)} = a_{jl}|Y=c_k) = \frac {\sum_{i=1}^NI(x_i^{(j)} = a_{jl}, y=c_k)}{\sum_{i=1}^NI(y_i=c_k)} \\
\\
&amp; j = 1, 2, ..., n; \ \ \ l = 1, 2, ..., S_j; \ \ \ k = 1, 2, ..., K
\end{aligned}
\]</span></p>
<ol start="2" type="1">
<li>å¯¹äºç»™å®šçš„å®ä¾‹ï¼Œå¯ä»¥è¿›è¡Œè®¡ç®—ï¼š</li>
</ol>
<p><span class="math display">\[
\begin{aligned}
&amp; x =(x^{(1)}, x^{(2)}, x^{(3)}, ..., x^{(n)})^T \\
\\
&amp;P(Y=c_k)\prod_{j=1}^nP(X^{(j)} = x^{j}|Y = c_k), \ \ \ k = 1, 2, ..., K
\end{aligned}
\]</span></p>
<ol start="3" type="1">
<li>ç¡®å®šå®ä¾‹<code>x</code>çš„ç±»ï¼š</li>
</ol>
<p><span class="math display">\[
y = f(x) = \mathop{\arg\max}_{c_k}P(Y=c_k)\prod_jP(X^{(j)}=x^{(j)}|Y=c_k)
\]</span></p>
<ul>
<li><strong>æœ´ç´ è´å¶æ–¯ç®—æ³•çš„ä¸»è¦ä¼˜ç‚¹</strong>ï¼š</li>
</ul>
<ol type="1">
<li>Â å‘æºäºå¤å…¸æ•°å­¦ç†è®ºï¼Œæœ‰ç¨³å®šçš„åˆ†ç±»æ•ˆç‡</li>
<li>å¯¹å°è§„æ¨¡çš„æ•°æ®è¡¨ç°å¾ˆå¥½ï¼Œèƒ½å¤„ç†å¤šåˆ†ç±»ä»»åŠ¡ï¼Œé€‚åˆå¢é‡å¼è®­ç»ƒï¼Œå°¤å…¶æ˜¯æ•°æ®é‡è¶…å‡ºå†…å­˜æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€æ‰¹æ‰¹çš„å»å¢é‡è®­ç»ƒ</li>
<li>å¯¹ç¼ºå¤±æ•°æ®ä¸å¤ªæ•æ„Ÿï¼Œç®—æ³•ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå¸¸ç”¨äºæ–‡æœ¬åˆ†ç±»</li>
</ol>
<ul>
<li><strong>æœ´ç´ è´å¶æ–¯ç®—æ³•çš„ä¸»è¦ç¼ºç‚¹</strong>ï¼š</li>
</ul>
<ol type="1">
<li>æœ´ç´ è´å¶æ–¯å‡å®šå‡è®¾å±æ€§ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œåœ¨å±æ€§ä¸ªæ•°æ¯”è¾ƒå¤šæˆ–è€…å±æ€§ä¹‹é—´ç›¸å…³æ€§è¾ƒå¤§æ—¶ï¼Œåˆ†ç±»æ•ˆæœä¸å¥½ã€‚åœ¨å±æ€§ç›¸å…³æ€§è¾ƒå°æ—¶ï¼Œåˆ†ç±»æœ€ä¸ºè‰¯å¥½</li>
<li>éœ€è¦çŸ¥é“å…ˆéªŒæ¦‚ç‡ï¼Œä¸”å…ˆéªŒæ¦‚ç‡å¾ˆå¤šæ—¶å€™å–å†³äºå‡è®¾ã€‚å‡è®¾çš„å…ˆéªŒæ¨¡å‹ä¼šå½±å“é¢„æµ‹æ•ˆæœ</li>
<li>å¯¹è¾“å…¥æ•°æ®çš„è¡¨è¾¾å½¢å¼å¾ˆæ•æ„Ÿ</li>
</ol>
<p>ç„¶åä¸‹é¢æˆ‘ä»¬å¯ä»¥ç”¨Pythonæ¥å®ç°è¿™ä¸ªç®—æ³•å•¦ã€‚</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="im">from</span> functools <span class="im">import</span> <span class="bu">reduce</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">def</span> createFeaturesList(X):</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">    featureSet <span class="op">=</span> <span class="bu">set</span>([])</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">    <span class="cf">for</span> xi <span class="kw">in</span> X:</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">        featureSet <span class="op">=</span> featureSet <span class="op">|</span> <span class="bu">set</span>(xi)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">    <span class="cf">return</span> <span class="bu">list</span>(featureSet)</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw">def</span> features2Vec(featuresList, x):</a>
<a class="sourceLine" id="cb1-11" data-line-number="11">    featureVec <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> <span class="bu">len</span>(featuresList)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12">    <span class="cf">for</span> feature <span class="kw">in</span> x:</a>
<a class="sourceLine" id="cb1-13" data-line-number="13">        featureVec[featuresList.index(feature)] <span class="op">=</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14">    <span class="cf">return</span> featureVec</a>
<a class="sourceLine" id="cb1-15" data-line-number="15"></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="kw">def</span> train(featuresMatrix, y):</a>
<a class="sourceLine" id="cb1-17" data-line-number="17">    num_sample <span class="op">=</span> <span class="bu">len</span>(featuresMatrix)</a>
<a class="sourceLine" id="cb1-18" data-line-number="18">    num_feature <span class="op">=</span> <span class="bu">len</span>(featuresMatrix[<span class="dv">0</span>])</a>
<a class="sourceLine" id="cb1-19" data-line-number="19">    <span class="co"># è®¡ç®—P{Y=1}</span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20">    P_Y_1 <span class="op">=</span> (<span class="bu">sum</span>(y))<span class="op">/</span>(<span class="bu">float</span>(num_sample))</a>
<a class="sourceLine" id="cb1-21" data-line-number="21">    P_Y_0 <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> P_Y_1</a>
<a class="sourceLine" id="cb1-22" data-line-number="22">    </a>
<a class="sourceLine" id="cb1-23" data-line-number="23">    <span class="co"># è®¡ç®—åœ¨ä¸åŒæ ‡ç­¾ä¸‹å¯¹åº”çš„ç‰¹å¾ä¸ªæ•°</span></a>
<a class="sourceLine" id="cb1-24" data-line-number="24">    P_1_Count <span class="op">=</span> np.zeros(num_feature)</a>
<a class="sourceLine" id="cb1-25" data-line-number="25">    P_0_Count <span class="op">=</span> np.zeros(num_feature)</a>
<a class="sourceLine" id="cb1-26" data-line-number="26"></a>
<a class="sourceLine" id="cb1-27" data-line-number="27">    <span class="co"># è®¡ç®—Y=1å’ŒY=0çš„ä¸ªæ•°</span></a>
<a class="sourceLine" id="cb1-28" data-line-number="28">    Y_1_sum <span class="op">=</span> <span class="bu">sum</span>(y)</a>
<a class="sourceLine" id="cb1-29" data-line-number="29">    Y_0_sum <span class="op">=</span> <span class="bu">len</span>(y) <span class="op">-</span> <span class="bu">sum</span>(y)</a>
<a class="sourceLine" id="cb1-30" data-line-number="30"></a>
<a class="sourceLine" id="cb1-31" data-line-number="31">    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_sample):</a>
<a class="sourceLine" id="cb1-32" data-line-number="32">        <span class="cf">if</span> y[i] <span class="op">==</span> <span class="dv">1</span>:</a>
<a class="sourceLine" id="cb1-33" data-line-number="33">            <span class="co"># è®¡ç®—åœ¨Y = 1ä¸‹å¯¹åº”çš„ç‰¹å¾ä¸ªæ•°</span></a>
<a class="sourceLine" id="cb1-34" data-line-number="34">            P_1_Count <span class="op">+=</span> featuresMatrix[i]</a>
<a class="sourceLine" id="cb1-35" data-line-number="35">        <span class="cf">else</span>:</a>
<a class="sourceLine" id="cb1-36" data-line-number="36">            <span class="co"># è®¡ç®—åœ¨Y = 0ä¸‹å¯¹åº”çš„ç‰¹å¾ä¸ªæ•°</span></a>
<a class="sourceLine" id="cb1-37" data-line-number="37">            P_0_Count <span class="op">+=</span> featuresMatrix[i]</a>
<a class="sourceLine" id="cb1-38" data-line-number="38"></a>
<a class="sourceLine" id="cb1-39" data-line-number="39">    <span class="co"># è®¡ç®—P{X=xi|y=1} å’Œ P{X=xi|y=0}</span></a>
<a class="sourceLine" id="cb1-40" data-line-number="40">    P_1_Condition <span class="op">=</span> (P_1_Count <span class="op">/</span> Y_1_sum)</a>
<a class="sourceLine" id="cb1-41" data-line-number="41">    P_0_Condition <span class="op">=</span> (P_0_Count <span class="op">/</span> Y_0_sum)</a>
<a class="sourceLine" id="cb1-42" data-line-number="42"></a>
<a class="sourceLine" id="cb1-43" data-line-number="43">    <span class="cf">return</span> P_1_Condition, P_0_Condition, P_Y_1</a>
<a class="sourceLine" id="cb1-44" data-line-number="44"></a>
<a class="sourceLine" id="cb1-45" data-line-number="45"><span class="kw">def</span> classify(features_Vec, P_1_Condition, P_0_Condition, P_Y_1):</a>
<a class="sourceLine" id="cb1-46" data-line-number="46">    prod1 <span class="op">=</span> features_Vec <span class="op">*</span> P_1_Condition</a>
<a class="sourceLine" id="cb1-47" data-line-number="47">    prod1 <span class="op">=</span> <span class="bu">reduce</span>(<span class="kw">lambda</span> x, y: x<span class="op">*</span>y, prod1[prod1 <span class="op">&gt;</span> <span class="dv">0</span>])</a>
<a class="sourceLine" id="cb1-48" data-line-number="48">    prod0 <span class="op">=</span> features_Vec <span class="op">*</span> P_0_Condition</a>
<a class="sourceLine" id="cb1-49" data-line-number="49">    prod0 <span class="op">=</span> <span class="bu">reduce</span>(<span class="kw">lambda</span> x, y: x<span class="op">*</span>y, prod0[prod0 <span class="op">&gt;</span> <span class="dv">0</span>])</a>
<a class="sourceLine" id="cb1-50" data-line-number="50"></a>
<a class="sourceLine" id="cb1-51" data-line-number="51">    p1 <span class="op">=</span> prod1 <span class="op">*</span> P_Y_1</a>
<a class="sourceLine" id="cb1-52" data-line-number="52">    p0 <span class="op">=</span> prod0 <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> P_Y_1)</a>
<a class="sourceLine" id="cb1-53" data-line-number="53">    <span class="cf">if</span> p1 <span class="op">&gt;</span> p0:</a>
<a class="sourceLine" id="cb1-54" data-line-number="54">        <span class="cf">return</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb1-55" data-line-number="55">    <span class="cf">else</span>:</a>
<a class="sourceLine" id="cb1-56" data-line-number="56">        <span class="cf">return</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb1-57" data-line-number="57"></a>
<a class="sourceLine" id="cb1-58" data-line-number="58">X <span class="op">=</span> [[<span class="dv">1</span>,<span class="st">&#39;s&#39;</span>],[<span class="dv">1</span>,<span class="st">&#39;m&#39;</span>],[<span class="dv">1</span>,<span class="st">&#39;m&#39;</span>],[<span class="dv">1</span>,<span class="st">&#39;s&#39;</span>],[<span class="dv">1</span>,<span class="st">&#39;s&#39;</span>],[<span class="dv">2</span>,<span class="st">&#39;s&#39;</span>],[<span class="dv">2</span>,<span class="st">&#39;m&#39;</span>],[<span class="dv">2</span>,<span class="st">&#39;m&#39;</span>],[<span class="dv">2</span>,<span class="st">&#39;l&#39;</span>],[<span class="dv">2</span>,<span class="st">&#39;l&#39;</span>],[<span class="dv">3</span>,<span class="st">&#39;l&#39;</span>],[<span class="dv">3</span>,<span class="st">&#39;m&#39;</span>],[<span class="dv">3</span>,<span class="st">&#39;m&#39;</span>],[<span class="dv">3</span>,<span class="st">&#39;l&#39;</span>],[<span class="dv">3</span>,<span class="st">&#39;l&#39;</span>]]  </a>
<a class="sourceLine" id="cb1-59" data-line-number="59">y <span class="op">=</span> [<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>]  </a>
<a class="sourceLine" id="cb1-60" data-line-number="60">featuresList <span class="op">=</span> createFeaturesList(X)  </a>
<a class="sourceLine" id="cb1-61" data-line-number="61">featuresMatrix <span class="op">=</span> []  </a>
<a class="sourceLine" id="cb1-62" data-line-number="62"><span class="cf">for</span> xi <span class="kw">in</span> X:  </a>
<a class="sourceLine" id="cb1-63" data-line-number="63">    featuresMatrix.append(features2Vec(featuresList,xi))  </a>
<a class="sourceLine" id="cb1-64" data-line-number="64">P_0_Conditon,P_1_Conditon,P_Y_1 <span class="op">=</span> train(featuresMatrix,y) </a>
<a class="sourceLine" id="cb1-65" data-line-number="65">goal <span class="op">=</span> [<span class="dv">2</span>,<span class="st">&#39;s&#39;</span>]</a>
<a class="sourceLine" id="cb1-66" data-line-number="66">features2Vec <span class="op">=</span> np.array(features2Vec(featuresList,goal))</a>
<a class="sourceLine" id="cb1-67" data-line-number="67"><span class="bu">print</span>(classify(features2Vec,P_0_Conditon,P_1_Conditon,P_Y_1))</a></code></pre></div>
<p>ä½†å…¶å®è¿™ä¸ª<code>Naive Bayes</code>è¿˜æœ‰å¾ˆå¤šé—®é¢˜ï¼Œè­¬å¦‚è¯´é‡åˆ°æ¦‚ç‡ä¸º0ï¼Œè¿™ä¸ªæ—¶å€™åº”è¯¥ç”¨è´å¶æ–¯ä¼°è®¡ï¼Œåœ¨å…¬å¼é‡Œé¢åŠ ä¸Šæ‹‰æ™®æ‹‰æ–¯å¹³æ»‘ï¼Œé‚£ä¹ˆåˆ†ç±»åå·®å°†ä¼šå°‘å¾ˆå¤šã€‚</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/17/Logistic-Rregression/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Peter Tsung">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/pandas.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å½¼å¾—çš„åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/17/Logistic-Rregression/" itemprop="url">
                  Logistic Rregression
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-12-17T10:53:16+08:00">
                2017-12-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Machine-Learning/" itemprop="url" rel="index">
                    <span itemprop="name">Machine Learning</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä»Šå¤©çœ‹äº†æå¤§ä¼¼ç„¶ä¼°è®¡(<code>Maximum likelihood evaluation</code>)ï¼Œç„¶åå°±çœ‹åˆ°æå¤§ä¼¼ç„¶ä¼°è®¡åœ¨<code>Logistic Regression</code>ä¸Šé¢çš„åº”ç”¨ï¼Œå¿½ç„¶æœ‰ä¸€ç§é†é†çŒé¡¶çš„æ„Ÿè§‰ã€‚</p>
<p>é¦–å…ˆï¼ŒåŸæ¥<code>Logistic Regression</code>çš„ä¸­æ–‡è¯»æ³•æ˜¯é€»è¾‘æ–¯è°›å›å½’è€Œä¸æ˜¯é€»è¾‘å›å½’ï¼ŒçŸ¥é“çœŸç›¸çš„æˆ‘å¿½ç„¶è§‰å¾—ä»¥å‰çš„è‡ªå·±å¥½åœŸã€‚ã€‚ä½†è¿™ä¸æ˜¯é‡ç‚¹ï¼Œå…¶å®è¿™æ˜¯é‡ç‚¹ã€‚ã€‚å¥½å§</p>
<p><code>Logistic Regression</code>æ˜¯æ ¹æ®ä¸åŒçš„ç‰¹å¾é‡ï¼Œè¾“å‡º0å’Œ1ï¼Œå¹¶ä¸”åªèƒ½è¾“å‡º0å’Œ1ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>Sigmoid</code>å‡½æ•°æ¥å®ç°ã€‚ <span class="math display">\[
\sigma(x)  = \frac{1}{1+e^{-w x}} = \frac{e^{wt}}{1 + e^{wx}}
\]</span></p>
<p><span class="math display">\[
\sigma&#39;(x) =  \sigma(x)(1 - \sigma(x))
\]</span></p>
<p>è€Œä¸ºä»€ä¹ˆä¼šæ¶‰åŠåˆ°æå¤§ä¼¼ç„¶ä¼°è®¡å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿåœ¨ç»™å®šçš„æ¦‚ç‡å¯†åº¦å‡½<code>Ïƒ(x)</code>ï¼Œä»¥åŠæ ·æœ¬æ•°æ®ä¸­ï¼Œå¾—åˆ°èƒ½å¤Ÿä»¥æœ€å¤§æ¦‚ç‡å‘ç”Ÿæ ·æœ¬æ•°æ®çš„å‚æ•°<code>w</code>çš„ä¼°è®¡ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦å¼•å…¥ä¼¼ç„¶å‡½æ•°å¹¶ä¸”è®¡ç®—æå¤§ä¼¼ç„¶ä¼°è®¡ã€‚</p>
<p>ç¡®å®šäº†åˆ†ç±»å‡½æ•°ä¹‹åï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŠŠ<code>Sigmoid</code>å‡½æ•°çš„è¾“å…¥è®°ä¸º<code>z</code>ï¼Œåˆ™ <span class="math display">\[
z = w_0x_0+w_1x_1+w_2x_2+...+w_nx_n = w^Tx
\]</span> å‘é‡<code>x</code>æ˜¯ç‰¹å¾å˜é‡ï¼Œæ˜¯è¾“å…¥æ•°æ®ï¼Œå‘é‡<code>w</code>æ˜¯å›å½’ç³»æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬è¦åšçš„äº‹æƒ…å°±æ˜¯å¦‚ä½•ç¡®å®šæœ€ä¼˜çš„å›å½’ç³»æ•°<code>w(w0, w1, w2, ..., wn)</code></p>
<p>ç°åœ¨æ¥çœ‹çœ‹æˆ‘ä»¬æœ‰ä»€ä¹ˆå…¬å¼</p>
<ul>
<li><p>è¾“å…¥ç‰¹å¾å˜é‡ï¼š <span class="math display">\[z = w_0x_0+w_1x_1+w_2x_2+...+w_nx_n = w^Tx\]</span></p></li>
<li><p>åˆ†ç±»å‡½æ•°ï¼ˆé¢„æµ‹å‡½æ•°ï¼‰ï¼š <span class="math display">\[ h(z) =  \frac{1}{1+e^{-z}} = h_w(x)= \frac{1}{1+e^{-w^Tx}} \]</span></p></li>
<li><p>å¯¹äºä»»æ„ç¡®å®šçš„<code>x</code>å’Œ<code>w</code>ï¼Œæœ‰ï¼š</p>
<p><span class="math display">\[P(y=1|x, w)=h_w(x)\]</span></p>
<p><span class="math display">\[P(y = 0|x, w) = 1 - h_w(x)\]</span></p></li>
</ul>
<p>è¿™ä¸ªå…¬å¼å¯ä»¥å†™æˆï¼š <span class="math display">\[
P(y|x, w) = (h_w(x))^y(1-h_w(x))^{1-y}
\]</span></p>
<p>å–ä¼¼ç„¶å‡½æ•°ï¼š <span class="math display">\[
\begin{aligned}
L(w)&amp; =\prod_{i=1}^{m}P(y^{(i)}|x^{(i)}, w) \\
&amp; =\prod_{i = 1}^{m}(h_w(x^{(i)}))^{y^{(i)}}(1-h_w(x^{(i)}))^{1-y^{(i)}} 
\end{aligned}
\]</span> ç„¶åè½¬åŒ–ä¸ºå¯¹æ•°ä¼¼ç„¶å‡½æ•°ï¼Œè¿™æ ·æ›´æ–¹ä¾¿æ±‚è§£ã€‚ <span class="math display">\[
J(w) = logL(w) = \sum_{i=1}^{m}(y^{(i)}logh_w(x^{(i)}) + (1-y^{(i)})log(1-h_w(x^{(i)})))
\]</span> å¾—åˆ°å¯¹æ•°ä¼¼ç„¶å‡½æ•°<code>J(w)</code>åï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨å‡½æ•°<code>J(w)</code>æ¥è¡¨ç¤ºé¢„æµ‹å€¼å’Œå®é™…å€¼çš„åå·®ã€‚<code>J(w)</code>è¶Šå¤§ï¼Œè¡¨ç¤ºé¢„æµ‹å€¼ä¸å®é™…å€¼çš„å·®å¼‚è¶Šå°ï¼Œé¢„æµ‹è¶Šå‡†ç¡®ã€‚</p>
<p><code>Cost</code>å‡½æ•°å¯ä»¥å†™æˆï¼š <span class="math display">\[
Cost(h_w^x, y)=\left\{
\begin{aligned}
logh_w(x), &amp;  &amp;  { y = 1}  \\
1 - logh_w(x), &amp; &amp; {y = 0}
\end{aligned}
\right.
\]</span> ä¸‹é¢æˆ‘ä»¬éœ€è¦æ±‚<code>Cost</code>å‡½æ•°çš„æœ€å¤§å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹<code>J(w)</code>è¿›è¡Œæ±‚åå¯¼ï¼š <span class="math display">\[
\begin{aligned}
\frac {\partial}{\partial {w_j}}J(w) &amp; = \sum_{i=1}^m((y^{(i)}\frac{1}{h_w(x^{(i)})}-(1-y^{(i)})\frac{1}{1-h_w(x^{(i)})})\cdot\frac{\partial{h_w(x^{(i)})}}{\partial {w_j}})  \\
&amp; = \sum_{i=1}^m((y^{(i)}\frac{1}{h_w(x^{(i)})}-(1-y^{(i)})\frac{1}{1-h_w(x^{(i)})})\cdot(h_w(x^{(i)})\cdot(1-h_w(x^{(i)}))\cdot x_j) \\
&amp; = \sum_{i=1}^m((y^{(i)}\cdot (1-h_w(x^{(i)} )-(1-y^{(i)})\cdot h_w(x^{(i)})) \cdot x_j) \\
&amp; = \sum_{i=1}^m(y^{(i)}-h_w(x^{(i)}))\cdot x_j)
\end{aligned}
\]</span> å› æ­¤æˆ‘ä»¬å¾—åˆ°äº†æ¢¯åº¦ä¸Šå‡æ³•è¿­ä»£å…¬å¼ï¼š <span class="math display">\[
w_j := w_j + \alpha\sum_{i=1}^m(y^{(i)}-h_w(x^{(i)}))\cdot x_j)
\]</span> å¼„æ¸…æ¥šæ¯ä¸€å—åšä»€ä¹ˆä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨Pythonå†™ä¸€é<code>Logistic Regression</code>äº†ã€‚</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">def</span> sigmoid(z):</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">    <span class="cf">return</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>z))</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw">def</span> log_likelihood(X, y, w):</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">    hypothesis <span class="op">=</span> sigmoid(np.dot(w.T, x))</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">    ll <span class="op">=</span> np.<span class="bu">sum</span>(y <span class="op">*</span> np.log(hypothesis) <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> y) <span class="op">*</span> np.log(<span class="dv">1</span> <span class="op">-</span> hypothesis))</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">    <span class="cf">return</span> ll</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="kw">def</span> logistic_regression(X, y, num_steps, learning_rate, add_intercept <span class="op">=</span> <span class="va">False</span>):</a>
<a class="sourceLine" id="cb1-13" data-line-number="13">    <span class="cf">if</span> add_intercept:</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">        intercept <span class="op">=</span> np.ones((X.shape[<span class="dv">0</span>], <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb1-15" data-line-number="15">        X <span class="op">=</span> np.hstack((intercept, X))</a>
<a class="sourceLine" id="cb1-16" data-line-number="16"></a>
<a class="sourceLine" id="cb1-17" data-line-number="17">    weights <span class="op">=</span> np.zeros(X.shape[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb1-18" data-line-number="18"></a>
<a class="sourceLine" id="cb1-19" data-line-number="19">    <span class="cf">for</span> step <span class="kw">in</span> <span class="bu">range</span>(num_steps):</a>
<a class="sourceLine" id="cb1-20" data-line-number="20">        hypothesis <span class="op">=</span> sigmoid(np.dot(X, weights.T))</a>
<a class="sourceLine" id="cb1-21" data-line-number="21">        error <span class="op">=</span> y <span class="op">-</span> hypothesis</a>
<a class="sourceLine" id="cb1-22" data-line-number="22">        gradient <span class="op">=</span> np.dot(X.T, error)</a>
<a class="sourceLine" id="cb1-23" data-line-number="23">        weights <span class="op">+=</span> learning_rate <span class="op">*</span> gradient</a>
<a class="sourceLine" id="cb1-24" data-line-number="24"></a>
<a class="sourceLine" id="cb1-25" data-line-number="25">    <span class="cf">return</span> weights</a>
<a class="sourceLine" id="cb1-26" data-line-number="26"></a>
<a class="sourceLine" id="cb1-27" data-line-number="27">np.random.seed(<span class="dv">12</span>)</a>
<a class="sourceLine" id="cb1-28" data-line-number="28">num_observations <span class="op">=</span> <span class="dv">5000</span></a>
<a class="sourceLine" id="cb1-29" data-line-number="29"></a>
<a class="sourceLine" id="cb1-30" data-line-number="30">x1 <span class="op">=</span> np.random.multivariate_normal([<span class="dv">0</span>, <span class="dv">0</span>], [[<span class="dv">1</span>, <span class="fl">.75</span>], [.<span class="dv">75</span>, <span class="dv">1</span>]], num_observations)</a>
<a class="sourceLine" id="cb1-31" data-line-number="31">x2 <span class="op">=</span> np.random.multivariate_normal([<span class="dv">1</span>, <span class="dv">4</span>], [[<span class="dv">1</span>, <span class="fl">.75</span>], [.<span class="dv">75</span>, <span class="dv">1</span>]], num_observations)</a>
<a class="sourceLine" id="cb1-32" data-line-number="32"></a>
<a class="sourceLine" id="cb1-33" data-line-number="33">X <span class="op">=</span> np.vstack((x1, x2)).astype(np.float32)</a>
<a class="sourceLine" id="cb1-34" data-line-number="34">y <span class="op">=</span> np.hstack((np.zeros(num_observations), np.ones(num_observations)))</a>
<a class="sourceLine" id="cb1-35" data-line-number="35"></a>
<a class="sourceLine" id="cb1-36" data-line-number="36">weights <span class="op">=</span> logistic_regression(X, y, num_steps <span class="op">=</span> <span class="dv">50000</span>, learning_rate <span class="op">=</span> <span class="fl">5e-5</span>, add_intercept <span class="op">=</span> <span class="va">True</span>)</a>
<a class="sourceLine" id="cb1-37" data-line-number="37"></a>
<a class="sourceLine" id="cb1-38" data-line-number="38"></a>
<a class="sourceLine" id="cb1-39" data-line-number="39"><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</a>
<a class="sourceLine" id="cb1-40" data-line-number="40"></a>
<a class="sourceLine" id="cb1-41" data-line-number="41">clf <span class="op">=</span> LogisticRegression(fit_intercept<span class="op">=</span><span class="va">True</span>, C<span class="op">=</span><span class="fl">1e15</span>)</a>
<a class="sourceLine" id="cb1-42" data-line-number="42">clf.fit(X, y)</a>
<a class="sourceLine" id="cb1-43" data-line-number="43"><span class="bu">print</span>(clf.intercept_, clf.coef_)</a>
<a class="sourceLine" id="cb1-44" data-line-number="44"><span class="bu">print</span>(weights)</a>
<a class="sourceLine" id="cb1-45" data-line-number="45"></a>
<a class="sourceLine" id="cb1-46" data-line-number="46">final_distribtion <span class="op">=</span> np.dot(np.hstack((np.ones((X.shape[<span class="dv">0</span>], <span class="dv">1</span>)),</a>
<a class="sourceLine" id="cb1-47" data-line-number="47">                        X)), weights)</a>
<a class="sourceLine" id="cb1-48" data-line-number="48">preds <span class="op">=</span> np.<span class="bu">round</span>(sigmoid(final_distribtion))</a>
<a class="sourceLine" id="cb1-49" data-line-number="49"><span class="bu">print</span>(<span class="st">&#39;Accuracy from scratch: </span><span class="sc">{0}</span><span class="st">&#39;</span>.<span class="bu">format</span>((preds <span class="op">==</span> y).<span class="bu">sum</span>().astype(<span class="bu">float</span>) <span class="op">/</span> <span class="bu">len</span>(preds)))</a>
<a class="sourceLine" id="cb1-50" data-line-number="50"><span class="bu">print</span>(<span class="st">&#39;Accuracy from scikit-learn: </span><span class="sc">{0}</span><span class="st">&#39;</span>.<span class="bu">format</span>(clf.score(X, y)))</a>
<a class="sourceLine" id="cb1-51" data-line-number="51"></a>
<a class="sourceLine" id="cb1-52" data-line-number="52">[output]</a>
<a class="sourceLine" id="cb1-53" data-line-number="53"><span class="co"># [-13.99400797] [[-5.02712572  8.23286799]]</span></a>
<a class="sourceLine" id="cb1-54" data-line-number="54"><span class="co"># [-13.58690551  -4.8809644    7.99812915]</span></a>
<a class="sourceLine" id="cb1-55" data-line-number="55"><span class="co"># Accuracy from scratch: 0.9948</span></a>
<a class="sourceLine" id="cb1-56" data-line-number="56"><span class="co"># Accuracy from scikit-learn: 0.9948</span></a></code></pre></div>
<p>è²Œä¼¼è·Ÿ<code>scikit-learn</code>çš„ç»“æœå¾ˆæ¥è¿‘ï¼Œå®åœ¨æ˜¯å¤ªå¼€å¿ƒäº†ã€‚</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/13/Gradient-Descent/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Peter Tsung">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/pandas.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å½¼å¾—çš„åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/13/Gradient-Descent/" itemprop="url">
                  Gradient Descent
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-12-13T18:15:00+08:00">
                2017-12-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Machine-Learning/" itemprop="url" rel="index">
                    <span itemprop="name">Machine Learning</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä»å…­æœˆä»½å¼€å§‹ï¼Œå·²ç»çœ‹äº†å¾ˆå¤šPythonæœºå™¨å­¦ä¹ çš„ä¹¦ç±å’Œæ•™ç¨‹ï¼Œä½†æ˜¯ä¾ç„¶æœ‰äº›æ‘¸ä¸ç€å¤´è„‘ã€‚ç°åœ¨çœ‹æ¥ï¼Œå…¶å®ä¸€æ–¹é¢æ˜¯å¤ªè¿‡æ³¨é‡åº”ç”¨å±‚é¢è€Œæ²¡æœ‰å…³æ³¨å®è´¨æ€§çš„æ•°å­¦å±‚é¢å†…å®¹ã€‚è€Œå¦‚æœæ…¢æ…¢çœ‹ç®—æ³•å…¬å¼ï¼Œå…¶å®å¾ˆå¤šç–‘ç‚¹éƒ½ä¼šè¢«è§£å†³ã€‚æˆ‘è§‰å¾—è‡ªå·±å¯¹äºè¿™æ–¹é¢æ˜¯æœ‰ç€ä¸€ä¸ªè¿‘ä¹æåº¦ç–¯ç‹‚çš„æ‰§è¿·ï¼Œå¾ˆæƒ³å¼„æ˜ç™½é‡Œé¢çš„è¿ä½œæœºåˆ¶ã€‚</p>
<p>è€Œä»Šå¤©è¿™ä¸€å†…å®¹é‡Œé¢ï¼Œæˆ‘å°†åˆ†äº«è‡ªå·±å¯¹æœºå™¨å­¦ä¹ ç®—æ³•é‡Œé¢çš„æ¢¯åº¦ä¸‹é™æ–¹æ³•åšä¸€ä¸ªç¬”è®°å’Œæ€»ç»“ã€‚</p>
<p>åœ¨è¿›è¡Œè§£é‡Šæ¢¯åº¦ä¸‹é™æ–¹æ³•ä¹‹å‰ï¼Œéœ€è¦å¯¹æ–¹å‘å¯¼æ•°å’Œæ¢¯åº¦åšä¸€ä¸ªåŸºæœ¬çš„è§£é‡Šã€‚</p>
<blockquote>
<p>å¯¹äº<strong>æ–¹å‘å¯¼æ•°</strong>ï¼Œè®¾ z = f(x, y) åœ¨M0(x0, y0)å¤„å¯å¾®ï¼Œåˆ™f(x, y)åœ¨M0ç‚¹ä»»æ„æ–¹å‘<strong><em>l</em></strong> = ï¼ˆcosa, cosb)å­˜åœ¨æ–¹å‘å¯¼æ•°ä¸”ï¼š <span class="math display">\[
\frac{\partial f(x_0, y_0)}{\partial l} = \frac{\partial f(x_0, y_0)}{\partial x}cos\alpha+\frac{\partial f(x_0, y_0)}{\partial y}cos\beta
\]</span> å¯¹äºæ¢¯åº¦ï¼Œå‡½æ•°z = f(x, y)åœ¨ç‚¹M0çš„æ–¹å‘å¯¼æ•°è®¡ç®—å…¬å¼å¯æ”¹å†™æˆï¼š</p>
<p><span class="math display">\[
\begin{aligned}
\frac{\partial f(x_0, y_0)}{\partial l} &amp; = (\frac{\partial f(x_0, y_0)}{\partial x}, \frac{\partial f(x_0, y_0)}{\partial y})Â· (cos \alpha, cos \beta) \\ \\ 
&amp; = grad(x_0, y_0)Â·l \\
 \\
&amp; = |gradf(x_0, y_0)|cos&lt;grad(x_0, y_0), l&gt;
\end{aligned}
\]</span> åœ¨è¿™é‡Œå‘é‡: <span class="math display">\[
grad  f(x_0, y_0) = (\frac{\partial f(x_0, y_0)}{x} , \frac{\partial f(x_0, y_0)}{\partial y} ï¼‰
\]</span></p>
<p>ç§°ä¸ºz = f(x, y) åœ¨ç‚¹M0çš„æ¢¯åº¦ï¼ˆå‘é‡ï¼‰ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬éœ€è¦æ±‚å¾—å‡½æ•°ä¸­æŸç‚¹å˜åŒ–æœ€å¿«çš„å€¼ï¼Œå…¶å®ä¹Ÿå°±æ˜¯æ±‚æ–¹å‘å¯¼æ•°æ¨¡çš„æœ€å¤§å€¼ï¼Œé‚£ä¹ˆæ¢¯åº¦çš„æ–¹å‘éœ€è¦è·Ÿå•ä½æ–¹å‘å‘é‡çš„å¤¹è§’ä¸º0ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡½æ•°åœ¨æŸç‚¹çš„æ¢¯åº¦ï¼Œå…¶æ–¹å‘æ˜¯å‡½æ•°åœ¨è¯¥ç‚¹çš„æ–¹å‘å¯¼æ•°æœ€å¤§çš„æ–¹å‘ï¼Œå®ƒçš„æ¨¡æ˜¯æœ€å¤§æ–¹å‘å¯¼æ•°çš„å€¼ã€‚</p>
</blockquote>
<p>å› æ­¤å¯¹äºæ–¹å‘å¯¼æ•°è€Œè¨€ï¼Œæ±‚çš„æ˜¯å‡½æ•°ä¸­æŸç‚¹åœ¨æŸä¸ªæ–¹å‘ä¸‹çš„å¯¼æ•°ï¼Œä¸åŒæ–¹å‘çš„å¯¼æ•°éƒ½ä¸ç›¸åŒï¼Œä¹Ÿå°±è¯´å‡½æ•°ä¸­æŸç‚¹æ²¿ä¸åŒæ–¹å‘çš„å˜åŒ–é€Ÿåº¦ä¸ä¸€æ ·ã€‚è€Œæ¢¯åº¦å°±æ˜¯å‡½æ•°å¯¹å˜é‡åå¯¼æ•°çš„é›†åˆã€‚</p>
<p>å‡è®¾æœ‰å¦‚ä¸‹ä¸€ä¸ªçº¿æ€§å›å½’é—®é¢˜ï¼Œå…¬å¼å¦‚ä¸‹ï¼š &gt; <span class="math display">\[
&gt; h(x) =h_\theta(x) =\theta_0+\theta_1x_1+\theta_2x_2
&gt; \]</span> &gt;</p>
<p>å…¶ä¸­xæ˜¯è‡ªå˜é‡ï¼Œæ¯”å¦‚è¯´æˆ¿å­é¢ç§¯ï¼ŒÎ¸æ˜¯æƒé‡å‚æ•°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ±‚è§£çš„å…·ä½“å€¼ã€‚</p>
<p>ç„¶åæˆ‘ä»¬è¿˜éœ€è¦å¼•å…¥æŸå¤±å‡½æ•°ï¼ˆ<code>Loss Function</code>æˆ–è€…å«<code>Cost Function</code>)ï¼Œç›®çš„æ˜¯ä¸ºäº†åœ¨æ¢¯åº¦ä¸‹é™æ—¶ç”¨æ¥è¡¡é‡æ›´æ–°åçš„å‚æ•°æ˜¯å¦æ˜¯å‘ç€æ­£ç¡®çš„æ–¹å‘å‰è¿›ã€‚å¦‚ä¸‹æŸå¤±å‡½æ•°(mè¡¨ç¤ºè®­ç»ƒé›†æ ·æœ¬æ•°é‡)</p>
<p><span class="math display">\[
J(\theta) = \sum_{i=1}^{m}\frac{1}{2}Â·(h_\theta(x^{(i)}) - y^{(i)})^2
\]</span> å› ä¸ºæˆ‘ä»¬çš„ç›®çš„ï¼Œæ˜¯è¦æ‰¾åˆ°è¿™ä¸ªæŸå¤±å‡½æ•°çš„å€¼æœ€å°çš„å‚æ•°ä¸‹çš„ç›®æ ‡å‡½æ•°<code>h(x)</code>ï¼Œæ‰€ä»¥é¢å¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å…¶å®å¾ˆå®¹æ˜“æƒ³åˆ°åå¯¼æ•°ã€‚ç»“åˆæ–¹å‘å¯¼æ•°ä»¥åŠæ¢¯åº¦è¿™ä¸€ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æŸä¸ªæ ·æœ¬æ•°æ®åœ¨å‡½æ•°ä¸­ä¸‹é™é€Ÿåº¦æœ€å¿«çš„æ–¹å‘ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿå¯¹<code>Loss Function</code>æ±‚æœ€ä¼˜è§£ï¼Œè€Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ±‚<code>Loss Function</code>çš„æ¢¯åº¦ç„¶åä¸æ–­æ›´æ–°å‚æ•°æ¥å¾—åˆ°ã€‚å¦‚æœæˆ‘ä»¬å¾—åˆ°äº†<code>Loss Function</code>çš„æœ€ä¼˜è§£ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå°±èƒ½å¾—åˆ°ç›®æ ‡å‡½æ•°<code>h(x)</code>ã€‚</p>
<p>ä¸‹é¢å°†å¯¹<code>Loss Function</code>è¿›è¡ŒæŸä¸€ä¸ªå‚æ•°Î¸içš„åå¯¼æ•°ï¼š</p>
<p><span class="math display">\[
\begin{aligned}
\frac{\partial}{\partial \theta_j}J(\theta) &amp;= \frac{\partial}{\partial \theta_j}\frac{1}{2}Â·(h_\theta(x) - y)^2 \\\\
&amp; = 2 Â· \frac{1}{2}Â·(h_\theta(x) - y) Â· \frac{\partial}{\partial \theta_j}(h_\theta(x) - y) \\\\
&amp; = (h_\theta(x) - y)  \cdot \frac{\partial}{\partial \theta_j}(\sum_{i=0}^{n}\theta_ix_i- y) \\\\
&amp; = h_\theta(x) - y) x_j
\end{aligned}
\]</span> åœ¨æ±‚å‡º<code>Loss Function</code>å¯¹äºæŸä¸€ä¸ªå‚æ•°çš„åå¯¼æ•°ä¹‹åï¼Œæˆ‘ä»¬å®é™…ä¸Šå·²ç»æ±‚å¾—åˆ°äº†<code>Loss Function</code>åœ¨æŸä¸€ç‚¹M0ä¸‹å˜åŒ–é€Ÿåº¦æœ€å¿«çš„æ–¹å‘ï¼Œä¹Ÿå°±æ˜¯ç¡®å®šÎ¸içš„å€¼ã€‚è¿™ä¸ªæ—¶å€™ï¼Œåªè¦é€æ­¥è¿­ä»£ï¼Œå°±å¯ä»¥æ±‚å‡ºåœ¨ç»™å®šçš„æ•°æ®é›†ä¸­ï¼Œ<code>Loss Function</code>æœ€ä¼˜è§£ä¸‹çš„ç›®æ ‡å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰Î¸çš„æœ€ä¼˜è§£ã€‚</p>
<p>äºæ˜¯å¯¹äºè¿™ä¸€ä¸ªæœ€åŸºæœ¬çš„çº¿æ€§å›å½’ä¾‹å­ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä¸Š<code>Python</code>ä»£ç äº†ã€‚</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#y=2 * (x1) + (x2) + 3 </span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">rate <span class="op">=</span> <span class="fl">0.001</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">x_train <span class="op">=</span> np.array([    [<span class="dv">1</span>, <span class="dv">2</span>],    [<span class="dv">2</span>, <span class="dv">1</span>],    [<span class="dv">2</span>, <span class="dv">3</span>],    [<span class="dv">3</span>, <span class="dv">5</span>],    [<span class="dv">1</span>, <span class="dv">3</span>],    [<span class="dv">4</span>, <span class="dv">2</span>],    [<span class="dv">7</span>, <span class="dv">3</span>],    [<span class="dv">4</span>, <span class="dv">5</span>],    [<span class="dv">11</span>, <span class="dv">3</span>],    [<span class="dv">8</span>, <span class="dv">7</span>]    ])</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">y_train <span class="op">=</span> np.array([<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">14</span>, <span class="dv">8</span>, <span class="dv">13</span>, <span class="dv">20</span>, <span class="dv">16</span>, <span class="dv">28</span>, <span class="dv">26</span>])</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">x_test  <span class="op">=</span> np.array([    [<span class="dv">1</span>, <span class="dv">4</span>],    [<span class="dv">2</span>, <span class="dv">2</span>],    [<span class="dv">2</span>, <span class="dv">5</span>],    [<span class="dv">5</span>, <span class="dv">3</span>],    [<span class="dv">1</span>, <span class="dv">5</span>],    [<span class="dv">4</span>, <span class="dv">1</span>]    ])</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9">a <span class="op">=</span> np.random.normal()</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">b <span class="op">=</span> np.random.normal()</a>
<a class="sourceLine" id="cb1-11" data-line-number="11">c <span class="op">=</span> np.random.normal()</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="kw">def</span> h(x):</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">    <span class="cf">return</span> a<span class="op">*</span>x[<span class="dv">0</span>]<span class="op">+</span>b<span class="op">*</span>x[<span class="dv">1</span>]<span class="op">+</span>c</a>
<a class="sourceLine" id="cb1-15" data-line-number="15"></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10000</span>):</a>
<a class="sourceLine" id="cb1-17" data-line-number="17">    sum_a<span class="op">=</span><span class="dv">0</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18">    sum_b<span class="op">=</span><span class="dv">0</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19">    sum_c<span class="op">=</span><span class="dv">0</span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20">    <span class="cf">for</span> x, y <span class="kw">in</span> <span class="bu">zip</span>(x_train, y_train):</a>
<a class="sourceLine" id="cb1-21" data-line-number="21">        sum_a <span class="op">=</span> sum_a <span class="op">+</span> rate<span class="op">*</span>(y<span class="op">-</span>h(x))<span class="op">*</span>x[<span class="dv">0</span>]</a>
<a class="sourceLine" id="cb1-22" data-line-number="22">        sum_b <span class="op">=</span> sum_b <span class="op">+</span> rate<span class="op">*</span>(y<span class="op">-</span>h(x))<span class="op">*</span>x[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb1-23" data-line-number="23">        sum_c <span class="op">=</span> sum_c <span class="op">+</span> rate<span class="op">*</span>(y<span class="op">-</span>h(x))</a>
<a class="sourceLine" id="cb1-24" data-line-number="24">    a <span class="op">=</span> a <span class="op">+</span> sum_a</a>
<a class="sourceLine" id="cb1-25" data-line-number="25">    b <span class="op">=</span> b <span class="op">+</span> sum_b</a>
<a class="sourceLine" id="cb1-26" data-line-number="26">    c <span class="op">=</span> c <span class="op">+</span> sum_c</a>
<a class="sourceLine" id="cb1-27" data-line-number="27">    plt.plot([h(xi) <span class="cf">for</span> xi <span class="kw">in</span> x_test])</a>
<a class="sourceLine" id="cb1-28" data-line-number="28"></a>
<a class="sourceLine" id="cb1-29" data-line-number="29"><span class="bu">print</span>(a)</a>
<a class="sourceLine" id="cb1-30" data-line-number="30"><span class="bu">print</span>(b)</a>
<a class="sourceLine" id="cb1-31" data-line-number="31"><span class="bu">print</span>(c)</a>
<a class="sourceLine" id="cb1-32" data-line-number="32"></a>
<a class="sourceLine" id="cb1-33" data-line-number="33">result<span class="op">=</span>[h(xi) <span class="cf">for</span> xi <span class="kw">in</span> x_train]</a>
<a class="sourceLine" id="cb1-34" data-line-number="34"><span class="bu">print</span>(result)</a>
<a class="sourceLine" id="cb1-35" data-line-number="35"></a>
<a class="sourceLine" id="cb1-36" data-line-number="36">result<span class="op">=</span>[h(xi) <span class="cf">for</span> xi <span class="kw">in</span> x_test]</a>
<a class="sourceLine" id="cb1-37" data-line-number="37"><span class="bu">print</span>(result)</a>
<a class="sourceLine" id="cb1-38" data-line-number="38"></a>
<a class="sourceLine" id="cb1-39" data-line-number="39">plt.show()</a></code></pre></div>
<p><img src="/images/Figure_1.png"></p>
<p>ç„¶è€Œï¼Œ è¿™æ ·çš„å†™æ³•å¯¹äºæ•ˆç‡è€Œè¨€æ˜¯ä¸€ä¸ªååˆ†å¤§çš„é—®é¢˜ï¼Œï¼Œæ•´ä¸ªç¨‹åºè·‘ä¸‹æ¥çš„æ—¶é—´ååˆ†é•¿ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå°±æƒ³åˆ°äº†<strong>æ¢¯åº¦ä¸‹é™çŸ¢é‡åŒ–</strong>ï¼Œé€šè¿‡çŸ¢é‡åŒ–ï¼Œèƒ½å¤Ÿå°†è¿ç®—è¿‡ç¨‹è½¬ä¸ºçº¿æ€§ä»£æ•°çš„è®¡ç®—ï¼Œåˆ©ç”¨é€†çŸ©é˜µå’ŒçŸ©é˜µä¹˜æ³•ï¼Œæ•´ä¸ªè®¡ç®—é€Ÿåº¦å¤§å¤§æé«˜ã€‚</p>
<p><span class="math display">\[
\begin{aligned}
h_\theta(x) &amp;= \theta_0 + \theta_1x_1 + \theta_2x_2  \\\\
J(\theta) &amp; = \frac{1}{2m}\sum_{i=1}^{m}(h_\theta(x^{(i)}) - y^{(i)})^{2} \\\\
\theta_j &amp;:= \theta_j - \alpha\frac{1}{m}\sum_{i=1}^{m}(h_\theta(x^{(i)}) - y^{(i)})x_j^{(i)}
\end{aligned}
\]</span></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#y=2 * (x1) + (x2) + 3 </span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">rate <span class="op">=</span> <span class="fl">0.001</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">X <span class="op">=</span> np.array([[<span class="dv">1</span>, <span class="dv">2</span>], [<span class="dv">2</span>, <span class="dv">1</span>], [<span class="dv">2</span>, <span class="dv">3</span>], </a>
<a class="sourceLine" id="cb2-6" data-line-number="6">              [<span class="dv">3</span>, <span class="dv">5</span>], [<span class="dv">1</span>, <span class="dv">3</span>], [<span class="dv">4</span>, <span class="dv">2</span>], </a>
<a class="sourceLine" id="cb2-7" data-line-number="7">              [<span class="dv">7</span>, <span class="dv">3</span>], [<span class="dv">4</span>, <span class="dv">5</span>], [<span class="dv">11</span>, <span class="dv">3</span>]])</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">y <span class="op">=</span> np.array([<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">10</span>, </a>
<a class="sourceLine" id="cb2-9" data-line-number="9">              <span class="dv">14</span>, <span class="dv">8</span>, <span class="dv">13</span>, </a>
<a class="sourceLine" id="cb2-10" data-line-number="10">              <span class="dv">20</span>, <span class="dv">16</span>, <span class="dv">28</span>])</a>
<a class="sourceLine" id="cb2-11" data-line-number="11"></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="kw">def</span> compute_cost(X, y, theta):</a>
<a class="sourceLine" id="cb2-13" data-line-number="13">    <span class="cf">return</span> np.<span class="bu">sum</span>(np.square(np.dot(X, theta) <span class="op">-</span> y)) <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> <span class="bu">len</span>(y))</a>
<a class="sourceLine" id="cb2-14" data-line-number="14"></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="kw">def</span> gradient_descent_vectorization(X, y, learning_rate, iterations):</a>
<a class="sourceLine" id="cb2-16" data-line-number="16">    X <span class="op">=</span> np.column_stack((np.ones(<span class="bu">len</span>(X)), X))</a>
<a class="sourceLine" id="cb2-17" data-line-number="17">    theta <span class="op">=</span> np.zeros(X.shape[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb2-18" data-line-number="18">    m <span class="op">=</span> <span class="bu">len</span>(X)</a>
<a class="sourceLine" id="cb2-19" data-line-number="19">    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(iterations):</a>
<a class="sourceLine" id="cb2-20" data-line-number="20">        hypothesis <span class="op">=</span> np.dot(X, theta)</a>
<a class="sourceLine" id="cb2-21" data-line-number="21">        loss <span class="op">=</span> hypothesis <span class="op">-</span> y</a>
<a class="sourceLine" id="cb2-22" data-line-number="22">        gradient <span class="op">=</span> np.dot(X.T, loss) <span class="op">/</span> m</a>
<a class="sourceLine" id="cb2-23" data-line-number="23">        theta <span class="op">=</span> theta <span class="op">-</span> learning_rate <span class="op">*</span> gradient</a>
<a class="sourceLine" id="cb2-24" data-line-number="24">    <span class="cf">return</span> X, theta</a>
<a class="sourceLine" id="cb2-25" data-line-number="25"></a>
<a class="sourceLine" id="cb2-26" data-line-number="26">learning_rate <span class="op">=</span> <span class="fl">0.01</span></a>
<a class="sourceLine" id="cb2-27" data-line-number="27">iterations <span class="op">=</span> <span class="dv">50000</span></a>
<a class="sourceLine" id="cb2-28" data-line-number="28">X, theta <span class="op">=</span> gradient_descent_vectorization(X, y, learning_rate, iterations)</a>
<a class="sourceLine" id="cb2-29" data-line-number="29">cost <span class="op">=</span> compute_cost(X, y, theta)</a>
<a class="sourceLine" id="cb2-30" data-line-number="30"></a>
<a class="sourceLine" id="cb2-31" data-line-number="31"><span class="bu">print</span>(<span class="st">&quot;theta1 = &quot;</span>,theta[<span class="dv">1</span>], <span class="st">&quot;theta2 = &quot;</span>, theta[<span class="dv">2</span>], <span class="st">&quot;theta3 = &quot;</span>, theta[<span class="dv">0</span>])</a>
<a class="sourceLine" id="cb2-32" data-line-number="32"><span class="bu">print</span>(<span class="st">&#39;cost:&#39;</span>, cost)</a>
<a class="sourceLine" id="cb2-33" data-line-number="33"></a>
<a class="sourceLine" id="cb2-34" data-line-number="34"></a>
<a class="sourceLine" id="cb2-35" data-line-number="35">[output]</a>
<a class="sourceLine" id="cb2-36" data-line-number="36">theta1 <span class="op">=</span>  <span class="fl">2.02720821766</span> theta2 <span class="op">=</span>  <span class="fl">1.17962898412</span> theta3 <span class="op">=</span>  <span class="fl">2.2645149405</span></a>
<a class="sourceLine" id="cb2-37" data-line-number="37">cost: <span class="fl">0.0354239310129</span></a>
<a class="sourceLine" id="cb2-38" data-line-number="38">[Finished <span class="kw">in</span> <span class="fl">0.7</span>s]</a></code></pre></div>
<p>åªèƒ½è¯´ï¼Œç»è¿‡çŸ¢é‡åŒ–è¿ç®—åçš„æ¢¯åº¦ä¸‹é™æ•ˆç‡çœŸçš„å¾ˆé«˜ã€‚è¿˜æ²¡æœ‰çŸ¢é‡åŒ–çš„æ¢¯åº¦ä¸‹é™ï¼Œåœ¨ç›¸åŒè¿­ä»£æ¬¡æ•°å’Œå­¦ä¹ é€Ÿåº¦ä¸‹çš„æ‰€éœ€æ—¶é—´æ¥è¿‘67sï¼Œè€Œç›®å‰çŸ¢é‡åŒ–åçš„æ—¶é—´æ˜¯0.7sï¼Œè¶³è¶³å¿«äº†ä¸€ç™¾å€ã€‚</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/28/Python-zip-with-iter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Peter Tsung">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/pandas.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å½¼å¾—çš„åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/28/Python-zip-with-iter/" itemprop="url">
                  Python zip( ) with iter( )
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-11-28T15:54:57+08:00">
                2017-11-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-Notes/" itemprop="url" rel="index">
                    <span itemprop="name">Python_Notes</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä»Šå¤©çœ‹åˆ°åˆ·leetcodeçš„æ—¶å€™ï¼Œçœ‹åˆ°å¦‚ä¸‹ä¸€ä¸ªå‡½æ•°ã€‚</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">class</span> Solution(<span class="bu">object</span>):</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">    <span class="kw">def</span> matrixReshape(<span class="va">self</span>, nums, r, c):</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">        flat <span class="op">=</span> <span class="bu">sum</span>(nums, [])</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">        <span class="cf">if</span> <span class="bu">len</span>(flat) <span class="op">!=</span> c<span class="op">*</span>r:</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">            <span class="cf">return</span> nums</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">        </a>
<a class="sourceLine" id="cb1-7" data-line-number="7">        tuples <span class="op">=</span> <span class="bu">zip</span>(<span class="op">*</span>([<span class="bu">iter</span>(flat)] <span class="op">*</span> c))</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">        <span class="cf">return</span> <span class="bu">map</span>(<span class="bu">list</span>, tuples)</a></code></pre></div>
<p>ç„¶åæˆ‘å°±å¯¹<code>tuples = zip(*([iter(flat)] * c))</code>å¾ˆç–‘æƒ‘ï¼Œä¸æ˜¯å¾ˆæ¸…æ¥šé‡Œé¢ç©¶ç«Ÿæ˜¯æ€ä¹ˆè¿è¡Œçš„ã€‚é€šè¿‡åœ¨ç½‘ä¸ŠæŸ¥æ‰¾å„ç§èµ„æ–™ï¼Œgoogleå’Œstackoverflowä¹‹åï¼Œæˆ‘å°è¯•æŠŠæˆ‘çš„ç†è§£å†™åœ¨ä¸‹é¢ã€‚</p>
<hr>
<p>é¦–å…ˆï¼Œ æ¥çœ‹<code>x=[[1, 2], [3, 4]]</code>ã€‚</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" data-line-number="1">x <span class="op">=</span> [[<span class="dv">1</span>, <span class="dv">2</span>], [<span class="dv">3</span>, <span class="dv">4</span>]]</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">a <span class="op">=</span> <span class="bu">zip</span>(<span class="op">*</span>[x]<span class="op">*</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="bu">print</span> a</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">[output]</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">[([<span class="dv">1</span>, <span class="dv">2</span>], [<span class="dv">1</span>, <span class="dv">2</span>], [<span class="dv">1</span>, <span class="dv">2</span>]), ([<span class="dv">3</span>, <span class="dv">4</span>], [<span class="dv">3</span>, <span class="dv">4</span>], [<span class="dv">3</span>, <span class="dv">4</span>])]</a></code></pre></div>
<p>è€Œä¸Šé¢è¿™ä¸€æ­¥ç›¸å½“äºä¸‹é¢è¿™ä¸€æ­¥</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" data-line-number="1">b <span class="op">=</span> <span class="bu">zip</span>(x, x, x)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="bu">print</span> b</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">[otuput]</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">[([<span class="dv">1</span>, <span class="dv">2</span>], [<span class="dv">1</span>, <span class="dv">2</span>], [<span class="dv">1</span>, <span class="dv">2</span>]), ([<span class="dv">3</span>, <span class="dv">4</span>], [<span class="dv">3</span>, <span class="dv">4</span>], [<span class="dv">3</span>, <span class="dv">4</span>])]</a></code></pre></div>
<p>ä¸‹é¢æ¥çœ‹æˆ‘ä»¬æ¥çœ‹ä¸‹ <code>[x] * 3</code> çš„ç»“æœæ˜¯ä»€ä¹ˆã€‚</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb4-1" data-line-number="1">x2 <span class="op">=</span> [x]<span class="op">*</span><span class="dv">3</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">x2</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">[output]</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">[[[<span class="dv">1</span>, <span class="dv">2</span>], [<span class="dv">3</span>, <span class="dv">4</span>]], [[<span class="dv">1</span>, <span class="dv">2</span>], [<span class="dv">3</span>, <span class="dv">4</span>]], [[<span class="dv">1</span>, <span class="dv">2</span>], [<span class="dv">3</span>, <span class="dv">4</span>]]]</a></code></pre></div>
<p>ç»“æœæ˜¯[x]*3 ç”Ÿæˆä¸€ä¸ªåˆ—è¡¨x2ï¼Œç„¶åè¿™ä¸ªåˆ—è¡¨x2é‡Œé¢åŒ…æ‹¬ä¸‰ä¸ªå¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æ˜¯åˆ—è¡¨x</p>
<p>æ‰€ä»¥å½“æ‰§è¡Œ<code>zip(*[x]*3)</code>çš„æ—¶å€™ï¼Œå®ƒé¦–å…ˆunpackäº†<code>x2</code>è¿™ä¸€ä¸ªåˆ—è¡¨ï¼ŒæŠŠx2é‡Œé¢çš„å¯¹è±¡å…¨éƒ¨æ‹†åˆ†å‡ºæ¥ã€‚æ‰€ä»¥è¿™ä¸€è¡Œä»£ç çš„æ­¥éª¤åº”è¯¥æ˜¯ä»¥ä¸‹ï¼š</p>
<ul>
<li><code>[x]*3</code> ==&gt; <code>[x, x, x]</code>, è¿™é‡Œæˆ‘ä»¤ <code>buff = [x] * 3</code></li>
<li><code>*buff</code> ==&gt; <code>x, x, x</code></li>
<li>æ‰€ä»¥<code>zip(*buff)</code> ==&gt; <code>zip(x, x, x)</code></li>
</ul>
<p>ä¸‹é¢æ¥çœ‹çœ‹ï¼Œå¦‚æœç»“åˆäº†è¿­ä»£å™¨ä¼šæ€ä¹ˆæ ·ã€‚ä¾‹å­ï¼š <code>zip(*([iter(x)] * 2))</code></p>
<p>å¯¹äº <code>zip(*([iter(x)] * 2))</code> ï¼Œ å¦‚æœå°† <code>buff = iter(x)</code>ï¼Œé‚£ä¹ˆå°†ç­‰åŒäº <code>zip(buff, buff)</code> å› æ­¤</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="bu">zip</span>(<span class="op">*</span>([<span class="bu">iter</span>(x)]<span class="op">*</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"></a>
<a class="sourceLine" id="cb5-3" data-line-number="3">[output]</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">[([<span class="dv">1</span>, <span class="dv">2</span>], [<span class="dv">3</span>, <span class="dv">4</span>])]</a></code></pre></div>
<p>å› ä¸º<code>iter()</code>æ˜¯è¿­ä»£å™¨ï¼Œè¿™é‡Œè¿­ä»£äº†ä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡äº§å‡ºæ˜¯[1, 2]ï¼Œ ç¬¬äºŒæ¬¡æ˜¯[3, 4]ã€‚ç„¶åä¼šå°†è¿™æ¬¡è¿­ä»£ç»“æœç»„åˆæˆä¸€ä¸ªå…ƒç»„ã€‚è€Œç”±äºè¿­ä»£ä¸¤æ¬¡ä¹‹åï¼Œ<code>x</code>é‡Œé¢å·²ç»æ²¡æœ‰å¯¹è±¡å¯ä»¥è¿›è¡Œè¿­ä»£ï¼Œæ‰€ä»¥è¿”å›è¿™ä¸¤ä¸ªå¯¹è±¡æ‰€ç»„åˆçš„å…ƒç»„ã€‚</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb6-1" data-line-number="1">buff <span class="op">=</span> <span class="bu">iter</span>(x)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="bu">zip</span>(buff, buff)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">[output]</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">[([<span class="dv">1</span>, <span class="dv">2</span>], [<span class="dv">3</span>, <span class="dv">4</span>])]</a></code></pre></div>
<hr>
<p>å¥½äº†ï¼Œè§£é‡Šå®Œä¹‹åï¼Œé‚£ä¹ˆ<code>tuples = zip(*([iter(flat)] * c))</code>å°±å¾ˆå¥½ç†è§£äº†ã€‚</p>
<p>å‡è®¾<code>flat = [1, 2, 3, 4]</code>ï¼Œ<code>c = 2</code>ã€‚</p>
<ol type="1">
<li>è¿›è¡Œç¬¬ä¸€æ¬¡æ€»çš„è¿­ä»£ï¼Œé‡Œé¢åˆ†åˆ«è¿­ä»£ä¸¤æ¬¡<code>iter(flat)</code>, <code>iter(flat)</code>ï¼Œå°†ä¸¤æ¬¡ç»“æœç»„åˆæˆå…ƒç»„ï¼Œç»“æœæ˜¯<code>(1,2)</code></li>
<li>å› ä¸º<code>flat</code>é‡Œé¢è¿˜æœ‰ä¸¤ä¸ªå…ƒç´ <code>3</code>å’Œ<code>4</code>ï¼Œæ°å¥½èƒ½å‡‘åˆæˆä¸¤æ¬¡è¿­ä»£ï¼Œæ‰€ä»¥å†è¿›è¡Œè¿­ä»£ï¼Œå°†ä¸¤æ¬¡ç»“æœç»„åˆæˆå…ƒç»„ï¼Œè¿”å›ç»“æœ<code>(3, 4)</code></li>
<li>ç„¶åå†å°†è¿™ä¸¤ä¸ªç»“æœç»„åˆæˆåˆ—è¡¨å½¢å¼è¿”å›ï¼Œç»“æœæ˜¯<code>[(1, 2), (3, 4)]</code></li>
</ol>
<p>å‡è®¾<code>flat = [1, 2, 3, 4]</code>ï¼Œ<code>c = 1</code>ã€‚</p>
<ol type="1">
<li>è¿›è¡Œç¬¬ä¸€æ¬¡è¿­ä»£<code>iter(flat)</code>ï¼Œå°†ç»“æœç»„åˆæˆå…ƒç»„ï¼Œç»“æœæ˜¯<code>(1,)</code></li>
<li>è¿›è¡Œç¬¬äºŒæ¬¡è¿­ä»£<code>iter(flat)</code>ï¼Œå°†ç»“æœç»„åˆæˆå…ƒç»„ï¼Œç»“æœæ˜¯<code>(2,)</code></li>
<li>è¿›è¡Œç¬¬ä¸‰æ¬¡è¿­ä»£<code>iter(flat)</code>ï¼Œå°†ç»“æœç»„åˆæˆå…ƒç»„ï¼Œç»“æœæ˜¯<code>(3,)</code></li>
<li>è¿›è¡Œç¬¬å››æ¬¡è¿­ä»£<code>iter(flat)</code>ï¼Œå°†ç»“æœç»„åˆæˆå…ƒç»„ï¼Œç»“æœæ˜¯<code>(4,)</code></li>
<li>å°†è¿™å››æ¬¡è¿­ä»£çš„ç»“æœç»„åˆæˆåˆ—è¡¨å½¢å¼è¿”å›ï¼Œç»“æœæ˜¯<code>[(1,), (2,), (3, ), (4,)]</code></li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/05/MLè¯»ä¹¦ç¬”è®°ä¸€/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Peter Tsung">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/pandas.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å½¼å¾—çš„åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/05/MLè¯»ä¹¦ç¬”è®°ä¸€/" itemprop="url">
                  MLè¯»ä¹¦ç¬”è®°ä¸€
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-09-05T09:51:37+08:00">
                2017-09-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Machine-Learning/" itemprop="url" rel="index">
                    <span itemprop="name">Machine Learning</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æœ‰å¥½é•¿ä¸€æ®µæ—¶é—´æ²¡æœ‰æ›´æ–°åšå®¢ï¼Œå‰æ®µæ—¶é—´ä¸€ç›´éƒ½åœ¨çœ‹æœºå™¨å­¦ä¹ çš„ç›¸å…³ä¹¦ç±ï¼Œä½†ä¸€ç›´éƒ½æ²¡æœ‰çœ‹å¤ªæ‡‚ã€‚ç¬¬ä¸€æœ¬çœ‹çš„æ˜¯è·Ÿè´å¶æ–¯æ¦‚ç‡ç›¸å…³çš„ï¼Œå°è±¡æœ€æ·±åˆ»çš„æ˜¯é‡Œé¢è®²äº†ä¸€ä¸ª<code>pymc</code>çš„åº“ï¼Œå¾ˆå¤šç»†èŠ‚å‚æ•°ä¹¦æœ¬ä¸Šå¹¶æ²¡æœ‰åšå¾ˆè¯¦å°½çš„è§£é‡Šï¼Œå¤§å¤šæ•°æ—¶å€™å°±ç›´æ¥è®²å¦‚ä½•åº”ç”¨ï¼Œè™½ç„¶è§è¯†äº†è¿™ä¸ªåº“çš„å¼ºå¤§ï¼Œä½†æœ‰å¾ˆå¤šåœ°æ–¹å’Œæ€è·¯éƒ½æ— ä»é€‚åº”ã€‚ç¬¬äºŒæœ¬ä¹¦è®²çš„æ˜¯Pythonæœºå™¨å­¦ä¹ é‡Œé¢ä¸€äº›åŸºæœ¬æ¦‚å¿µå’Œåº”ç”¨ï¼Œä»ç›‘ç£å­¦ä¹ æ— ç›‘ç£å­¦ä¹ åˆ°çº¿æ€§å›å½’é‡Œé¢çš„æœ€å°äºŒä¹˜æ³•å’Œå²­å›å½’ï¼Œåˆ°äº†åé¢çš„é›†æˆå­¦ä¹ æ–¹æ³•ã€‚è¿™æœ¬ä¹¦æˆ‘åŸºæœ¬ä¸Šå°±æ˜¯ä»£ç éƒ½æ•²è¿‡ä¸€éï¼Œæ€»ä½“ä¸Šæ‘¸äº†ä¸€äº›æ€è·¯ã€‚ä¹¦æœ¬æŠŠä¸€äº›æ¨¡å‹çš„ç»†èŠ‚è®²å¾—å¾ˆç»†ï¼Œä¼¼æ‡‚éæ‡‚ã€‚ä½†æ— è®ºå¦‚ä½•ï¼Œè¢«è¿™ä¸¤æœ¬ä¹¦è™å®Œä¹‹åï¼Œæˆ‘æ€»ç®—å¯¹æœºå™¨å­¦ä¹ çš„è®¤è¯†ç›¸æ¯”ä»¥å‰æ²¡æœ‰é‚£ä¹ˆæ¨¡ç³Šï¼Œ</p>
<p>ç°åœ¨æˆ‘çš„å­¦ä¹ è®¡åˆ’å°±æ˜¯ï¼Œçœ‹ä¸€ç« å‘¨å¿—åè€å¸ˆçš„<code>ã€Šæœºå™¨å­¦ä¹ ã€‹</code>ï¼ŒæŠŠæ¦‚å¿µæ•°å­¦å…¬å¼å…¨éƒ¨å¼„æ¸…æ¥šï¼Œä¸ç€æ€¥çœ‹ä¸‹ä¸€ç« ã€‚ç„¶ååœ¨<code>ã€ŠPythonæœºå™¨å­¦ä¹ ç»å…¸å®ä¾‹ã€‹</code>æŠŠå¯¹åº”çš„æ¡ˆä¾‹å’Œåº”ç”¨éƒ½å­¦ä¸€éï¼Œåšåˆ°å­¦ä»¥è‡´ç”¨ã€‚ç„¶ååœ¨Youtubeä¸Šçœ‹æå®æ¯…æ•™æˆå¯¹åº”çš„MLè¯¾ç¨‹ï¼Œæœ€ååœ¨<code>ã€ŠPythonæ•°æ®åˆ†æå®æˆ˜ã€‹</code>çœ‹ä¸€ç« ï¼Œå·©å›º<code>Python</code>åœ¨æ•°æ®åˆ†æé‡Œé¢åº“çš„åº”ç”¨ã€‚ç„¶åå†<code>ã€Šæœºå™¨å­¦ä¹ ã€‹</code>â€”&gt;<code>ã€ŠPythonæœºå™¨å­¦ä¹ ç»å…¸æ¡ˆä¾‹ã€‹</code>â€”&gt;Youtubeä¸­æå®æ¯…æ•™æˆå¯¹åº”çš„MLè¯¾ç¨‹â€”&gt;<code>ã€ŠPythonæ•°æ®åˆ†æå®æˆ˜ã€‹</code>å¾ªç¯ã€‚ç›®å‰åœ¨è¿›è¡Œç¬¬ä¸€ä¸ªå¾ªç¯ï¼Œåˆšåˆšåˆ·äº†<code>ã€ŠPythonæœºå™¨å­¦ä¹ ç»å…¸æ¡ˆä¾‹ã€‹</code>çš„ç¬¬ä¸€ç« <code>çº¿æ€§å›å½’</code>ï¼Œç›®å‰ä¸¤ä¸ªè¿‡ç¨‹è¿˜æ˜¯å—ç›ŠåŒªæµ…ã€‚æ‰€ä»¥å°±åœ¨è¿™é‡Œè®°å½•æˆ‘çš„å­¦ä¹ ç¬”è®°ã€‚</p>
<p>é¦–å…ˆï¼Œç›‘ç£å­¦ä¹ æ˜¯æŒ‡åœ¨æœ‰æ ‡è®°çš„æ ·æœ¬(<code>labeld samples</code>)ä¸Šå»ºç«‹æœºå™¨å­¦ä¹ çš„æ¨¡å‹ã€‚æœ‰äº†è¿™äº›å¸¦æ ‡è®°çš„æ•°æ®ï¼Œç®—æ³•å°±å¯ä»¥å­¦ä¼šå¦‚ä½•æ ¹æ®è¾“å…¥çš„å‚æ•°è®¡ç®—ã€‚æ— ç›‘ç£è¡€è™šé¢å¯¹çš„æ˜¯æ²¡æœ‰æ ‡è®°çš„æ•°æ®ã€‚å‡è®¾éœ€è¦æŠŠä¸€äº›æ•°æ®åˆ†æˆä¸åŒçš„ç»„åˆ«ï¼Œä½†æ˜¯å¯¹åˆ†ç»„çš„æ¡ä»¶æ¯«ä¸çŸ¥æƒ…ï¼Œäºæ˜¯ï¼Œæ— ç›‘ç£å­¦ä¹ ç®—æ³•å°±ä¼šä»¥æœ€åˆç†çš„æ–¹å¼å°†æ•°æ®é›†åˆ†æˆç¡®å®šæ•°é‡çš„ç»„åˆ«ã€‚</p>
<h4 id="ä¸€æ•°æ®é¢„å¤„ç†æŠ€æœ¯">ä¸€ã€æ•°æ®é¢„å¤„ç†æŠ€æœ¯</h4>
<p>ä¸ºäº†è®©æœºå™¨å­¦ä¹ ç®—æ³•ç†è§£åŸå§‹æ•°æ®ï¼Œéœ€è¦å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†ã€‚</p>
<p>1.<u>å‡å€¼ç§»é™¤</u></p>
<p>é€šå¸¸ä¼šæŠŠæ¯ä¸ªç‰¹å¾çš„å¹³å‡å€¼ç§»é™¤ï¼Œä»¥ä¿è¯ç‰¹å¾å‡å€¼ä¸º0ï¼ˆå³æ ‡å‡†åŒ–å¤„ç†ï¼‰ã€‚è¿™æ ·åšå¯ä»¥æ¶ˆé™¤ç‰¹å¾å½¼æ­¤çš„åå·®ï¼ˆbiasï¼‰ã€‚</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="im">from</span> sklearn <span class="im">import</span> preprocessing</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">data <span class="op">=</span> np.array([</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">  [<span class="dv">3</span>, <span class="fl">-1.5</span>, <span class="dv">2</span>, <span class="fl">-5.4</span>],</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  [<span class="dv">0</span>, <span class="dv">4</span>, <span class="fl">-0.3</span>, <span class="fl">2.1</span>],</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">  [<span class="dv">1</span>, <span class="fl">3.3</span>, <span class="fl">-1.9</span>, <span class="fl">-4.3</span>]</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">])</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">data_standardized <span class="op">=</span> preprocessing.scale(data)</a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="bu">print</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Mean =&quot;</span>, data_standardized.mean(axis<span class="op">=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="bu">print</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Std deviation =&quot;</span>, data_standardized.std(axis<span class="op">=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"></a>
<a class="sourceLine" id="cb1-13" data-line-number="13">[Result]</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">Mean <span class="op">=</span>  [  <span class="fl">5.55111512e-17</span>  <span class="fl">-1.11022302e-16</span>  <span class="fl">-7.40148683e-17</span>  <span class="fl">-7.40148683e-17</span>]</a>
<a class="sourceLine" id="cb1-15" data-line-number="15">Std deviation <span class="op">=</span> [ <span class="fl">1.</span>  <span class="fl">1.</span>  <span class="fl">1.</span>  <span class="fl">1.</span>]</a></code></pre></div>
<p>2.<u>èŒƒå›´ç¼©æ”¾</u>ï¼ˆScalingï¼‰</p>
<p>æ•°æ®ç‚¹ä¸­æ¯ä¸ªç‰¹å¾çš„æ•°å€¼èŒƒå›´å¯èƒ½å˜åŒ–å¾ˆå¤§ï¼Œå› æ­¤ï¼Œæœ‰æ—¶å°†ç‰¹å¾çš„æ•°å€¼èŒƒå›´ç¼©æ”¾åˆ°åˆç†çš„å¤§å°æ˜¯éå¸¸é‡è¦ã€‚</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" data-line-number="1">data_scaler <span class="op">=</span> preprocessing.MinMaxScaler(feature_range<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">data_scaled<span class="op">=</span> data_scaler.fit_transform(data)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="bu">print</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Min max scaled data =&quot;</span>, data_scaled</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">[Result]</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">Min <span class="bu">max</span> scaled data <span class="op">=</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">[[ <span class="fl">1.</span>          <span class="fl">0.</span>          <span class="fl">1.</span>          <span class="fl">0.</span>        ]</a>
<a class="sourceLine" id="cb2-8" data-line-number="8"> [ <span class="fl">0.</span>          <span class="fl">1.</span>          <span class="fl">0.41025641</span>  <span class="fl">1.</span>        ]</a>
<a class="sourceLine" id="cb2-9" data-line-number="9"> [ <span class="fl">0.33333333</span>  <span class="fl">0.87272727</span>  <span class="fl">0.</span>          <span class="fl">0.14666667</span>]]</a></code></pre></div>
<p>3.<u>å½’ä¸€åŒ–</u>ï¼ˆNormalizationï¼‰</p>
<p>æ•°æ®å½’ä¸€åŒ–ç”¨äºå¯¹ç‰¹å¾å‘é‡çš„å€¼è¿›è¡Œè°ƒæ•´ï¼Œä¿è¯æ¯ä¸ªç‰¹å¾å‘é‡çš„å€¼éƒ½ç¼©æ”¾åˆ°ç›¸åŒçš„æ•°å€¼èŒƒå›´ã€‚ç¡®ä¿æ•°æ®ç‚¹æ²¡æœ‰å› ä¸ºç‰¹å¾çš„åŸºæœ¬æ€§è´¨è€Œäº§ç”Ÿè¾ƒå¤§å·®å¼‚ï¼Œç¡®ä¿æ•°æ®å¤„äºåŒä¸€æ•°é‡çº§ï¼Œæé«˜ä¸åŒç‰¹å¾æ•°æ®çš„å¯æ¯”æ€§ã€‚</p>
<p>å¸¸ç”¨çš„å½’ä¸€åŒ–å½¢å¼å°±æ˜¯å°†ç‰¹å¾å‘é‡è°ƒæ•´ä¸ºL1èŒƒæ•°ï¼Œä½¿ç‰¹å¾å‘é‡çš„æ•°å€¼ä¹‹å’Œä¸º1ã€‚L0èŒƒæ•°æ˜¯æŒ‡å‘é‡ä¸­é0çš„å…ƒç´ ä¸ªæ•°ã€‚å¦‚æœç”¨L0èŒƒæ•°æ¥è§„åˆ™åŒ–ä¸€ä¸ªå‚æ•°çŸ©é˜µWï¼Œä¼šå¸Œæœ›Wå¤§éƒ¨åˆ†å…ƒç´ éƒ½æ˜¯0ã€‚L1èŒƒæ•°å’ŒL2èŒƒæ•°éƒ½å¯ä»¥å®ç°çŸ©é˜µç¨€ç–ï¼ŒL1å› å…·æœ‰æ¯”L0æ›´å¥½çš„ä¼˜åŒ–æ±‚è§£ç‰¹å¾è€Œè¢«å¹¿æ³›åº”ç”¨ã€‚è€Œå‚æ•°ç¨€ç–èƒ½å¤Ÿæ›´å¥½çš„è¿›è¡Œç‰¹å¾é€‰æ‹©ä»¥åŠå¢å¼ºè§£é‡Šæ€§ã€‚L2èŒƒæ•°åœ¨å›å½’é‡Œé¢ä¹Ÿå«â€œå²­å›å½’(<code>Ridge Regression</code>)â€ï¼Œä¹Ÿè¢«ç§°ä¸ºæƒå€¼è¡°å‡weight decayã€‚å²­å›å½’èƒ½å¤Ÿæ”¹å–„æ¨¡å‹è¿‡æ‹Ÿåˆé—®é¢˜ã€‚åœ¨L2èŒƒæ•°ä¸­ï¼Œé™åˆ¶äº†å‚æ•°çš„å˜åŒ–æ³¢åŠ¨èŒƒå›´ï¼Œé™ä½äº†æ ‡å‡†å·®ã€‚æ€»çš„è€Œè¨€ï¼ŒL2èŒƒæ•°å¯ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œæå‡æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" data-line-number="1">data_normalized <span class="op">=</span> preprocessing.normalize(data, norm<span class="op">=</span><span class="st">&#39;l1&#39;</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="bu">print</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">L1 normalized data =&quot;</span>, data_normalized</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">[Result]</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">Min <span class="bu">max</span> scaled data <span class="op">=</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">[[ <span class="fl">1.</span>          <span class="fl">0.</span>          <span class="fl">1.</span>          <span class="fl">0.</span>        ]</a>
<a class="sourceLine" id="cb3-7" data-line-number="7"> [ <span class="fl">0.</span>          <span class="fl">1.</span>          <span class="fl">0.41025641</span>  <span class="fl">1.</span>        ]</a>
<a class="sourceLine" id="cb3-8" data-line-number="8"> [ <span class="fl">0.33333333</span>  <span class="fl">0.87272727</span>  <span class="fl">0.</span>          <span class="fl">0.14666667</span>]]</a></code></pre></div>
<p>4.<u>äºŒå€¼åŒ–</u>ï¼ˆBinarizationï¼‰</p>
<p>äºŒå€¼åŒ–ç”¨äºå°†æ•°å€¼ç‰¹å¾å‘é‡è½¬æ¢ä¸ºå¸ƒå°”ç±»å‹å‘é‡ã€‚</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb4-1" data-line-number="1">data_binarized <span class="op">=</span> preprocessing.Binarizer(threshold<span class="op">=</span><span class="fl">1.4</span>).transform(data)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="bu">print</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Binarized data =&quot;</span>, data_binarized</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">[Result]</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">Binarized data <span class="op">=</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">[[ <span class="fl">1.</span>  <span class="fl">0.</span>  <span class="fl">1.</span>  <span class="fl">0.</span>]</a>
<a class="sourceLine" id="cb4-7" data-line-number="7"> [ <span class="fl">0.</span>  <span class="fl">1.</span>  <span class="fl">0.</span>  <span class="fl">1.</span>]</a>
<a class="sourceLine" id="cb4-8" data-line-number="8"> [ <span class="fl">0.</span>  <span class="fl">1.</span>  <span class="fl">0.</span>  <span class="fl">0.</span>]]</a></code></pre></div>
<p>5.<u>ç‹¬çƒ­ç¼–ç </u></p>
<p>ç‹¬çƒ­ç¼–ç å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§æ”¶ç´§ï¼ˆtightenï¼‰ç‰¹å¾å‘é‡çš„å·¥å…·ã€‚å®ƒæŠŠç‰¹å¾å‘é‡çš„æ¯ä¸ªç‰¹å¾ä¸ç‰¹å¾çš„éé‡å¤æ€»æ•°ç›¸å¯¹åº”ï¼Œé€šè¿‡<em>one of k</em>çš„å½¢å¼å¯¹æ¯ä¸ªå€¼è¿›è¡Œç¼–ç ã€‚ç‰¹å¾å‘é‡çš„æ¯ä¸ªç‰¹å¾å€¼éƒ½æŒ‰ç…§è¿™ç§æ–¹å¼ç¼–ç ï¼Œèƒ½å¤Ÿæ›´æœ‰æ•ˆåœ°è¡¨ç¤ºç©ºé—´ã€‚</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb5-1" data-line-number="1">encoder <span class="op">=</span> preprocessing.OneHotEncoder()</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">encoder.fit([[<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">12</span>], [<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">3</span>], [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">12</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>]])</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">encoder_vector <span class="op">=</span> encoder.transform([[<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">3</span>]]).toarray()</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="bu">print</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Encoded vector </span><span class="ch">\n</span><span class="st">&quot;</span>, encoder_vector</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"></a>
<a class="sourceLine" id="cb5-6" data-line-number="6">[Result]</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">Encoded vector <span class="op">=</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8">[[ <span class="fl">0.</span>  <span class="fl">0.</span>  <span class="fl">1.</span>  <span class="fl">0.</span>  <span class="fl">1.</span>  <span class="fl">0.</span>  <span class="fl">0.</span>  <span class="fl">0.</span>  <span class="fl">1.</span>  <span class="fl">1.</span>  <span class="fl">0.</span>]]</a></code></pre></div>
<h4 id="äºŒæ ‡è®°ç¼–ç æ–¹æ³•">äºŒã€æ ‡è®°ç¼–ç æ–¹æ³•</h4>
<p>åœ¨ç›‘ç£å­¦ä¹ ä¸­ï¼Œç»å¸¸éœ€è¦å¤„ç†å„ç§æ ‡è®°ã€‚æ ‡è®°ç¼–ç å°±æ˜¯æŠŠå•è¯æ ‡è®°è½¬æ¢æˆæ•°å€¼å½¢å¼ï¼Œè®©ç®—æ³•æ‡‚å¾—å¦‚ä½•æ“ä½œæ ‡è®°ã€‚</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="im">from</span> sklearn <span class="im">import</span> preprocessing</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"></a>
<a class="sourceLine" id="cb6-3" data-line-number="3">label_encoder <span class="op">=</span> preprocessing.LabelEncoder()</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">input_classes <span class="op">=</span> [<span class="st">&#39;audi&#39;</span>, <span class="st">&#39;ford&#39;</span>, <span class="st">&#39;audi&#39;</span>, <span class="st">&#39;toyota&#39;</span>, <span class="st">&#39;ford&#39;</span>, <span class="st">&#39;bmw&#39;</span>]</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">label_encoder.fit(input_classes)</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="bu">print</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st"> Class mapping:&quot;</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="cf">for</span> i, item <span class="kw">in</span> <span class="bu">enumerate</span>(label_encoder.classes_):</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">    <span class="bu">print</span> item, <span class="st">&#39;--&gt;&#39;</span>, i</a>
<a class="sourceLine" id="cb6-9" data-line-number="9"></a>
<a class="sourceLine" id="cb6-10" data-line-number="10">[Result]</a>
<a class="sourceLine" id="cb6-11" data-line-number="11">Class mapping:</a>
<a class="sourceLine" id="cb6-12" data-line-number="12">audi <span class="op">--&gt;</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13">bmw <span class="op">--&gt;</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14">ford <span class="op">--&gt;</span> <span class="dv">2</span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15">toyota <span class="op">--&gt;</span> <span class="dv">3</span></a></code></pre></div>
<p>åŒæ ·ï¼Œå¦‚æœéœ€è¦ä¸€ç»„æ ‡è®°ï¼Œä¹Ÿèƒ½éå¸¸è½»æ¾åœ°è½¬æ¢å®ƒä»¬ã€‚</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb7-1" data-line-number="1">labels <span class="op">=</span> [<span class="st">&#39;toyota&#39;</span>, <span class="st">&#39;ford&#39;</span>, <span class="st">&#39;audi&#39;</span>]</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">encoded_labels <span class="op">=</span> label_encoder.transform(labels)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="bu">print</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Labels =&quot;</span>, labels</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="bu">print</span> <span class="st">&quot;Encoded labels =&quot;</span>, <span class="bu">list</span>(encoded_labels)</a>
<a class="sourceLine" id="cb7-5" data-line-number="5"></a>
<a class="sourceLine" id="cb7-6" data-line-number="6">[Result]</a>
<a class="sourceLine" id="cb7-7" data-line-number="7">Labels <span class="op">=</span> [<span class="st">&#39;toyota&#39;</span>, <span class="st">&#39;ford&#39;</span>, <span class="st">&#39;audi&#39;</span>]</a>
<a class="sourceLine" id="cb7-8" data-line-number="8">Encoded labels <span class="op">=</span> [<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">0</span>]</a>
<a class="sourceLine" id="cb7-9" data-line-number="9"></a>
<a class="sourceLine" id="cb7-10" data-line-number="10">encoded_labels <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>]</a>
<a class="sourceLine" id="cb7-11" data-line-number="11">decoded_labels <span class="op">=</span> label_encoder.inverse_transform(encoded_labels)</a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="bu">print</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Encoded labels =&quot;</span>, encoded_labels</a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="bu">print</span> <span class="st">&quot;Decoded labels =&quot;</span>, <span class="bu">list</span>(decoded_labels)</a>
<a class="sourceLine" id="cb7-14" data-line-number="14"></a>
<a class="sourceLine" id="cb7-15" data-line-number="15">[Result]</a>
<a class="sourceLine" id="cb7-16" data-line-number="16">Encoded labels <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>]</a>
<a class="sourceLine" id="cb7-17" data-line-number="17">Decoded labels <span class="op">=</span> [<span class="st">&#39;ford&#39;</span>, <span class="st">&#39;bmw&#39;</span>, <span class="st">&#39;audi&#39;</span>, <span class="st">&#39;bmw&#39;</span>]</a></code></pre></div>
<h4 id="ä¸‰åˆ›å»ºçº¿æ€§å›å½’å™¨">ä¸‰ã€åˆ›å»ºçº¿æ€§å›å½’å™¨</h4>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="im">import</span> sys</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">filename <span class="op">=</span> sys.argv[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">X <span class="op">=</span> []</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">y <span class="op">=</span> []</a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="cf">with</span> <span class="bu">open</span>(filename, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> f:</a>
<a class="sourceLine" id="cb8-9" data-line-number="9">    <span class="cf">for</span> line <span class="kw">in</span> f.readlines():</a>
<a class="sourceLine" id="cb8-10" data-line-number="10">        xt, yt <span class="op">=</span> [<span class="bu">float</span>(i) <span class="cf">for</span> i <span class="kw">in</span> line.split(<span class="st">&#39;,&#39;</span>)]</a>
<a class="sourceLine" id="cb8-11" data-line-number="11">        X.append(xt)</a>
<a class="sourceLine" id="cb8-12" data-line-number="12">        y.append(yt)</a>
<a class="sourceLine" id="cb8-13" data-line-number="13">    </a>
<a class="sourceLine" id="cb8-14" data-line-number="14">num_training <span class="op">=</span> <span class="bu">int</span>(<span class="fl">0.8</span> <span class="op">*</span> <span class="bu">len</span>(X))</a>
<a class="sourceLine" id="cb8-15" data-line-number="15">num_test <span class="op">=</span> <span class="bu">len</span>(X) <span class="op">-</span> num_training</a>
<a class="sourceLine" id="cb8-16" data-line-number="16"></a>
<a class="sourceLine" id="cb8-17" data-line-number="17">X_train <span class="op">=</span> np.array(X[:num_training]).reshape((num_training, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb8-18" data-line-number="18">y_train <span class="op">=</span> np.array(y[:num_training])</a>
<a class="sourceLine" id="cb8-19" data-line-number="19"></a>
<a class="sourceLine" id="cb8-20" data-line-number="20">X_test <span class="op">=</span> np.array(X[num_training:]).reshape((num_test, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb8-21" data-line-number="21">y_test <span class="op">=</span> np.array(y[num_training:])</a>
<a class="sourceLine" id="cb8-22" data-line-number="22"></a>
<a class="sourceLine" id="cb8-23" data-line-number="23"><span class="im">from</span> sklearn <span class="im">import</span> linear_model</a>
<a class="sourceLine" id="cb8-24" data-line-number="24"></a>
<a class="sourceLine" id="cb8-25" data-line-number="25">linear_regressor <span class="op">=</span> linear_model.LinearRegression()</a>
<a class="sourceLine" id="cb8-26" data-line-number="26"></a>
<a class="sourceLine" id="cb8-27" data-line-number="27">y_test_pred <span class="op">=</span> linear_regressor.predict(X_test)</a>
<a class="sourceLine" id="cb8-28" data-line-number="28"></a>
<a class="sourceLine" id="cb8-29" data-line-number="29"><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</a>
<a class="sourceLine" id="cb8-30" data-line-number="30"></a>
<a class="sourceLine" id="cb8-31" data-line-number="31">plt.scatter(X_test, y_test, color<span class="op">=</span><span class="st">&#39;green&#39;</span>)</a>
<a class="sourceLine" id="cb8-32" data-line-number="32">plt.plot(X_test, y_test_pred, color<span class="op">=</span><span class="st">&#39;black&#39;</span>, linewidth<span class="op">=</span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb8-33" data-line-number="33">plt.xticks(())</a>
<a class="sourceLine" id="cb8-34" data-line-number="34">plt.yticks(())</a>
<a class="sourceLine" id="cb8-35" data-line-number="35">plt.show()</a></code></pre></div>
<figure>
<img src="/images/linear.png" alt="linear"><figcaption>linear</figcaption>
</figure>
<h4 id="å››è®¡ç®—å›å½’å‡†ç¡®æ€§">å››ã€è®¡ç®—å›å½’å‡†ç¡®æ€§</h4>
<p>ç°åœ¨å»ºç«‹äº†å›å½’å™¨ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¯„ä»·å›å½’å™¨çš„æ‹Ÿåˆæ•ˆæœã€‚</p>
<ul>
<li><p>å¹³å‡ç»å¯¹è¯¯å·®ï¼ˆMean Absolute Errorï¼‰ï¼šç»™å®šæ•°æ®é›†çš„æ‰€æœ‰æ•°æ®ç‚¹çš„ç»å¯¹è¯¯å·®å¹³å‡å€¼ã€‚</p></li>
<li><p>å‡æ–¹è¯¯å·®ï¼ˆMean Squared Errorï¼‰ï¼šç»™å®šæ•°æ®é›†çš„æ‰€æœ‰æ•°æ®ç‚¹çš„è¯¯å·®çš„å¹³æ–¹çš„å¹³å‡å€¼ã€‚</p></li>
<li><p>ä¸­ä½æ•°ç»å¯¹è¯¯å·®ï¼ˆMedian Absolute Errorï¼‰ï¼šç»™å®šæ‰€æœ‰æ•°æ®é›†çš„æ‰€æœ‰æ•°æ®ç‚¹çš„è¯¯å·®çš„ä¸­ä½æ•°ã€‚è¿™ä¸ªæŒ‡æ ‡çš„ä¸»è¦ä¼˜ç‚¹æ˜¯å¯ä»¥æ¶ˆé™¤å¼‚å¸¸å€¼çš„å¹²æ‰°ã€‚</p></li>
<li><p>è§£é‡Šæ–¹å·®åˆ†ï¼ˆExplained Variance Scoreï¼‰ï¼šç”¨äºè¡¡é‡æ¨¡å‹å¯¹æ•°æ®é›†æ³¢åŠ¨çš„è§£é‡Šèƒ½åŠ›ï¼Œå¦‚æœå¾—åˆ†1.0åˆ†ï¼Œè¡¨æ˜æ¨¡å‹æ˜¯å®Œç¾çš„ã€‚</p></li>
<li><p>Ræ–¹å¾—åˆ†ï¼ˆR2 Scoreï¼‰ï¼šæŒ‡ç¡®å®šæ€§ç›¸å…³ç³»æ•°ï¼Œç”¨äºè¡¡é‡æ¨¡å‹å¯¹æœªçŸ¥æ ·æœ¬é¢„æµ‹çš„æ•ˆæœã€‚æœ€å¥½çš„å¾—åˆ†æ˜¯1.0ã€‚</p>
<p>ä¸€èˆ¬éƒ½æ˜¯ä¿è¯å‡æ–¹è¯¯å·®æœ€ä½ï¼Œè§£é‡Šæ–¹å·®åˆ†æœ€é«˜ã€‚</p>
<figure>
<img src="/images/r2.png" alt="r2"><figcaption>r2</figcaption>
</figure>
<figure>
<img src="/images/explained_variance.png" alt="explained_variance"><figcaption>explained_variance</figcaption>
</figure></li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="im">import</span> sklearn.metrics <span class="im">as</span> sm</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="bu">print</span> <span class="st">&quot;Mean absolute error =&quot;</span>, <span class="bu">round</span>(sm.mean_absolute_error(y_test, y_test_pred), <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="bu">print</span> <span class="st">&quot;Mean squared error =&quot;</span>, <span class="bu">round</span>(sm.mean_squared_error(y_test, y_test_pred), <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="bu">print</span> <span class="st">&quot;Median absolute error =&quot;</span>, <span class="bu">round</span>(sm.median_absolute_error(y_test, y_test_pred), <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="bu">print</span> <span class="st">&quot;Explained variance score =&quot;</span>, <span class="bu">round</span>(sm.explained_variance_score(y_test, y_test_pred), <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="bu">print</span> <span class="st">&quot;R2 score =&quot;</span>, <span class="bu">round</span>(sm.r2_score(y_test, y_test_pred), <span class="dv">2</span>)</a></code></pre></div>
<h4 id="äº”åˆ›å»ºå²­å›å½’å™¨">äº”ã€åˆ›å»ºå²­å›å½’å™¨</h4>
<p>çº¿æ€§å›å½’çš„ä¸»è¦é—®é¢˜æ˜¯å¯¹å¼‚å¸¸å€¼æ•æ„Ÿï¼Œç”±äºå¼‚å¸¸å€¼è¯¯å·®çš„ç»å¯¹å€¼å¾ˆå¤§ï¼Œå› æ­¤ä¼šå¼•èµ·é—®é¢˜ï¼Œä»è€Œç ´åæ•´ä¸ªæ¨¡å‹ã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œåˆ©ç”¨å²­å›å½’å¼•å…¥æ­£åˆ™åŒ–é¡¹çš„ç³»æ•°ä½œä¸ºé˜ˆå€¼æ¥æ¶ˆé™¤å¼‚å¸¸å€¼çš„å½±å“ã€‚</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="im">import</span> sys</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"></a>
<a class="sourceLine" id="cb10-5" data-line-number="5">filename <span class="op">=</span> sys.argv[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">X <span class="op">=</span> []</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">y <span class="op">=</span> []</a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="cf">with</span> <span class="bu">open</span>(filename, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> f:</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">    <span class="cf">for</span> line <span class="kw">in</span> f.readlines():</a>
<a class="sourceLine" id="cb10-10" data-line-number="10">        data <span class="op">=</span> [<span class="bu">float</span>(i) <span class="cf">for</span> i <span class="kw">in</span> line.split(<span class="st">&#39;,&#39;</span>)]</a>
<a class="sourceLine" id="cb10-11" data-line-number="11">        xt, yt <span class="op">=</span> data[:<span class="op">-</span><span class="dv">1</span>], data[<span class="op">-</span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb10-12" data-line-number="12">        X.append(xt)</a>
<a class="sourceLine" id="cb10-13" data-line-number="13">        y.append(yt)</a>
<a class="sourceLine" id="cb10-14" data-line-number="14">        </a>
<a class="sourceLine" id="cb10-15" data-line-number="15">num_training <span class="op">=</span> <span class="bu">int</span>(<span class="fl">0.8</span> <span class="op">*</span> <span class="bu">len</span>(X))</a>
<a class="sourceLine" id="cb10-16" data-line-number="16">num_test <span class="op">=</span> <span class="bu">len</span>(X) <span class="op">-</span> num_training</a>
<a class="sourceLine" id="cb10-17" data-line-number="17"></a>
<a class="sourceLine" id="cb10-18" data-line-number="18">X_train <span class="op">=</span> np.array(X[:num_training])</a>
<a class="sourceLine" id="cb10-19" data-line-number="19">y_train <span class="op">=</span> np.array(y[:num_training])</a>
<a class="sourceLine" id="cb10-20" data-line-number="20"></a>
<a class="sourceLine" id="cb10-21" data-line-number="21"><span class="im">from</span> sklearn <span class="im">import</span> linear_model</a>
<a class="sourceLine" id="cb10-22" data-line-number="22"></a>
<a class="sourceLine" id="cb10-23" data-line-number="23">linear_regressor <span class="op">=</span> linear_model.LinearRegression()</a>
<a class="sourceLine" id="cb10-24" data-line-number="24"><span class="co"># alphaå‚æ•°æ§åˆ¶å›å½’å™¨çš„å¤æ‚ç¨‹åº¦ï¼Œå½“alphaè¶‹äº0æ—¶ï¼Œå²­å›å½’å°±æ˜¯ç”¨æ™®é€šæœ€å°äºŒä¹˜æ³•çš„çº¿å½¢å›å½’å™¨</span></a>
<a class="sourceLine" id="cb10-25" data-line-number="25"><span class="co"># å¦‚æœå¸Œæœ›æ¨¡å‹å¯¹å¼‚å¸¸å€¼ä¸é‚£ä¹ˆæ•æ„Ÿï¼Œå°±éœ€è¦è®¾ç½®ä¸€ä¸ªè¾ƒå¤§çš„alphaå€¼</span></a>
<a class="sourceLine" id="cb10-26" data-line-number="26">ridge_regressor <span class="op">=</span> linear_model.Ridge(alpha<span class="op">=</span><span class="fl">0.01</span>, fit_intercept<span class="op">=</span><span class="va">True</span>, max_iter<span class="op">=</span><span class="dv">10000</span>)</a>
<a class="sourceLine" id="cb10-27" data-line-number="27"></a>
<a class="sourceLine" id="cb10-28" data-line-number="28">linear_regressor.fit(X_train, y_train)</a>
<a class="sourceLine" id="cb10-29" data-line-number="29">ridge_regressor.fit(X_train, y_train)</a>
<a class="sourceLine" id="cb10-30" data-line-number="30"></a>
<a class="sourceLine" id="cb10-31" data-line-number="31">y_test_pred <span class="op">=</span> linear_regressor.predict(X_test)</a>
<a class="sourceLine" id="cb10-32" data-line-number="32">y_test_pred_ridge <span class="op">=</span> ridge_regressor.predict(X_test)</a>
<a class="sourceLine" id="cb10-33" data-line-number="33"></a>
<a class="sourceLine" id="cb10-34" data-line-number="34"><span class="im">import</span> sklearn.metrics <span class="im">as</span> sm</a>
<a class="sourceLine" id="cb10-35" data-line-number="35"></a>
<a class="sourceLine" id="cb10-36" data-line-number="36"><span class="bu">print</span> <span class="st">&quot;LINEAR:&quot;</span></a>
<a class="sourceLine" id="cb10-37" data-line-number="37"><span class="bu">print</span> <span class="st">&quot;Mean absolute error =&quot;</span>, <span class="bu">round</span>(sm.mean_absolute_error(y_test, y_test_pred), <span class="dv">2</span>) </a>
<a class="sourceLine" id="cb10-38" data-line-number="38"><span class="bu">print</span> <span class="st">&quot;Mean squared error =&quot;</span>, <span class="bu">round</span>(sm.mean_squared_error(y_test, y_test_pred), <span class="dv">2</span>) </a>
<a class="sourceLine" id="cb10-39" data-line-number="39"><span class="bu">print</span> <span class="st">&quot;Median absolute error =&quot;</span>, <span class="bu">round</span>(sm.median_absolute_error(y_test, y_test_pred), <span class="dv">2</span>) </a>
<a class="sourceLine" id="cb10-40" data-line-number="40"><span class="bu">print</span> <span class="st">&quot;Explained variance score =&quot;</span>, <span class="bu">round</span>(sm.explained_variance_score(y_test, y_test_pred), <span class="dv">2</span>) </a>
<a class="sourceLine" id="cb10-41" data-line-number="41"><span class="bu">print</span> <span class="st">&quot;R2 score =&quot;</span>, <span class="bu">round</span>(sm.r2_score(y_test, y_test_pred), <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb10-42" data-line-number="42"></a>
<a class="sourceLine" id="cb10-43" data-line-number="43"><span class="bu">print</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">RIDGE:&quot;</span></a>
<a class="sourceLine" id="cb10-44" data-line-number="44"><span class="bu">print</span> <span class="st">&quot;Mean absolute error =&quot;</span>, <span class="bu">round</span>(sm.mean_absolute_error(y_test, y_test_pred_ridge), <span class="dv">2</span>) </a>
<a class="sourceLine" id="cb10-45" data-line-number="45"><span class="bu">print</span> <span class="st">&quot;Mean squared error =&quot;</span>, <span class="bu">round</span>(sm.mean_squared_error(y_test, y_test_pred_ridge), <span class="dv">2</span>) </a>
<a class="sourceLine" id="cb10-46" data-line-number="46"><span class="bu">print</span> <span class="st">&quot;Median absolute error =&quot;</span>, <span class="bu">round</span>(sm.median_absolute_error(y_test, y_test_pred_ridge), <span class="dv">2</span>) </a>
<a class="sourceLine" id="cb10-47" data-line-number="47"><span class="bu">print</span> <span class="st">&quot;Explained variance score =&quot;</span>, <span class="bu">round</span>(sm.explained_variance_score(y_test, y_test_pred_ridge), <span class="dv">2</span>) </a>
<a class="sourceLine" id="cb10-48" data-line-number="48"><span class="bu">print</span> <span class="st">&quot;R2 score =&quot;</span>, <span class="bu">round</span>(sm.r2_score(y_test, y_test_pred_ridge), <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb10-49" data-line-number="49"></a>
<a class="sourceLine" id="cb10-50" data-line-number="50">[Result]</a>
<a class="sourceLine" id="cb10-51" data-line-number="51">LINEAR:</a>
<a class="sourceLine" id="cb10-52" data-line-number="52">Mean absolute error <span class="op">=</span> <span class="fl">3.95</span></a>
<a class="sourceLine" id="cb10-53" data-line-number="53">Mean squared error <span class="op">=</span> <span class="fl">23.15</span></a>
<a class="sourceLine" id="cb10-54" data-line-number="54">Median absolute error <span class="op">=</span> <span class="fl">3.69</span></a>
<a class="sourceLine" id="cb10-55" data-line-number="55">Explained variance score <span class="op">=</span> <span class="fl">0.84</span></a>
<a class="sourceLine" id="cb10-56" data-line-number="56">R2 score <span class="op">=</span> <span class="fl">0.83</span></a>
<a class="sourceLine" id="cb10-57" data-line-number="57"></a>
<a class="sourceLine" id="cb10-58" data-line-number="58">RIDGE:</a>
<a class="sourceLine" id="cb10-59" data-line-number="59">Mean absolute error <span class="op">=</span> <span class="fl">3.95</span></a>
<a class="sourceLine" id="cb10-60" data-line-number="60">Mean squared error <span class="op">=</span> <span class="fl">23.15</span></a>
<a class="sourceLine" id="cb10-61" data-line-number="61">Median absolute error <span class="op">=</span> <span class="fl">3.69</span></a>
<a class="sourceLine" id="cb10-62" data-line-number="62">Explained variance score <span class="op">=</span> <span class="fl">0.84</span></a>
<a class="sourceLine" id="cb10-63" data-line-number="63">R2 score <span class="op">=</span> <span class="fl">0.83</span></a></code></pre></div>
<h4 id="å…­åˆ›å»ºå¤šé¡¹å¼å›å½’å™¨">å…­ã€åˆ›å»ºå¤šé¡¹å¼å›å½’å™¨</h4>
<p>çº¿æ€§å›å½’æ¨¡å‹æœ‰ä¸€ä¸ªä¸»è¦çš„å±€é™æ€§ï¼Œå°±æ˜¯åªèƒ½æŠŠè¾“å…¥æ•°æ®æ‹Ÿåˆæˆç›´çº¿ï¼Œè€Œå¤šé¡¹å¼å›å½’æ¨¡å‹é€šè¿‡æ‹Ÿåˆå¤šé¡¹å¼æ–¹ç¨‹å¼æ¥å…‹æœè¿™ç±»é—®é¢˜ï¼Œä»è€Œæé«˜æ¨¡å‹çš„å‡†ç¡®æ€§ã€‚</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> PolynomialFeatures</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co"># æŠŠå¤šé¡¹å¼çš„æ¬¡æ•°è®¾ç½®ä¸º10</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4">polynomial <span class="op">=</span> PolynomialFeatures(degree<span class="op">=</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">X_train_transformed <span class="op">=</span> polynomial.fit_transform(X_train)</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">datapoint <span class="op">=</span> [<span class="fl">0.39</span>, <span class="fl">2.78</span>, <span class="fl">7.11</span>]</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">poly_datapoint <span class="op">=</span> polynomial.fit_transform(datapoint)</a>
<a class="sourceLine" id="cb11-8" data-line-number="8"></a>
<a class="sourceLine" id="cb11-9" data-line-number="9">poly_linear_model <span class="op">=</span> linear_model.LinearRegression()</a>
<a class="sourceLine" id="cb11-10" data-line-number="10">poly_linear_model.fit(X_train_transformed, y_train)</a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="bu">print</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Linear regression:</span><span class="ch">\n</span><span class="st">&quot;</span>, linear_regressor.predict(datapoint)[<span class="dv">0</span>]</a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="bu">print</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Polynomial regression:</span><span class="ch">\n</span><span class="st">&quot;</span>, poly_linear_model.predict(poly_datapoint)[<span class="dv">0</span>]</a>
<a class="sourceLine" id="cb11-13" data-line-number="13"></a>
<a class="sourceLine" id="cb11-14" data-line-number="14">sgd_regressor <span class="op">=</span> linear_model.SGDRegressor(loss<span class="op">=</span><span class="st">&#39;huber&#39;</span>, n_iter<span class="op">=</span><span class="dv">50</span>)</a>
<a class="sourceLine" id="cb11-15" data-line-number="15">sgd_regressor.fit(X_train, y_train)</a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="bu">print</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">SGD regressor:</span><span class="ch">\n</span><span class="st">&quot;</span>, sgd_regressor.predict(datapoint)</a>
<a class="sourceLine" id="cb11-17" data-line-number="17"></a>
<a class="sourceLine" id="cb11-18" data-line-number="18">[Result]</a>
<a class="sourceLine" id="cb11-19" data-line-number="19">Linear regression:</a>
<a class="sourceLine" id="cb11-20" data-line-number="20">[<span class="op">-</span><span class="fl">11.0587295</span>]</a>
<a class="sourceLine" id="cb11-21" data-line-number="21"></a>
<a class="sourceLine" id="cb11-22" data-line-number="22">Polynomial regression:</a>
<a class="sourceLine" id="cb11-23" data-line-number="23">[<span class="op">-</span><span class="fl">8.149308</span>]</a>
<a class="sourceLine" id="cb11-24" data-line-number="24"></a>
<a class="sourceLine" id="cb11-25" data-line-number="25">SGD regressor:</a>
<a class="sourceLine" id="cb11-26" data-line-number="26">[<span class="op">-</span><span class="fl">7.9607662</span>]</a></code></pre></div>
<h4 id="ä¸ƒä¼°ç®—æˆ¿å±‹ä»·æ ¼">ä¸ƒã€ä¼°ç®—æˆ¿å±‹ä»·æ ¼</h4>
<p>ä¸‹é¢å°†ä½¿ç”¨<code>AdaBoost</code>ç®—æ³•çš„å†³ç­–æ ‘å›å½’å™¨(<code>decision tree regressor</code>)æ¥è§£å†³æˆ¿å±‹ä¼°ä»·è¿™ä¸€é—®é¢˜ã€‚</p>
<p>å†³ç­–æ ‘æ˜¯ä¸€ä¸ªæ ‘çŠ¶æ¨¡å‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½åšå‡ºä¸€ä¸ªå†³ç­–ï¼Œä»è€Œå½±å“ç»“æœã€‚å¶å­èŠ‚ç‚¹è¡¨ç¤ºè¾“å‡ºæ•°å€¼ï¼Œåˆ†æ”¯è¡¨ç¤ºæ ¹æ®è¾“å…¥ç‰¹å¾åšå‡ºçš„ä¸­é—´å†³ç­–ã€‚<code>Adaboost</code>ç®—æ³•æ˜¯æŒ‡è‡ªé€‚åº”å¢å¼º(<code>Adaptive boosting</code>)ç®—æ³•ï¼Œè¿™æ˜¯ä¸€ç§åˆ©ç”¨å…¶ä»–ç³»ç»Ÿå¢å¼ºæ¨¡å‹å‡†ç¡®æ€§çš„æŠ€æœ¯ã€‚è¿™ç§æŠ€æœ¯å°†ä¸åŒç‰ˆæœ¬çš„ç®—æ³•ç»“æœè¿›è¡Œç»„åˆï¼Œç”¨åŠ æƒæ±‡æ€»çš„æ–¹å¼è·å¾—æœ€ç»ˆç»“æœï¼Œè¢«ç§°ä¸ºå¼±å­¦ä¹ (<code>weak learners</code>)ã€‚<code>Adaboost</code>ç®—æ³•åœ¨æ¯ä¸ªé˜¶æ®µè·å–çš„ä¿¡æ¯éƒ½ä¼šåé¦ˆåˆ°æ¨¡å‹ä¸­ï¼Œè¿™æ ·å­¦ä¹ å™¨å°±å¯ä»¥åœ¨åä¸€é˜¶æ®µé‡ç‚¹è®­ç»ƒéš¾ä»¥åˆ†ç±»çš„æ ·æœ¬ã€‚è¿™ç§å­¦ä¹ æ–¹å¼å¯ä»¥å¢å¼ºç³»ç»Ÿçš„å‡†ç¡®æ€§ã€‚</p>
<p>é¦–å…ˆä½¿ç”¨<code>Adaboost</code>ç®—æ³•å¯¹æ•°æ®é›†åˆè¿›è¡Œå›å½’æ‹Ÿåˆï¼Œå†è®¡ç®—è¯¯å·®ï¼Œç„¶åæ ¹æ®è¯¯å·®è¯„ä¼°ç»“æœï¼Œç”¨åŒæ ·çš„æ•°æ®é›†é‡æ–°æ‹Ÿåˆã€‚å¯ä»¥æŠŠè¿™äº›çœ‹ä½œæ˜¯å›å½’å™¨çš„è°ƒä¼˜è¿‡ç¨‹ï¼Œç›´åˆ°è¾¾åˆ°é¢„æœŸçš„å‡†ç¡®æ€§ã€‚</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor, AdaBoostRegressor</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeRegressor</a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="im">from</span> sklearn <span class="im">import</span> datasets</a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, explained_variance_score</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="im">from</span> sklearn.utils <span class="im">import</span> shuffle</a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</a>
<a class="sourceLine" id="cb12-8" data-line-number="8"></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="kw">def</span> plot_feature_importance(feature_importances, title, feature_names):</a>
<a class="sourceLine" id="cb12-10" data-line-number="10">    <span class="co"># Normalize the importance values</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11">    feature_importances <span class="op">=</span> <span class="fl">100.0</span> <span class="op">*</span> (feature_importances <span class="op">/</span> <span class="bu">max</span>(feature_importances))</a>
<a class="sourceLine" id="cb12-12" data-line-number="12">    </a>
<a class="sourceLine" id="cb12-13" data-line-number="13">    <span class="co"># å°†å¾—åˆ†ä»é«˜åˆ°ä½æ’åº</span></a>
<a class="sourceLine" id="cb12-14" data-line-number="14">    index_sorted <span class="op">=</span> np.flipud(np.argsort(feature_importances))</a>
<a class="sourceLine" id="cb12-15" data-line-number="15">    </a>
<a class="sourceLine" id="cb12-16" data-line-number="16">    <span class="co"># Arrange the X ticks</span></a>
<a class="sourceLine" id="cb12-17" data-line-number="17">    pos <span class="op">=</span> np.arange(index_sorted.shape[<span class="dv">0</span>]) <span class="op">+</span> <span class="fl">0.5</span></a>
<a class="sourceLine" id="cb12-18" data-line-number="18">    </a>
<a class="sourceLine" id="cb12-19" data-line-number="19">    <span class="co"># Plot the bar graph</span></a>
<a class="sourceLine" id="cb12-20" data-line-number="20">    plt.figure()</a>
<a class="sourceLine" id="cb12-21" data-line-number="21">    plt.bar(pos, feature_importances[index_sorted], align<span class="op">=</span><span class="st">&#39;center&#39;</span>)</a>
<a class="sourceLine" id="cb12-22" data-line-number="22">    plt.xticks(pos, feature_names[index_sorted])</a>
<a class="sourceLine" id="cb12-23" data-line-number="23">    plt.ylabel(<span class="st">&#39;Relative Importances&#39;</span>)</a>
<a class="sourceLine" id="cb12-24" data-line-number="24">    plt.title(title)</a>
<a class="sourceLine" id="cb12-25" data-line-number="25">    plt.show()</a>
<a class="sourceLine" id="cb12-26" data-line-number="26">    </a>
<a class="sourceLine" id="cb12-27" data-line-number="27"><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</a>
<a class="sourceLine" id="cb12-28" data-line-number="28">    </a>
<a class="sourceLine" id="cb12-29" data-line-number="29">    <span class="co"># Load housing data</span></a>
<a class="sourceLine" id="cb12-30" data-line-number="30">    housing_data <span class="op">=</span> datasets.load_boston()</a>
<a class="sourceLine" id="cb12-31" data-line-number="31">    </a>
<a class="sourceLine" id="cb12-32" data-line-number="32">    <span class="co"># Shuffle the data</span></a>
<a class="sourceLine" id="cb12-33" data-line-number="33">    X, y <span class="op">=</span> shuffle(housing_data, data, housing_data.target, random_state<span class="op">=</span><span class="dv">7</span>)</a>
<a class="sourceLine" id="cb12-34" data-line-number="34">    </a>
<a class="sourceLine" id="cb12-35" data-line-number="35">    num_training <span class="op">=</span> <span class="bu">int</span>(<span class="fl">0.8</span> <span class="op">*</span> <span class="bu">len</span>(X))</a>
<a class="sourceLine" id="cb12-36" data-line-number="36">    X_train, y_train <span class="op">=</span> X[:num_training], y[:num_training]</a>
<a class="sourceLine" id="cb12-37" data-line-number="37">    X_test, y_test <span class="op">=</span> X[num_training:], y[num_training:]</a>
<a class="sourceLine" id="cb12-38" data-line-number="38">    </a>
<a class="sourceLine" id="cb12-39" data-line-number="39">    <span class="co"># Fit decision tree regression model</span></a>
<a class="sourceLine" id="cb12-40" data-line-number="40">    dt_regressor <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb12-41" data-line-number="41">    dt_regressor.fit(X_train, y_train)</a>
<a class="sourceLine" id="cb12-42" data-line-number="42">    </a>
<a class="sourceLine" id="cb12-43" data-line-number="43">    <span class="co"># Fit decision tree regression model with AdaBoost</span></a>
<a class="sourceLine" id="cb12-44" data-line-number="44">    ab_regressor <span class="op">=</span> AdaBoostRegressor(DecisionTreeRegressor(max_depth<span class="op">=</span><span class="dv">4</span>), n_estimators<span class="op">=</span><span class="dv">400</span>, random_state<span class="op">=</span><span class="dv">7</span>)</a>
<a class="sourceLine" id="cb12-45" data-line-number="45">    </a>
<a class="sourceLine" id="cb12-46" data-line-number="46">    <span class="co"># Evaluate performance of Decision Tree regressor</span></a>
<a class="sourceLine" id="cb12-47" data-line-number="47">    y_pred_dt <span class="op">=</span> dt_regressor.predict(X_test)</a>
<a class="sourceLine" id="cb12-48" data-line-number="48">    mse <span class="op">=</span> mean_squared_error(y_test, y_pred_dt)</a>
<a class="sourceLine" id="cb12-49" data-line-number="49">    env <span class="op">=</span> explained_variance_score(y_test, y_pred_dt)</a>
<a class="sourceLine" id="cb12-50" data-line-number="50">    <span class="bu">print</span> <span class="st">&quot;####</span><span class="ch">\n</span><span class="st"> Decision Tree performance ####&quot;</span></a>
<a class="sourceLine" id="cb12-51" data-line-number="51">    <span class="bu">print</span> <span class="st">&quot;Mean squared error =&quot;</span>, <span class="bu">round</span>(mse, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb12-52" data-line-number="52">    <span class="bu">print</span> <span class="st">&quot;Explained variance score =&quot;</span>, <span class="bu">round</span>(evs, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb12-53" data-line-number="53">    </a>
<a class="sourceLine" id="cb12-54" data-line-number="54">    <span class="co"># Evaluate performance of AdaBoost</span></a>
<a class="sourceLine" id="cb12-55" data-line-number="55">    y_pred_dt_ab <span class="op">=</span> dt_regressor.predict(X_test)</a>
<a class="sourceLine" id="cb12-56" data-line-number="56">    mse <span class="op">=</span> mean_squared_error(y_test, y_pred_dt_ab)</a>
<a class="sourceLine" id="cb12-57" data-line-number="57">    env <span class="op">=</span> explained_variance_score(y_test, y_pred_dt_ab)</a>
<a class="sourceLine" id="cb12-58" data-line-number="58">    <span class="bu">print</span> <span class="st">&quot;####</span><span class="ch">\n</span><span class="st"> Decision Tree performance ####&quot;</span></a>
<a class="sourceLine" id="cb12-59" data-line-number="59">    <span class="bu">print</span> <span class="st">&quot;Mean squared error =&quot;</span>, <span class="bu">round</span>(mse, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb12-60" data-line-number="60">    <span class="bu">print</span> <span class="st">&quot;Explained variance score =&quot;</span>, <span class="bu">round</span>(evs, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb12-61" data-line-number="61">    </a>
<a class="sourceLine" id="cb12-62" data-line-number="62">    <span class="co"># Plot relative feature importances</span></a>
<a class="sourceLine" id="cb12-63" data-line-number="63">    plot_feature_importances(dt_regressor.feature_importances_,</a>
<a class="sourceLine" id="cb12-64" data-line-number="64">                            <span class="st">&#39;Decision Tree regressor&#39;</span>, housing_data.feature_names)</a>
<a class="sourceLine" id="cb12-65" data-line-number="65">    plot_feature_importances(ab_regressor.feature_importances_,</a>
<a class="sourceLine" id="cb12-66" data-line-number="66">                            <span class="st">&#39;AdaBoost regressor&#39;</span>, housing_data.feature_names)</a>
<a class="sourceLine" id="cb12-67" data-line-number="67">    </a>
<a class="sourceLine" id="cb12-68" data-line-number="68">[Result]</a>
<a class="sourceLine" id="cb12-69" data-line-number="69"><span class="co">#### Decision Tree performance ####</span></a>
<a class="sourceLine" id="cb12-70" data-line-number="70">Mean squared error <span class="op">=</span> <span class="fl">14.79</span></a>
<a class="sourceLine" id="cb12-71" data-line-number="71">Explained variance score <span class="op">=</span> <span class="fl">0.82</span></a>
<a class="sourceLine" id="cb12-72" data-line-number="72"></a>
<a class="sourceLine" id="cb12-73" data-line-number="73"><span class="co">#### AdaBoost performance ####</span></a>
<a class="sourceLine" id="cb12-74" data-line-number="74">Mean squared error <span class="op">=</span> <span class="fl">7.64</span></a>
<a class="sourceLine" id="cb12-75" data-line-number="75">Explained variance score <span class="op">=</span> <span class="fl">0.91</span></a></code></pre></div>
<figure>
<img src="/images/Decision_tree.png" alt="AdaBoost"><figcaption>AdaBoost</figcaption>
</figure>
<figure>
<img src="/images/Decision_tree.png" alt="Decision_tree"><figcaption>Decision_tree</figcaption>
</figure>
<h4 id="å…«è¯„ä¼°å…±äº«å•è½¦çš„éœ€æ±‚åˆ†å¸ƒ">å…«ã€è¯„ä¼°å…±äº«å•è½¦çš„éœ€æ±‚åˆ†å¸ƒ</h4>
<p>ä¸‹é¢ç”¨éšæœºæ£®æ—å›å½’å™¨(<code>random forest regressor</code>)æ¥è§£å†³å…±äº«å•è½¦çš„éœ€æ±‚åˆ†å¸ƒé—®é¢˜ã€‚éšæœºæ£®æ—æ˜¯ä¸€ä¸ªå†³ç­–æ ‘é›†åˆï¼Œå®ƒåŸºæœ¬ä¸Šå°±æ˜¯ç”¨ä¸€ç»„ç”±æ•°æ®é›†çš„è‹¥å¹²å­é›†æ„å»ºçš„å†³ç­–æ ‘æ„æˆï¼Œå†ç”¨å†³ç­–æ ‘å¹³å‡å€¼æ”¹å–„æ•´ä½“å­¦ä¹ æ•ˆæœã€‚</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="im">from</span> sklearn <span class="im">import</span> preprocessing</a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, explained_variance_score</a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="im">from</span> sklearn.utils <span class="im">import</span> shuffle</a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</a>
<a class="sourceLine" id="cb13-7" data-line-number="7"></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="im">from</span> housing <span class="im">import</span> plot_feature_importances</a>
<a class="sourceLine" id="cb13-9" data-line-number="9"></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="kw">def</span> load_dataset(filename):</a>
<a class="sourceLine" id="cb13-11" data-line-number="11">    file_reader <span class="op">=</span> csv.reader(<span class="bu">open</span>(filename, <span class="st">&#39;rb&#39;</span>), delimiter<span class="op">=</span><span class="st">&#39;,&#39;</span>)</a>
<a class="sourceLine" id="cb13-12" data-line-number="12">    X, y <span class="op">=</span> [], []</a>
<a class="sourceLine" id="cb13-13" data-line-number="13">    <span class="cf">for</span> row <span class="kw">in</span> file_reader:</a>
<a class="sourceLine" id="cb13-14" data-line-number="14">        X.append(row[<span class="dv">2</span>:<span class="dv">13</span>])</a>
<a class="sourceLine" id="cb13-15" data-line-number="15">        y.append(row[<span class="op">-</span><span class="dv">1</span>])</a>
<a class="sourceLine" id="cb13-16" data-line-number="16">    </a>
<a class="sourceLine" id="cb13-17" data-line-number="17">    <span class="co"># Extract feature names</span></a>
<a class="sourceLine" id="cb13-18" data-line-number="18">    features_names <span class="op">=</span> np.array(X[<span class="dv">0</span>])</a>
<a class="sourceLine" id="cb13-19" data-line-number="19">    </a>
<a class="sourceLine" id="cb13-20" data-line-number="20">    <span class="co"># Remove the first row because they are feature names</span></a>
<a class="sourceLine" id="cb13-21" data-line-number="21">    <span class="cf">return</span> np.array(X[<span class="dv">1</span>:]).astype(np.float32), np.array(y[<span class="dv">1</span>:]).astype(np.float32), feature_names</a>
<a class="sourceLine" id="cb13-22" data-line-number="22"></a>
<a class="sourceLine" id="cb13-23" data-line-number="23"><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</a>
<a class="sourceLine" id="cb13-24" data-line-number="24">    </a>
<a class="sourceLine" id="cb13-25" data-line-number="25">    <span class="co"># Load the dataset from the input file</span></a>
<a class="sourceLine" id="cb13-26" data-line-number="26">    X, y, feature_names <span class="op">=</span> load_datasets(sys.argv[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb13-27" data-line-number="27">    X, y <span class="op">=</span> shuffle(X, y, random_state<span class="op">=</span><span class="dv">7</span>)</a>
<a class="sourceLine" id="cb13-28" data-line-number="28">    </a>
<a class="sourceLine" id="cb13-29" data-line-number="29">    <span class="co"># Split the data</span></a>
<a class="sourceLine" id="cb13-30" data-line-number="30">    num_training <span class="op">=</span> <span class="bu">int</span>(<span class="fl">0.9</span> <span class="op">*</span> <span class="bu">len</span>(X))</a>
<a class="sourceLine" id="cb13-31" data-line-number="31">    X_train, y_train <span class="op">=</span> X[:num_training], y[:num_training]</a>
<a class="sourceLine" id="cb13-32" data-line-number="32">    X_test, y_test <span class="op">=</span> X[num_training:], y[num_training:]</a>
<a class="sourceLine" id="cb13-33" data-line-number="33">    </a>
<a class="sourceLine" id="cb13-34" data-line-number="34">    <span class="co"># Fit Random Forest regression model</span></a>
<a class="sourceLine" id="cb13-35" data-line-number="35">    <span class="co"># n_estimatoræ˜¯è¯„ä¼°å™¨çš„æ•°é‡ï¼Œè¡¨ç¤ºéšæœºæ£®æ—éœ€è¦ä½¿ç”¨çš„å†³ç­–æ ‘æ•°é‡</span></a>
<a class="sourceLine" id="cb13-36" data-line-number="36">    <span class="co"># max_depthæ˜¯æŒ‡æ¯ä¸ªå†³ç­–æ ‘çš„æœ€å¤§æ·±åº¦</span></a>
<a class="sourceLine" id="cb13-37" data-line-number="37">    <span class="co"># min_samples_splitæ˜¯æŒ‡å†³ç­–æ ‘åˆ†è£‚ä¸€ä¸ªèŠ‚ç‚¹éœ€è¦ç”¨åˆ°çš„æœ€å°æ•°æ®æ ·æœ¬é‡</span></a>
<a class="sourceLine" id="cb13-38" data-line-number="38">    rf_regressor <span class="op">=</span> RandomForestRegressor(n_estimator<span class="op">=</span><span class="dv">1000</span>, max_depth<span class="op">=</span><span class="dv">10</span>, min_samples_split<span class="op">=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb13-39" data-line-number="39">    rf_regressor.fit(X_train, y_train)</a>
<a class="sourceLine" id="cb13-40" data-line-number="40">    </a>
<a class="sourceLine" id="cb13-41" data-line-number="41">    y_pred <span class="op">=</span> rf_regressor.predict(X_test)</a>
<a class="sourceLine" id="cb13-42" data-line-number="42">    mse <span class="op">=</span> mean_squared_error(y_test, y_pred)</a>
<a class="sourceLine" id="cb13-43" data-line-number="43">    evs <span class="op">=</span> explained_variance_score(y_test, y_pred)</a>
<a class="sourceLine" id="cb13-44" data-line-number="44">    <span class="bu">print</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st"> #### Random Forest regressor performance ####&quot;</span></a>
<a class="sourceLine" id="cb13-45" data-line-number="45">    <span class="bu">print</span> <span class="st">&quot;Mean squared error =&quot;</span>, <span class="bu">round</span>(mse, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb13-46" data-line-number="46">    <span class="bu">print</span> <span class="st">&quot;Explained variance score = &quot;</span>, <span class="bu">round</span>(mse, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb13-47" data-line-number="47"></a>
<a class="sourceLine" id="cb13-48" data-line-number="48">[Result]</a>
<a class="sourceLine" id="cb13-49" data-line-number="49"><span class="co">#### Random Forest regressor performance ####</span></a>
<a class="sourceLine" id="cb13-50" data-line-number="50">Mean squared error <span class="op">=</span> <span class="fl">362009.79</span></a>
<a class="sourceLine" id="cb13-51" data-line-number="51">Explained variance score <span class="op">=</span> <span class="fl">0.89</span></a></code></pre></div>
<figure>
<img src="/images/By%20day.png" alt="By day"><figcaption>By day</figcaption>
</figure>
<figure>
<img src="/images/By%20hour.png" alt="By hour"><figcaption>By hour</figcaption>
</figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/30/ã€ŠPythonè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°ä¸‰/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Peter Tsung">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/pandas.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å½¼å¾—çš„åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/30/ã€ŠPythonè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°ä¸‰/" itemprop="url">
                  ã€ŠPythonè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°ä¸‰
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-07-30T19:33:21+08:00">
                2017-07-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-Notes/" itemprop="url" rel="index">
                    <span itemprop="name">Python_Notes</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è¿™å‘¨çš„å­¦ä¹ è®¡åˆ’æ˜¯é˜…è¯»<code>å‘½ä»¤æ¨¡å¼</code>ã€<code>è§£é‡Šå™¨æ¨¡å¼</code>ã€<code>è§‚å¯Ÿè€…æ¨¡å¼</code>å’Œ<code>æ¨¡ç‰ˆæ¨¡å¼</code>ã€‚</p>
<p><u>å‘½ä»¤æ¨¡å¼</u></p>
<p>å‘½ä»¤è®¾è®¡æ¨¡å¼å¸®åŠ©æˆ‘ä»¬å°†ä¸€ä¸ªæ“ä½œï¼ˆæ’¤é”€ã€é‡åšã€å¤åˆ¶ã€ç²˜è´´ç­‰ï¼‰å°è£…ä¸€ä¸ªå¯¹è±¡ã€‚è¿™æ„å‘³ç€åˆ›å»ºä¸€ä¸ªç±»ï¼ŒåŒ…å«å®è¯¥æ“ä½œæ‰€éœ€è¦çš„æ‰€æœ‰é€»è¾‘å’Œæ–¹æ³•ã€‚</p>
<p>ä¸‹é¢çš„ä¾‹å­æ˜¯ä½¿ç”¨å‘½ä»¤æ¨¡å¼å®ç°æœ€åŸºæœ¬çš„æ–‡ä»¶æ“ä½œå·¥å…·ã€‚</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶éšæ„å†™å…¥ä¸€ä¸ªå­—ç¬¦ä¸²</li>
<li>è¯»å–ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹</li>
<li>é‡å‘½åä¸€ä¸ªæ–‡ä»¶</li>
<li>åˆ é™¤ä¸€ä¸ªæ–‡ä»¶</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="im">import</span> os </a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">verbose <span class="op">=</span> <span class="va">True</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw">class</span> RenameFile:</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, path_src, path_dest):</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">        <span class="va">self</span>.src, <span class="va">self</span>.dest <span class="op">=</span> path_src, path_dest</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">        </a>
<a class="sourceLine" id="cb1-9" data-line-number="9">    <span class="kw">def</span> execute(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">        <span class="cf">if</span> verbose:</a>
<a class="sourceLine" id="cb1-11" data-line-number="11">            <span class="bu">print</span>(<span class="st">&quot;[renaming &#39;</span><span class="sc">{}</span><span class="st">&#39; to &#39;</span><span class="sc">{}</span><span class="st">&#39;&quot;</span>.<span class="bu">format</span>(<span class="va">self</span>.src, <span class="va">self</span>.dest))</a>
<a class="sourceLine" id="cb1-12" data-line-number="12">        os.rename(<span class="va">self</span>.src, <span class="va">self</span>.dest)</a>
<a class="sourceLine" id="cb1-13" data-line-number="13">    </a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="kw">class</span> CreateFile:</a>
<a class="sourceLine" id="cb1-15" data-line-number="15">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, path, txt<span class="op">=</span><span class="st">&#39;hello world</span><span class="ch">\n</span><span class="st">&#39;</span>):</a>
<a class="sourceLine" id="cb1-16" data-line-number="16">        <span class="va">self</span>.path, <span class="va">self</span>.txt <span class="op">=</span> path, txt</a>
<a class="sourceLine" id="cb1-17" data-line-number="17">    </a>
<a class="sourceLine" id="cb1-18" data-line-number="18">    <span class="kw">def</span> execute(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb1-19" data-line-number="19">        <span class="cf">if</span> verbose:</a>
<a class="sourceLine" id="cb1-20" data-line-number="20">            <span class="bu">print</span>(<span class="st">&quot;[creating file &#39;</span><span class="sc">{}</span><span class="st">&#39;]&quot;</span>.<span class="bu">format</span>(<span class="va">self</span>.path))</a>
<a class="sourceLine" id="cb1-21" data-line-number="21">        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.path, mode<span class="op">=</span><span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> out_file:</a>
<a class="sourceLine" id="cb1-22" data-line-number="22">            out_file.write(<span class="va">self</span>.txt)</a>
<a class="sourceLine" id="cb1-23" data-line-number="23">    </a>
<a class="sourceLine" id="cb1-24" data-line-number="24">    <span class="kw">def</span> undo(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb1-25" data-line-number="25">        delete_file(<span class="va">self</span>.path)</a>
<a class="sourceLine" id="cb1-26" data-line-number="26">    </a>
<a class="sourceLine" id="cb1-27" data-line-number="27"><span class="kw">class</span> ReadFile:</a>
<a class="sourceLine" id="cb1-28" data-line-number="28">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, path):</a>
<a class="sourceLine" id="cb1-29" data-line-number="29">        <span class="va">self</span>.path <span class="op">=</span> path</a>
<a class="sourceLine" id="cb1-30" data-line-number="30">        </a>
<a class="sourceLine" id="cb1-31" data-line-number="31">    <span class="kw">def</span> execute(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb1-32" data-line-number="32">        <span class="cf">if</span> verbose:</a>
<a class="sourceLine" id="cb1-33" data-line-number="33">            <span class="bu">print</span>(<span class="st">&quot;[reading file &#39;</span><span class="sc">{}</span><span class="st">&#39;]&quot;</span>.<span class="bu">format</span>(<span class="va">self</span>.path))</a>
<a class="sourceLine" id="cb1-34" data-line-number="34">        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.path, mode<span class="op">=</span><span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> in_file:</a>
<a class="sourceLine" id="cb1-35" data-line-number="35">            <span class="bu">print</span>(in_file.read(), end<span class="op">=</span><span class="st">&#39;&#39;</span>)</a>
<a class="sourceLine" id="cb1-36" data-line-number="36">            </a>
<a class="sourceLine" id="cb1-37" data-line-number="37"><span class="kw">def</span> delete_file(path):</a>
<a class="sourceLine" id="cb1-38" data-line-number="38">    <span class="cf">if</span> verbose:</a>
<a class="sourceLine" id="cb1-39" data-line-number="39">        <span class="bu">print</span>(<span class="st">&quot;deleting file &#39;</span><span class="sc">{}</span><span class="st">&#39;&quot;</span>.<span class="bu">format</span>(path))</a>
<a class="sourceLine" id="cb1-40" data-line-number="40">    os.remove(path)</a>
<a class="sourceLine" id="cb1-41" data-line-number="41"></a>
<a class="sourceLine" id="cb1-42" data-line-number="42"><span class="kw">def</span> main():</a>
<a class="sourceLine" id="cb1-43" data-line-number="43">    orig_name, new_name <span class="op">=</span> <span class="st">&#39;file1&#39;</span>, <span class="st">&#39;file2&#39;</span></a>
<a class="sourceLine" id="cb1-44" data-line-number="44">    </a>
<a class="sourceLine" id="cb1-45" data-line-number="45">    commands <span class="op">=</span> []</a>
<a class="sourceLine" id="cb1-46" data-line-number="46">    <span class="cf">for</span> cmd <span class="kw">in</span> CreateFIle(orig_name), ReadFile(orig_name), RenameFile(orig_name, new_name):</a>
<a class="sourceLine" id="cb1-47" data-line-number="47">        commands.append(cmd)</a>
<a class="sourceLine" id="cb1-48" data-line-number="48">    [c.execute() <span class="cf">for</span> c <span class="kw">in</span> commands]</a>
<a class="sourceLine" id="cb1-49" data-line-number="49">    </a>
<a class="sourceLine" id="cb1-50" data-line-number="50">    answer <span class="op">=</span> <span class="bu">input</span>(<span class="st">&#39;reverse the executed commands? []y/n&#39;</span>)</a>
<a class="sourceLine" id="cb1-51" data-line-number="51">    </a>
<a class="sourceLine" id="cb1-52" data-line-number="52">    <span class="cf">if</span> answer <span class="kw">not</span> <span class="kw">in</span> <span class="st">&#39;yY&#39;</span>:</a>
<a class="sourceLine" id="cb1-53" data-line-number="53">        <span class="bu">print</span>(<span class="st">&quot;the result is </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(new_name))</a>
<a class="sourceLine" id="cb1-54" data-line-number="54">        exit()</a>
<a class="sourceLine" id="cb1-55" data-line-number="55">    </a>
<a class="sourceLine" id="cb1-56" data-line-number="56">    <span class="cf">for</span> c <span class="kw">in</span> <span class="bu">reversed</span>(commands):</a>
<a class="sourceLine" id="cb1-57" data-line-number="57">        <span class="cf">try</span>:</a>
<a class="sourceLine" id="cb1-58" data-line-number="58">            c.undo()</a>
<a class="sourceLine" id="cb1-59" data-line-number="59">        <span class="cf">except</span> <span class="pp">AttributeError</span> <span class="im">as</span> e:</a>
<a class="sourceLine" id="cb1-60" data-line-number="60">            <span class="cf">pass</span></a>
<a class="sourceLine" id="cb1-61" data-line-number="61"> </a>
<a class="sourceLine" id="cb1-62" data-line-number="62"><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</a>
<a class="sourceLine" id="cb1-63" data-line-number="63">    main()</a></code></pre></div>
<p><u>è§£é‡Šå™¨æ¨¡å¼</u></p>
<p>åœ¨è§£é‡Šå™¨æ¨¡å¼ä¸­ï¼Œæœ‰ä¸€ä¸ªååˆ†é‡è¦çš„åè¯ï¼Œå°±æ˜¯<code>DSL(Domain Specific Language)</code>ï¼Œé¢†åŸŸç‰¹å®šè¯­è¨€ã€‚<code>DSL</code>æ˜¯ä¸€ç§é’ˆå¯¹ä¸€ä¸ªç‰¹å®šé¢†åŸŸçš„æœ‰é™è¡¨è¾¾èƒ½åŠ›ã€‚</p>
<p>è€Œ<code>DSL</code>åˆ†ä¸ºå†…éƒ¨<code>DSL</code>å’Œå¤–éƒ¨<code>DSL</code>ã€‚å†…éƒ¨<code>DSL</code>æ„å»ºåœ¨ä¸€ç§å®¿ä¸»ç¼–ç¨‹è¯­è¨€ä¸­ã€‚å†…éƒ¨<code>DSL</code>çš„ä¸€ä¸ªä¾‹å­æ˜¯ï¼Œä½¿ç”¨<code>Python</code>è§£å†³çº¿æ€§æ–¹ç¨‹ç»„çš„ä¸€ç§è¯­è¨€ã€‚ä½¿ç”¨å†…éƒ¨<code>DSL</code>çš„ä¼˜åŠ¿æ˜¯æˆ‘ä»¬ä¸å¿…æ‹…å¿ƒåˆ›å»ºã€ç¼–è¯‘åŠè§£æè¯­æ³•ï¼Œå› ä¸ºè¿™äº›å·²ç»è¢«å®¿ä¸»è¯­è¨€è§£å†³æ‰äº†ã€‚åŠ£åŠ¿æ˜¯ä¼šå—é™äºå®¿ä¸»è¯­è¨€çš„ç‰¹æ€§ã€‚å¦‚æœå®¿ä¸»è¯­è¨€ä¸å…·å¤‡è¿™äº›ç‰¹æ€§ï¼Œæ„å»ºä¸€ç§è¡¨è¾¾èƒ½åŠ›å¼ºã€ç®€æ´è€Œä¸”ä¼˜ç¾çš„å†…éƒ¨<code>DSL</code>æ˜¯å¯Œæœ‰æŒ‘æˆ˜æ€§çš„ã€‚</p>
<p>å¤–éƒ¨<code>DSL</code>ä¸ä¾èµ–æŸç§å®¿ä¸»è¯­è¨€ã€‚<code>DSL</code>çš„åˆ›å»ºè€…å¯ä»¥å†³å®šè¯­è¨€çš„æ–¹æ–¹é¢é¢ï¼ˆè¯­æ³•ã€å¥æ³•ç­‰ï¼‰ï¼Œä½†ä¹Ÿè¦è´Ÿè´£ä¸ºå…¶åˆ›å»ºä¸€ä¸ªè§£æå™¨å’Œç¼–è¯‘å™¨ã€‚</p>
<p>ä¸‹é¢çš„ä¾‹å­æ˜¯åˆ›å»ºä¸€ç§å†…éƒ¨<code>DSL</code>æ§åˆ¶ä¸€ä¸ªæ™ºèƒ½å±‹ã€‚</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="im">from</span> pyparsing <span class="im">import</span> Word, OneOrMore, Optional, Group, Suppress, alphanums</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw">class</span> Gate:</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">        <span class="va">self</span>.is_open <span class="op">=</span> <span class="va">False</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">        </a>
<a class="sourceLine" id="cb2-7" data-line-number="7">    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">        <span class="cf">return</span> <span class="st">&#39;Open&#39;</span> <span class="cf">if</span> <span class="va">self</span>.is_open <span class="cf">else</span> <span class="st">&#39;closed&#39;</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">    </a>
<a class="sourceLine" id="cb2-10" data-line-number="10">    <span class="kw">def</span> <span class="bu">open</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">        <span class="bu">print</span>(<span class="st">&#39;opening the gate&#39;</span>)</a>
<a class="sourceLine" id="cb2-12" data-line-number="12">        <span class="va">self</span>.is_open <span class="op">=</span> <span class="va">True</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13">        </a>
<a class="sourceLine" id="cb2-14" data-line-number="14">    <span class="kw">def</span> close(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb2-15" data-line-number="15">        <span class="bu">print</span>(<span class="st">&#39;closing the gate&#39;</span>)</a>
<a class="sourceLine" id="cb2-16" data-line-number="16">        <span class="va">self</span>.is_open <span class="op">=</span> <span class="va">False</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17">        </a>
<a class="sourceLine" id="cb2-18" data-line-number="18"></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="kw">class</span> Garage:</a>
<a class="sourceLine" id="cb2-20" data-line-number="20">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb2-21" data-line-number="21">        <span class="va">self</span>.is_open <span class="op">=</span> <span class="va">False</span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22">    </a>
<a class="sourceLine" id="cb2-23" data-line-number="23">    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb2-24" data-line-number="24">        <span class="cf">return</span> <span class="st">&#39;open&#39;</span> <span class="cf">if</span> <span class="va">self</span>.is_open <span class="cf">else</span> <span class="st">&#39;closed&#39;</span></a>
<a class="sourceLine" id="cb2-25" data-line-number="25">    </a>
<a class="sourceLine" id="cb2-26" data-line-number="26">    <span class="kw">def</span> <span class="bu">open</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb2-27" data-line-number="27">        <span class="bu">print</span>(<span class="st">&#39;opening the garage&#39;</span>)</a>
<a class="sourceLine" id="cb2-28" data-line-number="28">        <span class="va">self</span>.is_open <span class="op">=</span> <span class="va">True</span></a>
<a class="sourceLine" id="cb2-29" data-line-number="29">        </a>
<a class="sourceLine" id="cb2-30" data-line-number="30">    <span class="kw">def</span> close(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb2-31" data-line-number="31">        <span class="bu">print</span>(<span class="st">&#39;closing the garage&#39;</span>)</a>
<a class="sourceLine" id="cb2-32" data-line-number="32">        <span class="va">self</span>.is_open <span class="op">=</span> <span class="va">False</span></a>
<a class="sourceLine" id="cb2-33" data-line-number="33">    </a>
<a class="sourceLine" id="cb2-34" data-line-number="34"><span class="kw">class</span> Aircondition:</a>
<a class="sourceLine" id="cb2-35" data-line-number="35">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb2-36" data-line-number="36">        <span class="va">self</span>.is_on <span class="op">=</span> <span class="va">False</span></a>
<a class="sourceLine" id="cb2-37" data-line-number="37">    </a>
<a class="sourceLine" id="cb2-38" data-line-number="38">    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb2-39" data-line-number="39">        <span class="cf">return</span> <span class="st">&#39;on&#39;</span> <span class="cf">if</span> <span class="va">self</span>.is_on <span class="cf">else</span> <span class="st">&#39;off&#39;</span></a>
<a class="sourceLine" id="cb2-40" data-line-number="40">    </a>
<a class="sourceLine" id="cb2-41" data-line-number="41">    <span class="kw">def</span> turn_on(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb2-42" data-line-number="42">        <span class="bu">print</span>(<span class="st">&#39;turning on the aircondition&#39;</span>)</a>
<a class="sourceLine" id="cb2-43" data-line-number="43">        <span class="va">self</span>.is_on <span class="op">=</span> <span class="va">True</span></a>
<a class="sourceLine" id="cb2-44" data-line-number="44">          </a>
<a class="sourceLine" id="cb2-45" data-line-number="45">    <span class="kw">def</span> turn_off(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb2-46" data-line-number="46">        <span class="bu">print</span>(<span class="st">&#39;turning off the aircondition&#39;</span>)</a>
<a class="sourceLine" id="cb2-47" data-line-number="47">        <span class="va">self</span>.is_on <span class="op">=</span> <span class="va">True</span></a>
<a class="sourceLine" id="cb2-48" data-line-number="48">        </a>
<a class="sourceLine" id="cb2-49" data-line-number="49"><span class="kw">class</span> Heating:</a>
<a class="sourceLine" id="cb2-50" data-line-number="50">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb2-51" data-line-number="51">        <span class="va">self</span>.is_on <span class="op">=</span> <span class="va">False</span></a>
<a class="sourceLine" id="cb2-52" data-line-number="52">        </a>
<a class="sourceLine" id="cb2-53" data-line-number="53">    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb2-54" data-line-number="54">        <span class="cf">return</span> <span class="st">&#39;on&#39;</span> <span class="cf">if</span> <span class="va">self</span>.is_on <span class="cf">else</span> <span class="st">&#39;off&#39;</span></a>
<a class="sourceLine" id="cb2-55" data-line-number="55">    </a>
<a class="sourceLine" id="cb2-56" data-line-number="56">    <span class="kw">def</span> turn_on(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb2-57" data-line-number="57">        <span class="bu">print</span>(<span class="st">&#39;turning on the heating&#39;</span>)</a>
<a class="sourceLine" id="cb2-58" data-line-number="58">        <span class="va">self</span>.is_on <span class="op">=</span> <span class="va">True</span></a>
<a class="sourceLine" id="cb2-59" data-line-number="59">        </a>
<a class="sourceLine" id="cb2-60" data-line-number="60">    <span class="kw">def</span> turn_off(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb2-61" data-line-number="61">        <span class="bu">print</span>(<span class="st">&#39;turning off the heating&#39;</span>)</a>
<a class="sourceLine" id="cb2-62" data-line-number="62">        <span class="va">self</span>.is_on <span class="op">=</span> <span class="va">False</span></a>
<a class="sourceLine" id="cb2-63" data-line-number="63">        </a>
<a class="sourceLine" id="cb2-64" data-line-number="64"><span class="kw">class</span> Boiler:</a>
<a class="sourceLine" id="cb2-65" data-line-number="65">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb2-66" data-line-number="66">        <span class="va">self</span>.temperature <span class="op">=</span> <span class="dv">83</span></a>
<a class="sourceLine" id="cb2-67" data-line-number="67">    </a>
<a class="sourceLine" id="cb2-68" data-line-number="68">    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb2-69" data-line-number="69">        <span class="cf">return</span> <span class="st">&#39;boiler temperature: </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="va">self</span>.temperature)</a>
<a class="sourceLine" id="cb2-70" data-line-number="70">    </a>
<a class="sourceLine" id="cb2-71" data-line-number="71">    <span class="kw">def</span> increase_temperature(<span class="va">self</span>, amount):</a>
<a class="sourceLine" id="cb2-72" data-line-number="72">        <span class="bu">print</span>(<span class="st">&quot;increasing the boiler&#39;s temperature by </span><span class="sc">{}</span><span class="st"> degress&quot;</span>.<span class="bu">format</span>(amount))</a>
<a class="sourceLine" id="cb2-73" data-line-number="73">        <span class="va">self</span>.temperature <span class="op">+=</span> amount</a>
<a class="sourceLine" id="cb2-74" data-line-number="74">        </a>
<a class="sourceLine" id="cb2-75" data-line-number="75">    <span class="kw">def</span> decrease_temperature(<span class="va">self</span>, amount):</a>
<a class="sourceLine" id="cb2-76" data-line-number="76">        <span class="bu">print</span>(<span class="st">&quot;decreasing the boiler&#39;s temperature by </span><span class="sc">{}</span><span class="st"> degress&quot;</span>.<span class="bu">format</span>(amount))</a>
<a class="sourceLine" id="cb2-77" data-line-number="77">        <span class="va">self</span>.temperature <span class="op">-=</span> amount</a>
<a class="sourceLine" id="cb2-78" data-line-number="78"> </a>
<a class="sourceLine" id="cb2-79" data-line-number="79"><span class="kw">class</span> Fridge:</a>
<a class="sourceLine" id="cb2-80" data-line-number="80">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb2-81" data-line-number="81">        <span class="va">self</span>.temperature <span class="op">=</span> <span class="dv">2</span></a>
<a class="sourceLine" id="cb2-82" data-line-number="82">    </a>
<a class="sourceLine" id="cb2-83" data-line-number="83">    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb2-84" data-line-number="84">        <span class="cf">return</span> <span class="st">&#39;fridge temperature: </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="va">self</span>.temperature)</a>
<a class="sourceLine" id="cb2-85" data-line-number="85">    </a>
<a class="sourceLine" id="cb2-86" data-line-number="86">    <span class="kw">def</span> increase_temperature(<span class="va">self</span>, amount):</a>
<a class="sourceLine" id="cb2-87" data-line-number="87">        <span class="bu">print</span>(<span class="st">&quot;increasing the fridge&#39;s temperature by </span><span class="sc">{}</span><span class="st"> degrees&quot;</span>.<span class="bu">format</span>(amount))</a>
<a class="sourceLine" id="cb2-88" data-line-number="88">        <span class="va">self</span>.temperature <span class="op">+=</span> amount</a>
<a class="sourceLine" id="cb2-89" data-line-number="89">        </a>
<a class="sourceLine" id="cb2-90" data-line-number="90">    <span class="kw">def</span> decrease_temperature(<span class="va">self</span>, amount):</a>
<a class="sourceLine" id="cb2-91" data-line-number="91">        <span class="bu">print</span>(<span class="st">&quot;decreasing the fridge&#39;s temperature by </span><span class="sc">{}</span><span class="st"> degrees&quot;</span>.<span class="bu">format</span>(amount))</a>
<a class="sourceLine" id="cb2-92" data-line-number="92">        <span class="va">self</span>.temperature <span class="op">-=</span> amount</a>
<a class="sourceLine" id="cb2-93" data-line-number="93">        </a>
<a class="sourceLine" id="cb2-94" data-line-number="94"><span class="kw">def</span> main():</a>
<a class="sourceLine" id="cb2-95" data-line-number="95">    word <span class="op">=</span> Word(alphanums)</a>
<a class="sourceLine" id="cb2-96" data-line-number="96">    command <span class="op">=</span> Group(OneOrMore(word))</a>
<a class="sourceLine" id="cb2-97" data-line-number="97">    token <span class="op">=</span> Suppress(<span class="st">&quot;-&gt;&quot;</span>)</a>
<a class="sourceLine" id="cb2-98" data-line-number="98">    device <span class="op">=</span> Group(OneOrMore(word))</a>
<a class="sourceLine" id="cb2-99" data-line-number="99">    argument <span class="op">=</span> Group(OneOrMore(word))</a>
<a class="sourceLine" id="cb2-100" data-line-number="100">    event <span class="op">=</span> command <span class="op">+</span> token <span class="op">+</span> device <span class="op">+</span> Optional(token <span class="op">+</span> argument)</a>
<a class="sourceLine" id="cb2-101" data-line-number="101">    </a>
<a class="sourceLine" id="cb2-102" data-line-number="102">    gate <span class="op">=</span> Gate()</a>
<a class="sourceLine" id="cb2-103" data-line-number="103">    garage <span class="op">=</span> Garage()</a>
<a class="sourceLine" id="cb2-104" data-line-number="104">    airco <span class="op">=</span> Aircondition()</a>
<a class="sourceLine" id="cb2-105" data-line-number="105">    heating <span class="op">=</span> Heating()</a>
<a class="sourceLine" id="cb2-106" data-line-number="106">    boiler <span class="op">=</span> Boiler()</a>
<a class="sourceLine" id="cb2-107" data-line-number="107">    fridge <span class="op">=</span> Fridge()</a>
<a class="sourceLine" id="cb2-108" data-line-number="108">    </a>
<a class="sourceLine" id="cb2-109" data-line-number="109">    tests <span class="op">=</span> (<span class="st">&#39;open -&gt; gate&#39;</span>, </a>
<a class="sourceLine" id="cb2-110" data-line-number="110">             <span class="st">&#39;close -&gt; garage&#39;</span>,</a>
<a class="sourceLine" id="cb2-111" data-line-number="111">             <span class="st">&#39;turn on -&gt; aircondition&#39;</span>,</a>
<a class="sourceLine" id="cb2-112" data-line-number="112">             <span class="st">&#39;turn off -&gt; heating&#39;</span>, </a>
<a class="sourceLine" id="cb2-113" data-line-number="113">             <span class="st">&#39;increase -&gt; boiler temperature -&gt; 5 degrees&#39;</span>,</a>
<a class="sourceLine" id="cb2-114" data-line-number="114">             <span class="st">&#39;decrease -&gt; fridge temperature -&gt; 2 degress&#39;</span>)</a>
<a class="sourceLine" id="cb2-115" data-line-number="115">    open_actions <span class="op">=</span> {<span class="st">&#39;gate&#39;</span>: gate.<span class="bu">open</span>, </a>
<a class="sourceLine" id="cb2-116" data-line-number="116">                    <span class="st">&#39;garage&#39;</span>: garage.<span class="bu">open</span>, </a>
<a class="sourceLine" id="cb2-117" data-line-number="117">                    <span class="st">&#39;aircondition&#39;</span>: airco.turn_on,</a>
<a class="sourceLine" id="cb2-118" data-line-number="118">                    <span class="st">&#39;heating&#39;</span>: heating.turn_on,</a>
<a class="sourceLine" id="cb2-119" data-line-number="119">                    <span class="st">&#39;boiler temperature&#39;</span>: boiler.increase_temperature,</a>
<a class="sourceLine" id="cb2-120" data-line-number="120">                    <span class="st">&#39;fridge temperature&#39;</span>: fridge.increase_temperature}</a>
<a class="sourceLine" id="cb2-121" data-line-number="121">    close_actions <span class="op">=</span> {<span class="st">&#39;gate&#39;</span>: gate.close, </a>
<a class="sourceLine" id="cb2-122" data-line-number="122">                    <span class="st">&#39;garage&#39;</span>: garage.close, </a>
<a class="sourceLine" id="cb2-123" data-line-number="123">                    <span class="st">&#39;aircondition&#39;</span>: airco.turn_off,</a>
<a class="sourceLine" id="cb2-124" data-line-number="124">                    <span class="st">&#39;heating&#39;</span>: heating.turn_off,</a>
<a class="sourceLine" id="cb2-125" data-line-number="125">                    <span class="st">&#39;boiler temperature&#39;</span>: boiler.decrease_temperature,</a>
<a class="sourceLine" id="cb2-126" data-line-number="126">                    <span class="st">&#39;fridge temperature&#39;</span>:fridge.decrease_temperature}</a>
<a class="sourceLine" id="cb2-127" data-line-number="127">    </a>
<a class="sourceLine" id="cb2-128" data-line-number="128">    <span class="cf">for</span> t <span class="kw">in</span> tests:</a>
<a class="sourceLine" id="cb2-129" data-line-number="129">        <span class="cf">if</span> <span class="bu">len</span>(event.parseString(t)) <span class="op">==</span> <span class="dv">2</span>:</a>
<a class="sourceLine" id="cb2-130" data-line-number="130">            cmd, dev <span class="op">=</span> event.parseString(t)</a>
<a class="sourceLine" id="cb2-131" data-line-number="131">            cmd_str, dev_str <span class="op">=</span> <span class="st">&#39; &#39;</span>.join(cmd), <span class="st">&#39; &#39;</span>join(dev)</a>
<a class="sourceLine" id="cb2-132" data-line-number="132">            <span class="cf">if</span> <span class="st">&#39;open&#39;</span> <span class="kw">in</span> cmd_str <span class="kw">or</span> <span class="st">&#39;turn on&#39;</span> <span class="kw">in</span> cmd_str:</a>
<a class="sourceLine" id="cb2-133" data-line-number="133">                open_actions[dev_str]()</a>
<a class="sourceLine" id="cb2-134" data-line-number="134">            <span class="cf">elif</span> <span class="st">&#39;close&#39;</span> <span class="kw">in</span> cmd_str <span class="kw">or</span> <span class="st">&#39;turn on&#39;</span> <span class="kw">in</span> cmd_str:</a>
<a class="sourceLine" id="cb2-135" data-line-number="135">                close_actions[dev_str]()</a>
<a class="sourceLine" id="cb2-136" data-line-number="136">         <span class="cf">elif</span> <span class="bu">len</span>(event.parseString(t)) <span class="op">==</span> <span class="dv">3</span>:</a>
<a class="sourceLine" id="cb2-137" data-line-number="137">            cmd, dev, arg<span class="op">=</span> event.parseString(t)</a>
<a class="sourceLine" id="cb2-138" data-line-number="138">            cmd_str, dev_str, arg_str <span class="op">=</span> <span class="st">&#39; &#39;</span>.join(cmd), <span class="st">&#39; &#39;</span>.join(dev), <span class="st">&#39; &#39;</span>.join(arg)</a>
<a class="sourceLine" id="cb2-139" data-line-number="139">            num_arg <span class="op">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb2-140" data-line-number="140">            <span class="cf">try</span>:</a>
<a class="sourceLine" id="cb2-141" data-line-number="141">                num_arg <span class="op">=</span> <span class="bu">int</span>(arg_str.split()[<span class="dv">0</span>])</a>
<a class="sourceLine" id="cb2-142" data-line-number="142">            <span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> err:</a>
<a class="sourceLine" id="cb2-143" data-line-number="143">                <span class="bu">print</span>(<span class="st">&quot;expected number nut got: &#39;</span><span class="sc">{}</span><span class="st">&#39;&quot;</span>.<span class="bu">format</span>(arg_str[<span class="dv">0</span>]))</a>
<a class="sourceLine" id="cb2-144" data-line-number="144">            <span class="cf">if</span> <span class="st">&#39;increase&#39;</span> <span class="kw">in</span> cmd_str <span class="kw">and</span> num_arg <span class="op">&gt;</span> <span class="dv">0</span>:</a>
<a class="sourceLine" id="cb2-145" data-line-number="145">                open_actions[dev_str](num_arg)</a>
<a class="sourceLine" id="cb2-146" data-line-number="146">            <span class="cf">elif</span> <span class="st">&#39;decrease&#39;</span> <span class="kw">in</span> cmd_str <span class="kw">and</span> num_arg <span class="op">&gt;</span> <span class="dv">0</span>:</a>
<a class="sourceLine" id="cb2-147" data-line-number="147">                close_actions[dev_str](num_arg)</a>
<a class="sourceLine" id="cb2-148" data-line-number="148">                </a>
<a class="sourceLine" id="cb2-149" data-line-number="149"><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</a>
<a class="sourceLine" id="cb2-150" data-line-number="150">    main()</a></code></pre></div>
<p><u>è§‚å¯Ÿè€…æ¨¡å¼</u></p>
<p>è§‚å¯Ÿè€…æ¨¡å¼æè¿°çš„æ˜¯å•ä¸ªå¯¹è±¡ï¼ˆå‘å¸ƒè€…ï¼Œåˆç§°ä¸ºä¸»æŒäººæˆ–å¯è§‚å¯Ÿè€…ï¼‰ä¸ä¸€ä¸ªæˆ–å¤šä¸ªå¯¹è±¡ï¼ˆè®¢é˜…è€…ï¼Œåˆç§°ä¸ºè§‚å¯Ÿè€…ï¼‰ä¹‹é—´çš„å‘å¸ƒ-è®¢é˜…å…³ç³»ã€‚</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">class</span> Publisher:</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">        <span class="va">self</span>.observers <span class="op">=</span> []</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">        </a>
<a class="sourceLine" id="cb3-5" data-line-number="5">    <span class="kw">def</span> add(<span class="va">self</span>, observer):</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">        <span class="cf">if</span> observer <span class="kw">not</span> <span class="kw">in</span> <span class="va">self</span>.observers:</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">            <span class="va">self</span>.observers.append(observer)</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">        <span class="cf">else</span>:</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">            <span class="bu">print</span>(<span class="st">&#39;Failed to add: </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(observer))</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">    </a>
<a class="sourceLine" id="cb3-11" data-line-number="11">    <span class="kw">def</span> remove(<span class="va">self</span>, observer):</a>
<a class="sourceLine" id="cb3-12" data-line-number="12">        <span class="cf">try</span>:</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">            <span class="va">self</span>.observers.remove(observer)</a>
<a class="sourceLine" id="cb3-14" data-line-number="14">        <span class="cf">except</span> <span class="pp">ValueError</span>:</a>
<a class="sourceLine" id="cb3-15" data-line-number="15">            <span class="bu">print</span>(<span class="st">&#39;Failed to remove: </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(observer))</a>
<a class="sourceLine" id="cb3-16" data-line-number="16">            </a>
<a class="sourceLine" id="cb3-17" data-line-number="17">    <span class="kw">def</span> notify(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb3-18" data-line-number="18">        [o.notify(<span class="va">self</span>) <span class="cf">for</span> o <span class="kw">in</span> <span class="va">self</span>.observers]</a>
<a class="sourceLine" id="cb3-19" data-line-number="19">        </a>
<a class="sourceLine" id="cb3-20" data-line-number="20"><span class="kw">class</span> DefaultFormatter(Publisher):</a>
<a class="sourceLine" id="cb3-21" data-line-number="21">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name):</a>
<a class="sourceLine" id="cb3-22" data-line-number="22">        Publisher.<span class="fu">__init__</span>(<span class="va">self</span>)</a>
<a class="sourceLine" id="cb3-23" data-line-number="23">        <span class="va">self</span>.name <span class="op">=</span> name</a>
<a class="sourceLine" id="cb3-24" data-line-number="24">        <span class="va">self</span>._data <span class="op">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb3-25" data-line-number="25">    </a>
<a class="sourceLine" id="cb3-26" data-line-number="26">    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb3-27" data-line-number="27">        <span class="cf">return</span> <span class="st">&quot;</span><span class="sc">{}</span><span class="st">: &#39;</span><span class="sc">{}</span><span class="st">&#39; has data = </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(<span class="bu">type</span>(<span class="va">self</span>).<span class="va">__name__</span>, <span class="va">self</span>.name, <span class="va">self</span>._data)</a>
<a class="sourceLine" id="cb3-28" data-line-number="28">    </a>
<a class="sourceLine" id="cb3-29" data-line-number="29">    <span class="at">@property</span></a>
<a class="sourceLine" id="cb3-30" data-line-number="30">    <span class="kw">def</span> data(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb3-31" data-line-number="31">        <span class="cf">return</span> <span class="va">self</span>._data</a>
<a class="sourceLine" id="cb3-32" data-line-number="32">    </a>
<a class="sourceLine" id="cb3-33" data-line-number="33">    <span class="at">@data.setter</span></a>
<a class="sourceLine" id="cb3-34" data-line-number="34">    <span class="kw">def</span> data(<span class="va">self</span>, new_value):</a>
<a class="sourceLine" id="cb3-35" data-line-number="35">        <span class="cf">try</span>:</a>
<a class="sourceLine" id="cb3-36" data-line-number="36">            <span class="va">self</span>._data <span class="op">=</span> <span class="bu">int</span>(new_value)</a>
<a class="sourceLine" id="cb3-37" data-line-number="37">        <span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> e:</a>
<a class="sourceLine" id="cb3-38" data-line-number="38">            <span class="bu">print</span>(<span class="st">&#39;Error: </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(e))</a>
<a class="sourceLine" id="cb3-39" data-line-number="39">        <span class="cf">else</span>:</a>
<a class="sourceLine" id="cb3-40" data-line-number="40">            <span class="va">self</span>.notify()</a>
<a class="sourceLine" id="cb3-41" data-line-number="41"></a>
<a class="sourceLine" id="cb3-42" data-line-number="42"><span class="kw">class</span> HexFormatter:</a>
<a class="sourceLine" id="cb3-43" data-line-number="43">    <span class="kw">def</span> notify(<span class="va">self</span>, publisher):</a>
<a class="sourceLine" id="cb3-44" data-line-number="44">        <span class="bu">print</span>(<span class="st">&quot;</span><span class="sc">{}</span><span class="st">: &#39;</span><span class="sc">{}</span><span class="st">&#39; has now hex data = </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(<span class="bu">type</span>(<span class="va">self</span>).<span class="va">__name__</span>, publisher.name, <span class="bu">hex</span>(publisher.data)))</a>
<a class="sourceLine" id="cb3-45" data-line-number="45">        </a>
<a class="sourceLine" id="cb3-46" data-line-number="46"><span class="kw">class</span> BinaryFormatter:</a>
<a class="sourceLine" id="cb3-47" data-line-number="47">    <span class="kw">def</span> notify(<span class="va">self</span>, publisher):</a>
<a class="sourceLine" id="cb3-48" data-line-number="48">        <span class="bu">print</span>(<span class="st">&quot;</span><span class="sc">{}</span><span class="st">: &#39;</span><span class="sc">{}</span><span class="st">&#39; has now bin data = </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(<span class="bu">type</span>(<span class="va">self</span>).<span class="va">__name__</span>, publisher.name, <span class="bu">bin</span>(publisher.data)))</a>
<a class="sourceLine" id="cb3-49" data-line-number="49">        </a>
<a class="sourceLine" id="cb3-50" data-line-number="50"><span class="kw">def</span> main():</a>
<a class="sourceLine" id="cb3-51" data-line-number="51">    df <span class="op">=</span> DefaultFormatter(<span class="st">&#39;test1&#39;</span>)</a>
<a class="sourceLine" id="cb3-52" data-line-number="52">    <span class="bu">print</span>(df)</a>
<a class="sourceLine" id="cb3-53" data-line-number="53">    </a>
<a class="sourceLine" id="cb3-54" data-line-number="54">    <span class="bu">print</span>()</a>
<a class="sourceLine" id="cb3-55" data-line-number="55">    hf <span class="op">=</span> HexFormatter()</a>
<a class="sourceLine" id="cb3-56" data-line-number="56">    df.add(hf)</a>
<a class="sourceLine" id="cb3-57" data-line-number="57">    df.data <span class="op">=</span> <span class="dv">3</span></a>
<a class="sourceLine" id="cb3-58" data-line-number="58">    <span class="bu">print</span>(df)</a>
<a class="sourceLine" id="cb3-59" data-line-number="59">    </a>
<a class="sourceLine" id="cb3-60" data-line-number="60">    <span class="bu">print</span>()</a>
<a class="sourceLine" id="cb3-61" data-line-number="61">    bf <span class="op">=</span> BinaryFormatter()</a>
<a class="sourceLine" id="cb3-62" data-line-number="62">    df.add(bf)</a>
<a class="sourceLine" id="cb3-63" data-line-number="63">    df.data <span class="op">=</span> <span class="dv">21</span></a>
<a class="sourceLine" id="cb3-64" data-line-number="64">    <span class="bu">print</span>(df)</a>
<a class="sourceLine" id="cb3-65" data-line-number="65">    </a>
<a class="sourceLine" id="cb3-66" data-line-number="66">    <span class="bu">print</span>()</a>
<a class="sourceLine" id="cb3-67" data-line-number="67">    df.remove(hf)</a>
<a class="sourceLine" id="cb3-68" data-line-number="68">    df.data <span class="op">=</span> <span class="dv">40</span></a>
<a class="sourceLine" id="cb3-69" data-line-number="69">    <span class="bu">print</span>(df)</a>
<a class="sourceLine" id="cb3-70" data-line-number="70">    </a>
<a class="sourceLine" id="cb3-71" data-line-number="71">    <span class="bu">print</span>()</a>
<a class="sourceLine" id="cb3-72" data-line-number="72">    df.remove(hf)</a>
<a class="sourceLine" id="cb3-73" data-line-number="73">    df.add(hf)</a>
<a class="sourceLine" id="cb3-74" data-line-number="74">    </a>
<a class="sourceLine" id="cb3-75" data-line-number="75">    df.data <span class="op">=</span> <span class="st">&#39;hello&#39;</span></a>
<a class="sourceLine" id="cb3-76" data-line-number="76">    <span class="bu">print</span>(df)</a>
<a class="sourceLine" id="cb3-77" data-line-number="77">    </a>
<a class="sourceLine" id="cb3-78" data-line-number="78">    <span class="bu">print</span>()</a>
<a class="sourceLine" id="cb3-79" data-line-number="79">    df.data <span class="op">=</span> <span class="fl">15.8</span></a>
<a class="sourceLine" id="cb3-80" data-line-number="80">    <span class="bu">print</span>(df)</a>
<a class="sourceLine" id="cb3-81" data-line-number="81">    </a>
<a class="sourceLine" id="cb3-82" data-line-number="82"><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</a>
<a class="sourceLine" id="cb3-83" data-line-number="83">    main()</a></code></pre></div>
<p><u>æ¨¡ç‰ˆæ¨¡å¼</u></p>
<p>å¹¿åº¦ä¼˜å…ˆæœç´¢å’Œæ·±åº¦ä¼˜å…ˆæœç´¢èƒ½å¤Ÿä½“ç°ä¸€äº›é€šç”¨ä½†éå…¨éƒ¨çš„æ­¥éª¤ã€‚</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co">#BFS</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">def</span> bfs(graph, start, end):</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">    path <span class="op">=</span> []</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">    visited <span class="op">=</span> [start]</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">    <span class="cf">while</span> visited:</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">        current <span class="op">=</span> visited.pop(<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">        <span class="cf">if</span> current <span class="kw">not</span> <span class="kw">in</span> path:</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">            path.append(current)</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">            <span class="cf">if</span> current <span class="op">==</span> end:</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">                <span class="bu">print</span>(path)</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">                <span class="cf">return</span> (<span class="va">True</span>, path)</a>
<a class="sourceLine" id="cb4-12" data-line-number="12">            <span class="cf">if</span> current <span class="kw">not</span> <span class="kw">in</span> graph:</a>
<a class="sourceLine" id="cb4-13" data-line-number="13">                <span class="cf">continue</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14">        visited <span class="op">=</span> visited <span class="op">+</span> graph[current]</a>
<a class="sourceLine" id="cb4-15" data-line-number="15">    <span class="cf">return</span> (<span class="va">False</span>, path)</a>
<a class="sourceLine" id="cb4-16" data-line-number="16"></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#DFS</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="kw">def</span> dfs(graph, start, end):</a>
<a class="sourceLine" id="cb4-19" data-line-number="19">    path <span class="op">=</span> []</a>
<a class="sourceLine" id="cb4-20" data-line-number="20">    visited <span class="op">=</span> [start]</a>
<a class="sourceLine" id="cb4-21" data-line-number="21">    <span class="cf">while</span> visited:</a>
<a class="sourceLine" id="cb4-22" data-line-number="22">        current <span class="op">=</span> visited.pop(<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb4-23" data-line-number="23">        <span class="cf">if</span> current <span class="kw">not</span> <span class="kw">in</span> path:</a>
<a class="sourceLine" id="cb4-24" data-line-number="24">            path.append(current)</a>
<a class="sourceLine" id="cb4-25" data-line-number="25">            <span class="cf">if</span> current <span class="op">==</span> end:</a>
<a class="sourceLine" id="cb4-26" data-line-number="26">                <span class="bu">print</span>(path)</a>
<a class="sourceLine" id="cb4-27" data-line-number="27">                <span class="cf">return</span> (<span class="va">True</span>, path)</a>
<a class="sourceLine" id="cb4-28" data-line-number="28">            <span class="cf">if</span> current <span class="kw">not</span> <span class="kw">in</span> graph:</a>
<a class="sourceLine" id="cb4-29" data-line-number="29">                <span class="cf">continue</span></a>
<a class="sourceLine" id="cb4-30" data-line-number="30">        visited <span class="op">=</span> graph[current] <span class="op">+</span> visited</a>
<a class="sourceLine" id="cb4-31" data-line-number="31">    <span class="cf">return</span> (<span class="va">False</span>, path)</a></code></pre></div>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªç®—æ³•æœ‰å¤§é‡çš„é‡å¤ï¼Œè€Œåªæœ‰ä¸€è¡Œä¸åŒï¼Œå› æ­¤å¯ä»¥è¿ç”¨æ¨¡ç‰ˆæ¨¡å¼ï¼Œæ¥è§£å†³ä»£ç å†—ä½™çš„é—®é¢˜ã€‚</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">def</span> traverse(graph, start, end, action):</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">    path <span class="op">=</span> []</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">    visited <span class="op">=</span> [start]</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">    <span class="cf">while</span> visited:</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">        current <span class="op">=</span> visited.pop(<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">        <span class="cf">if</span> current <span class="kw">not</span> <span class="kw">in</span> path:</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">            path.append(current)</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">            <span class="cf">if</span> current <span class="op">==</span> end:</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">                <span class="cf">return</span> (<span class="va">True</span>, path)</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">            <span class="cf">if</span> current <span class="kw">not</span> <span class="kw">in</span> graph:</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">                <span class="cf">continue</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12">        visited <span class="op">=</span> action(visited, graph[current])</a>
<a class="sourceLine" id="cb5-13" data-line-number="13">     <span class="cf">return</span> (<span class="va">False</span>, path)</a>
<a class="sourceLine" id="cb5-14" data-line-number="14"></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="kw">def</span> extend_bfs_path(visited, current):</a>
<a class="sourceLine" id="cb5-16" data-line-number="16">    <span class="cf">return</span> visited <span class="op">+</span> current</a>
<a class="sourceLine" id="cb5-17" data-line-number="17"></a>
<a class="sourceLine" id="cb5-18" data-line-number="18"><span class="kw">def</span> extend_dfs_path(visited, current):</a>
<a class="sourceLine" id="cb5-19" data-line-number="19">    <span class="cf">return</span> current <span class="op">+</span> visited</a></code></pre></div>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/29/ã€ŠPythonè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°äºŒ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Peter Tsung">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/pandas.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å½¼å¾—çš„åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/29/ã€ŠPythonè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°äºŒ/" itemprop="url">
                  ã€ŠPythonè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°äºŒ
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-07-29T19:29:23+08:00">
                2017-07-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-Notes/" itemprop="url" rel="index">
                    <span itemprop="name">Python_Notes</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è¿™å‘¨çš„å­¦ä¹ è®¡åˆ’æ˜¯é˜…è¯»<code>å¤–è§‚æ¨¡å¼</code>ã€<code>äº«å…ƒæ¨¡å¼</code>ã€<code>æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨æ¨¡å¼</code>ã€<code>ä»£ç†æ¨¡å¼</code>å’Œ<code>è´£ä»»é“¾æ¨¡å¼</code>ã€‚</p>
<p><u>å¤–è§‚è®¾è®¡æ¨¡å¼</u></p>
<p>å¤–è§‚è®¾è®¡æ¨¡å¼çš„ä½œç”¨æ˜¯éšè—ç³»ç»Ÿçš„å†…éƒ¨å¤æ‚æ€§ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªç®€åŒ–çš„æ¥å£å‘å®¢æˆ·ç«¯æš´éœ²å¿…è¦çš„éƒ¨åˆ†ã€‚ä½¿ç”¨å¤–è§‚æ¨¡å¼çš„æœ€å¸¸è§ç†ç”±æ˜¯ä¸ºä¸€ä¸ªå¤æ‚ç³»ç»Ÿæä¾›å•ä¸ªç®€å•çš„å…¥å£ç‚¹ã€‚å¼•å…¥å¤–è§‚ä¹‹åï¼Œå®¢æˆ·ç«¯ä»£ç é€šè¿‡ç®€å•åœ°è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼å‡½æ•°å°±èƒ½ä½¿ç”¨ä¸€ä¸ªç³»ç»Ÿã€‚åŒæ—¶ï¼Œå†…éƒ¨ç³»ç»Ÿå¹¶ä¸ä¼šä¸¢å¤±ä»»ä½•åŠŸèƒ½ï¼Œå¤–è§‚åªæ˜¯å°è£…äº†å†…éƒ¨ç³»ç»Ÿã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„å¥½å¤„ï¼Œå°±æ˜¯æˆ‘ä»¬å¯ä»¥æ”¹å˜ç³»ç»Ÿå†…éƒ¨ï¼Œä½†å®¢æˆ·ç«¯ä»£ç ç”¨æˆ·ä¸ç”¨å…³å¿ƒè¿™ä¸ªæ”¹å˜ï¼Œä¹Ÿä¸ä¼šå—è¿™ä¸ªæ”¹å˜çš„å½±å“ã€‚</p>
<p>ä¸‹é¢å°†ä»¥å¤šæœåŠ¡è¿›ç¨‹æ“ä½œç³»ç»Ÿä½¿ç”¨çš„æ¥å£å®ç°æ¥è¯´æ˜å¤–è§‚æ¨¡å¼æ˜¯å¦‚ä½•ä½“ç°çš„ã€‚</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="im">from</span> enum <span class="im">import</span> Enum</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="im">from</span> abc <span class="im">import</span> ABCMeta, abstractmethod</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">State <span class="op">=</span> Enum(<span class="st">&#39;State&#39;</span>, <span class="st">&#39;new running sleeping restart zombie&#39;</span>)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw">class</span> User:</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">    <span class="cf">pass</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="kw">class</span> Process:</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">    <span class="cf">pass</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="kw">class</span> Server(metaclass<span class="op">=</span>ABCMeta):</a>
<a class="sourceLine" id="cb1-13" data-line-number="13">    <span class="at">@abstractmethod</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb1-15" data-line-number="15">        <span class="cf">pass</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16">    </a>
<a class="sourceLine" id="cb1-17" data-line-number="17">    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb1-18" data-line-number="18">        <span class="cf">return</span> <span class="va">self</span>.name</a>
<a class="sourceLine" id="cb1-19" data-line-number="19">    </a>
<a class="sourceLine" id="cb1-20" data-line-number="20">    <span class="at">@abstractmethod</span></a>
<a class="sourceLine" id="cb1-21" data-line-number="21">    <span class="kw">def</span> boot(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb1-22" data-line-number="22">        <span class="cf">pass</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23">    </a>
<a class="sourceLine" id="cb1-24" data-line-number="24">    <span class="at">@abstractmethod</span></a>
<a class="sourceLine" id="cb1-25" data-line-number="25">    <span class="kw">def</span> kill(<span class="va">self</span>, restart<span class="op">=</span><span class="va">True</span>):</a>
<a class="sourceLine" id="cb1-26" data-line-number="26">        <span class="cf">pass</span></a>
<a class="sourceLine" id="cb1-27" data-line-number="27">    </a>
<a class="sourceLine" id="cb1-28" data-line-number="28"><span class="kw">class</span> FileServer(Server):</a>
<a class="sourceLine" id="cb1-29" data-line-number="29">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb1-30" data-line-number="30">        <span class="va">self</span>.name <span class="op">=</span> <span class="st">&quot;FileServer&quot;</span></a>
<a class="sourceLine" id="cb1-31" data-line-number="31">        <span class="va">self</span>.state <span class="op">=</span> State.new</a>
<a class="sourceLine" id="cb1-32" data-line-number="32">        </a>
<a class="sourceLine" id="cb1-33" data-line-number="33">    <span class="kw">def</span> boot(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb1-34" data-line-number="34">        <span class="bu">print</span>(<span class="st">&#39;booting the </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="va">self</span>))</a>
<a class="sourceLine" id="cb1-35" data-line-number="35">        <span class="va">self</span>.state <span class="op">=</span> State.running</a>
<a class="sourceLine" id="cb1-36" data-line-number="36">        </a>
<a class="sourceLine" id="cb1-37" data-line-number="37">    <span class="kw">def</span> kill(<span class="va">self</span>, restart<span class="op">=</span><span class="va">True</span>):</a>
<a class="sourceLine" id="cb1-38" data-line-number="38">        <span class="bu">print</span>(<span class="st">&#39;Killing </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="va">self</span>))</a>
<a class="sourceLine" id="cb1-39" data-line-number="39">        <span class="va">self</span>.state <span class="op">=</span> State.restart <span class="cf">if</span> restart <span class="cf">else</span> State.zombie</a>
<a class="sourceLine" id="cb1-40" data-line-number="40">        </a>
<a class="sourceLine" id="cb1-41" data-line-number="41">    <span class="kw">def</span> create_file(<span class="va">self</span>, user, name, permissions):</a>
<a class="sourceLine" id="cb1-42" data-line-number="42">        <span class="bu">print</span>(<span class="st">&quot;trying to create the file &#39;</span><span class="sc">{}</span><span class="st">&#39; for user &#39;</span><span class="sc">{}</span><span class="st">&#39; with permissions </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(name, user, permissions))</a>
<a class="sourceLine" id="cb1-43" data-line-number="43">        </a>
<a class="sourceLine" id="cb1-44" data-line-number="44"><span class="kw">class</span> ProcessServer(Server):</a>
<a class="sourceLine" id="cb1-45" data-line-number="45">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb1-46" data-line-number="46">        <span class="va">self</span>.name <span class="op">=</span> <span class="st">&#39;ProcessServer&#39;</span></a>
<a class="sourceLine" id="cb1-47" data-line-number="47">        <span class="va">self</span>.state <span class="op">=</span> State.new</a>
<a class="sourceLine" id="cb1-48" data-line-number="48">        </a>
<a class="sourceLine" id="cb1-49" data-line-number="49">    <span class="kw">def</span> boot(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb1-50" data-line-number="50">        <span class="bu">print</span>(<span class="st">&#39;booting the </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="va">self</span>))</a>
<a class="sourceLine" id="cb1-51" data-line-number="51">        <span class="va">self</span>.state <span class="op">=</span> State.running</a>
<a class="sourceLine" id="cb1-52" data-line-number="52">        </a>
<a class="sourceLine" id="cb1-53" data-line-number="53">    <span class="kw">def</span> kill(<span class="va">self</span>, restart<span class="op">=</span><span class="va">True</span>):</a>
<a class="sourceLine" id="cb1-54" data-line-number="54">        <span class="bu">print</span>(<span class="st">&#39;Killing </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="va">self</span>))</a>
<a class="sourceLine" id="cb1-55" data-line-number="55">        <span class="va">self</span>.state <span class="op">=</span> State.restart <span class="cf">if</span> restart <span class="cf">else</span> State.zombie</a>
<a class="sourceLine" id="cb1-56" data-line-number="56">    </a>
<a class="sourceLine" id="cb1-57" data-line-number="57">    <span class="kw">def</span> create_process(<span class="va">self</span>, user, name):</a>
<a class="sourceLine" id="cb1-58" data-line-number="58">        <span class="bu">print</span>(<span class="st">&quot;trying to create the process &#39;</span><span class="sc">{}</span><span class="st">&#39; for user &#39;</span><span class="sc">{}</span><span class="st">&#39;&quot;</span>.<span class="bu">format</span>(name, user))</a>
<a class="sourceLine" id="cb1-59" data-line-number="59">        </a>
<a class="sourceLine" id="cb1-60" data-line-number="60"><span class="kw">class</span> WindowServer:</a>
<a class="sourceLine" id="cb1-61" data-line-number="61">    <span class="cf">pass</span></a>
<a class="sourceLine" id="cb1-62" data-line-number="62"></a>
<a class="sourceLine" id="cb1-63" data-line-number="63"><span class="kw">class</span> NetworkServer:</a>
<a class="sourceLine" id="cb1-64" data-line-number="64">    <span class="cf">pass</span></a>
<a class="sourceLine" id="cb1-65" data-line-number="65"></a>
<a class="sourceLine" id="cb1-66" data-line-number="66"><span class="kw">class</span> OperatingSystem:</a>
<a class="sourceLine" id="cb1-67" data-line-number="67">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb1-68" data-line-number="68">        <span class="va">self</span>.fs <span class="op">=</span> FileServer()</a>
<a class="sourceLine" id="cb1-69" data-line-number="69">        <span class="va">self</span>.ps <span class="op">=</span> ProcessServer()</a>
<a class="sourceLine" id="cb1-70" data-line-number="70">        </a>
<a class="sourceLine" id="cb1-71" data-line-number="71">    <span class="kw">def</span> start(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb1-72" data-line-number="72">        [i.boot() <span class="cf">for</span> i <span class="kw">in</span> (<span class="va">self</span>.fs, <span class="va">self</span>.ps)]</a>
<a class="sourceLine" id="cb1-73" data-line-number="73">        </a>
<a class="sourceLine" id="cb1-74" data-line-number="74">    <span class="kw">def</span> create_file(<span class="va">self</span>, user, name, permissions):</a>
<a class="sourceLine" id="cb1-75" data-line-number="75">        <span class="cf">return</span> <span class="va">self</span>.ps.create_process(user, name)</a>
<a class="sourceLine" id="cb1-76" data-line-number="76"></a>
<a class="sourceLine" id="cb1-77" data-line-number="77"><span class="kw">def</span> main():</a>
<a class="sourceLine" id="cb1-78" data-line-number="78">    os <span class="op">=</span> OperatingSystem()</a>
<a class="sourceLine" id="cb1-79" data-line-number="79">    os.start()</a>
<a class="sourceLine" id="cb1-80" data-line-number="80">    os.create_file(<span class="st">&#39;foo&#39;</span>, <span class="st">&#39;hello&#39;</span>, <span class="st">&#39;-rw-r-r&#39;</span>)</a>
<a class="sourceLine" id="cb1-81" data-line-number="81">    os.create_process(<span class="st">&#39;bar&#39;</span>, <span class="st">&#39;ls/tmp&#39;</span>)</a>
<a class="sourceLine" id="cb1-82" data-line-number="82">    </a>
<a class="sourceLine" id="cb1-83" data-line-number="83"><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</a>
<a class="sourceLine" id="cb1-84" data-line-number="84">    main()</a></code></pre></div>
<p><u>äº«å…ƒæ¨¡å¼</u></p>
<p>ä¸€ä¸ªäº«å…ƒï¼ˆFlyweightï¼‰å°±æ˜¯ä¸€ä¸ªåŒ…å«çŠ¶æ€ç‹¬ç«‹çš„ä¸å¯å˜ï¼ˆåˆç§°å›ºæœ‰çš„ï¼‰æ•°æ®çš„å…±äº«å¯¹è±¡ï¼Œäº«å…ƒæ—¨åœ¨ä¼˜åŒ–æ€§èƒ½å’Œå†…å­˜ä½¿ç”¨ã€‚è‹¥æƒ³äº«å…ƒæ¨¡å¼æœ‰æ•ˆï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li>åº”ç”¨éœ€è¦ä½¿ç”¨å¤§é‡çš„å¯¹è±¡</li>
<li>å¯¹è±¡å¤ªå¤šï¼Œå­˜å‚¨ï¼æ¸²æŸ“å®ƒä»¬çš„ä»£ä»·å¤ªå¤§ã€‚ä¸€æ—¦ç§»é™¤å¯¹è±¡ä¸­çš„å¯å˜çŠ¶æ€ï¼ˆå› ä¸ºåœ¨éœ€è¦ä¹‹æ—¶ï¼Œåº”è¯¥ç”±å®¢æˆ·ç«¯ä»£ç æ˜¾å¼åœ°ä¼ é€’ç»™äº«å…ƒï¼‰ï¼Œå¤šç»„ä¸åŒçš„å¯¹è±¡å¯è¢«ç›¸å¯¹æ›´å°‘çš„å…±äº«å¯¹è±¡æ‰€æ›¿ä»£ã€‚</li>
<li>å¯¹è±¡IDå¯¹äºåº”ç”¨ä¸é‡è¦ã€‚å…±äº«å¯¹è±¡ä¼šé€ æˆIDæ¯”è¾ƒçš„å¤±è´¥ï¼Œæ‰€ä»¥ä¸èƒ½ä¾èµ–å¯¹è±¡IDï¼ˆé‚£äº›åœ¨å®¢æˆ·ç«¯ä»£ç çœ‹æ¥ä¸åŒçš„å¯¹è±¡ï¼Œæœ€ç»ˆå…·æœ‰ç›¸åŒçš„IDï¼‰ã€‚</li>
</ul>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨åº”ç”¨éœ€è¦åˆ›å»ºå¤§é‡çš„è®¡ç®—ä»£ä»·å¤§ä½†å…±äº«è®¸å¤šå±æ€§çš„å¯¹è±¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨äº«å…ƒã€‚</p>
<p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œå°†ä¼šæ„é€ ä¸€å°ç‰‡æ°´æœæ ‘çš„æ£®æ—ï¼Œå°åˆ°èƒ½ç¡®ä¿åœ¨å•ä¸ªç»ˆç«¯é¡µé¢ä¸­é˜…è¯»æ•´ä¸ªè¾“å‡ºã€‚ç„¶è€Œï¼Œæ— è®ºä½ æ„é€ çš„æ£®æ—æœ‰å¤šå¤§ï¼Œå†…å­˜åˆ†é…éƒ½ä¿æŒç›¸åŒã€‚</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="im">import</span> random</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="im">from</span> enum <span class="im">import</span> Enum</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">TreeType <span class="op">=</span> Enum(<span class="st">&#39;TreeType&#39;</span>, <span class="st">&#39;apple_tree cherry_tree peach_tree&#39;</span>)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="kw">class</span> Tree:</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">    pool <span class="op">=</span> <span class="bu">dict</span>()</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">    </a>
<a class="sourceLine" id="cb2-9" data-line-number="9">    <span class="kw">def</span> <span class="fu">__new__</span>(cls, tree_type):</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">        obj <span class="op">=</span> cls.pool.get(tree_type, <span class="va">None</span>)</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">        <span class="cf">if</span> <span class="kw">not</span> obj:</a>
<a class="sourceLine" id="cb2-12" data-line-number="12">            obj <span class="op">=</span> <span class="bu">object</span>.<span class="fu">__new__</span>(cls)</a>
<a class="sourceLine" id="cb2-13" data-line-number="13">            cls.pool[tree_type] <span class="op">=</span> obj</a>
<a class="sourceLine" id="cb2-14" data-line-number="14">            obj.tree_type <span class="op">=</span> tree_type</a>
<a class="sourceLine" id="cb2-15" data-line-number="15">        <span class="cf">return</span> obj</a>
<a class="sourceLine" id="cb2-16" data-line-number="16">    </a>
<a class="sourceLine" id="cb2-17" data-line-number="17">    <span class="kw">def</span> render(<span class="va">self</span>, age, x, y):</a>
<a class="sourceLine" id="cb2-18" data-line-number="18">        <span class="bu">print</span>(<span class="st">&#39;render a tree of type </span><span class="sc">{}</span><span class="st"> and age </span><span class="sc">{}</span><span class="st"> at (</span><span class="sc">{}</span><span class="st">, </span><span class="sc">{}</span><span class="st">)&#39;</span>).<span class="bu">format</span>(<span class="va">self</span>.tree_type, age, x, y)</a>
<a class="sourceLine" id="cb2-19" data-line-number="19"></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="kw">def</span> main():</a>
<a class="sourceLine" id="cb2-21" data-line-number="21">    rnd <span class="op">=</span> random.Random()</a>
<a class="sourceLine" id="cb2-22" data-line-number="22">    age_min, age_max <span class="op">=</span> <span class="dv">1</span>, <span class="dv">30</span></a>
<a class="sourceLine" id="cb2-23" data-line-number="23">    min_point, max_point <span class="op">=</span> <span class="dv">0</span>, <span class="dv">100</span></a>
<a class="sourceLine" id="cb2-24" data-line-number="24">    tree_counter <span class="op">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb2-25" data-line-number="25">    </a>
<a class="sourceLine" id="cb2-26" data-line-number="26">    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</a>
<a class="sourceLine" id="cb2-27" data-line-number="27">        t1 <span class="op">=</span> Tree(TreeType.apple_tree)</a>
<a class="sourceLine" id="cb2-28" data-line-number="28">        t1.render(rnd.randint(age_min, age_max),</a>
<a class="sourceLine" id="cb2-29" data-line-number="29">                  rnd.randint(min_point, max_point),</a>
<a class="sourceLine" id="cb2-30" data-line-number="30">                  rnd.randint(min_point, max_point))</a>
<a class="sourceLine" id="cb2-31" data-line-number="31">        tree_counter<span class="op">+=</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb2-32" data-line-number="32">    </a>
<a class="sourceLine" id="cb2-33" data-line-number="33">    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</a>
<a class="sourceLine" id="cb2-34" data-line-number="34">        t2 <span class="op">=</span> Tree(TreeType.apple_tree)</a>
<a class="sourceLine" id="cb2-35" data-line-number="35">        t2.render(rnd.randint(age_min, age_max),</a>
<a class="sourceLine" id="cb2-36" data-line-number="36">                  rnd.randint(min_point, max_point),</a>
<a class="sourceLine" id="cb2-37" data-line-number="37">                  rnd.randint(min_point, max_point))</a>
<a class="sourceLine" id="cb2-38" data-line-number="38">        tree_counter<span class="op">+=</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb2-39" data-line-number="39">        </a>
<a class="sourceLine" id="cb2-40" data-line-number="40">    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</a>
<a class="sourceLine" id="cb2-41" data-line-number="41">        t3 <span class="op">=</span> Tree(TreeType.apple_tree)</a>
<a class="sourceLine" id="cb2-42" data-line-number="42">        t3.render(rnd.randint(age_min, age_max),</a>
<a class="sourceLine" id="cb2-43" data-line-number="43">                  rnd.randint(min_point, max_point),</a>
<a class="sourceLine" id="cb2-44" data-line-number="44">                  rnd.randint(min_point, max_point))</a>
<a class="sourceLine" id="cb2-45" data-line-number="45">        tree_counter<span class="op">+=</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb2-46" data-line-number="46">        </a>
<a class="sourceLine" id="cb2-47" data-line-number="47">    <span class="bu">print</span>(<span class="st">&#39;trees rendered: </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(tree_counter))</a>
<a class="sourceLine" id="cb2-48" data-line-number="48">    <span class="bu">print</span>(<span class="st">&#39;trees actually created: </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="bu">len</span>(Tree.pool)))</a>
<a class="sourceLine" id="cb2-49" data-line-number="49">    </a>
<a class="sourceLine" id="cb2-50" data-line-number="50">    t4 <span class="op">=</span> Tree(TreeType.cherry_tree)</a>
<a class="sourceLine" id="cb2-51" data-line-number="51">    t5 <span class="op">=</span> Tree(TreeType.cherry_tree)</a>
<a class="sourceLine" id="cb2-52" data-line-number="52">    t6 <span class="op">=</span> Tree(TreeType.apple_tree)</a>
<a class="sourceLine" id="cb2-53" data-line-number="53">    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{}</span><span class="st"> == </span><span class="sc">{}</span><span class="st">? </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="bu">id</span>(t4), <span class="bu">id</span>(t5), <span class="bu">id</span>(t4) <span class="op">==</span> <span class="bu">id</span>(t5)))</a>
<a class="sourceLine" id="cb2-54" data-line-number="54">    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{}</span><span class="st"> == </span><span class="sc">{}</span><span class="st">? </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="bu">id</span>(t5), <span class="bu">id</span>(t6), <span class="bu">id</span>(t5) <span class="op">==</span> <span class="bu">id</span>(t6)))</a>
<a class="sourceLine" id="cb2-55" data-line-number="55">    </a>
<a class="sourceLine" id="cb2-56" data-line-number="56"><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</a>
<a class="sourceLine" id="cb2-57" data-line-number="57">    main()</a></code></pre></div>
<p><u>æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨æ¨¡å¼</u></p>
<p>å…³æ³¨ç‚¹åˆ†ç¦»ï¼ˆSeperation of Concernsï¼ŒSoCï¼‰åŸåˆ™æ˜¯è½¯ä»¶å·¥ç¨‹ç›¸å…³çš„è®¾è®¡åŸåˆ™ä¹‹ä¸€ã€‚SoCåŸåˆ™èƒŒåçš„æ€æƒ³æ˜¯å°†ä¸€ä¸ªåº”ç”¨åˆ‡åˆ†æˆä¸åŒçš„éƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†è§£å†³ä¸€ä¸ªå•ç‹¬çš„å…³æ³¨ç‚¹ã€‚åˆ†å±‚è®¾è®¡ä¸­çš„å±‚æ¬¡ï¼ˆæ•°æ®è®¿é—®å±‚ã€ä¸šåŠ¡é€»è¾‘å±‚å’Œè¡¨ç¤ºå±‚ç­‰ï¼‰å³æ˜¯å…³æ³¨ç‚¹çš„ä¾‹å­ã€‚ä½¿ç”¨SoCåŸåˆ™èƒ½ç®€åŒ–è½¯ä»¶åº”ç”¨çš„å¼€å‘å’Œç»´æŠ¤ã€‚</p>
<p>ä¸€å¼€å§‹æ¥è§¦<code>MVC</code>æ¨¡å¼æ˜¯å› ä¸ºå­¦ä¹ <code>Django</code>ï¼Œ<code>Django</code>æŠŠé€»è¾‘å±‚ã€æ•°æ®å±‚å’Œè¡¨ç¤ºå±‚éƒ½åˆ†å¼€ä¸‰ä¸ªéƒ¨åˆ†ã€‚æ‰€ä»¥å„ä¸ªæ¨¡å—çš„å®ç°éœ€è¦åœ¨å¯¹åº”çš„éƒ¨åˆ†ä¸­å¡«å†™ï¼Œè¿™æ ·å±‚æ¬¡æ¯”è¾ƒåˆ†æ˜ï¼Œå‡å°‘äº†æŠŠæ‰€æœ‰éƒ¨åˆ†éƒ½æ‰åœ¨ä¸€èµ·è€Œé€ æˆé”™è¯¯çš„é—®é¢˜ã€‚</p>
<p><u>ä»£ç†æ¨¡å¼</u></p>
<p>ä»£ç†æ¨¡å¼æœ‰ä»¥ä¸‹å››ç§ï¼š</p>
<ul>
<li>è¿œç¨‹ä»£ç†ï¼šå®é™…å­˜åœ¨äºä¸åŒåœ°å€ç©ºé—´ï¼ˆä¾‹å¦‚ï¼ŒæŸä¸ªç½‘ç»œæœåŠ¡å™¨ï¼‰çš„å¯¹è±¡åœ¨æœ¬åœ°çš„ä»£ç†è€…ã€‚</li>
<li>è™šæ‹Ÿä»£ç†ï¼šç”¨äºæ‡’åˆå§‹åŒ–ï¼Œå°†ä¸€ä¸ªå¤§è®¡ç®—é‡å¯¹è±¡çš„åˆ›å»ºå»¶è¿Ÿåˆ°çœŸæ­£éœ€è¦çš„æ—¶å€™è¿›è¡Œã€‚</li>
<li>ä¿æŠ¤ï¼é˜²æŠ¤ä»£ç†ï¼šæ§åˆ¶å¯¹æ•æ„Ÿå¯¹è±¡çš„è®¿é—®ã€‚</li>
<li>æ™ºèƒ½ï¼ˆå¼•ç”¨ï¼‰ä»£ç†ï¼šåœ¨å¯¹è±¡è¢«è®¿é—®æ—¶æ‰§è¡Œé¢å¤–çš„åŠ¨ä½œã€‚æ­¤ç±»ä»£ç†çš„ä¾‹å­åŒ…æ‹¬å¼•ç”¨è®¡æ•°å’Œçº¿ç¨‹å®‰å…¨æ£€æŸ¥ã€‚</li>
</ul>
<p>ä¸‹é¢çš„ä¾‹å­æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„ä¿æŠ¤ä»£ç†æ¥æŸ¥çœ‹å’Œæ·»åŠ ç”¨æˆ·ã€‚</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">class</span> SensitiveInfo:</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">        <span class="va">self</span>.users <span class="op">=</span> [<span class="st">&#39;nick&#39;</span>, <span class="st">&#39;tom&#39;</span>, <span class="st">&#39;ben&#39;</span>, <span class="st">&#39;mike&#39;</span>]</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">        </a>
<a class="sourceLine" id="cb3-5" data-line-number="5">    <span class="kw">def</span> read(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">        <span class="bu">print</span>(<span class="st">&#39;There are </span><span class="sc">{}</span><span class="st"> users: </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="bu">len</span>(<span class="va">self</span>.users), <span class="st">&#39;&#39;</span>.join(<span class="va">self</span>.users)))</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">        </a>
<a class="sourceLine" id="cb3-8" data-line-number="8">    <span class="kw">def</span> add(<span class="va">self</span>, user):</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">        <span class="va">self</span>.users.append(user)</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">        <span class="bu">print</span>(<span class="st">&#39;Added user </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(user))</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">        </a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="kw">class</span> Info:</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">    <span class="co">&quot;&quot;&quot;SensitiveInfoçš„ä¿æŠ¤ä»£ç†&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb3-15" data-line-number="15">        <span class="va">self</span>.protected <span class="op">=</span> SensitiveInfo()</a>
<a class="sourceLine" id="cb3-16" data-line-number="16">        <span class="va">self</span>.secret <span class="op">=</span> <span class="st">&#39;0xdeadbeef&#39;</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17">    </a>
<a class="sourceLine" id="cb3-18" data-line-number="18">    <span class="kw">def</span> read(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb3-19" data-line-number="19">        <span class="va">self</span>.protected.read()</a>
<a class="sourceLine" id="cb3-20" data-line-number="20">        </a>
<a class="sourceLine" id="cb3-21" data-line-number="21">    <span class="kw">def</span> add(<span class="va">self</span>, user):</a>
<a class="sourceLine" id="cb3-22" data-line-number="22">        sec <span class="op">=</span> <span class="bu">input</span>(<span class="st">&#39;what is the secret&#39;</span>)</a>
<a class="sourceLine" id="cb3-23" data-line-number="23">        <span class="va">self</span>.protected.add(user) <span class="cf">if</span> sec <span class="op">==</span> <span class="va">self</span>.secret <span class="cf">else</span> <span class="bu">print</span>(<span class="st">&quot;That&#39;s wrong&quot;</span>)</a>
<a class="sourceLine" id="cb3-24" data-line-number="24">        </a>
<a class="sourceLine" id="cb3-25" data-line-number="25"><span class="kw">def</span> main():</a>
<a class="sourceLine" id="cb3-26" data-line-number="26">    info <span class="op">=</span> Info()</a>
<a class="sourceLine" id="cb3-27" data-line-number="27">    </a>
<a class="sourceLine" id="cb3-28" data-line-number="28">    <span class="cf">while</span> <span class="va">True</span>:</a>
<a class="sourceLine" id="cb3-29" data-line-number="29">        <span class="bu">print</span>(<span class="st">&#39;1. read list |==| 2. add user |==| 3. quit&#39;</span>)</a>
<a class="sourceLine" id="cb3-30" data-line-number="30">        key <span class="op">=</span> <span class="bu">input</span>(<span class="st">&#39;choose option: &#39;</span>)</a>
<a class="sourceLine" id="cb3-31" data-line-number="31">        <span class="cf">if</span> key <span class="op">==</span> <span class="st">&#39;1&#39;</span>:</a>
<a class="sourceLine" id="cb3-32" data-line-number="32">            info.read()</a>
<a class="sourceLine" id="cb3-33" data-line-number="33">        <span class="cf">elif</span> key <span class="op">==</span> <span class="st">&#39;2&#39;</span>:</a>
<a class="sourceLine" id="cb3-34" data-line-number="34">            name <span class="op">=</span> <span class="bu">input</span>(<span class="st">&#39;choose username: &#39;</span>)</a>
<a class="sourceLine" id="cb3-35" data-line-number="35">            info.add(name)</a>
<a class="sourceLine" id="cb3-36" data-line-number="36">        <span class="cf">elif</span> key <span class="op">==</span> <span class="st">&#39;3&#39;</span>:</a>
<a class="sourceLine" id="cb3-37" data-line-number="37">            exit()</a>
<a class="sourceLine" id="cb3-38" data-line-number="38">        <span class="cf">else</span>:</a>
<a class="sourceLine" id="cb3-39" data-line-number="39">            <span class="bu">print</span>(<span class="st">&#39;unknown option: </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(key))</a>
<a class="sourceLine" id="cb3-40" data-line-number="40"></a>
<a class="sourceLine" id="cb3-41" data-line-number="41"><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</a>
<a class="sourceLine" id="cb3-42" data-line-number="42">    main()</a></code></pre></div>
<p><u>è´£ä»»é“¾æ¨¡å¼</u></p>
<p>è´£ä»»é“¾ï¼ˆ<code>Chain of Responsibility</code>ï¼‰æ¨¡å¼ç”¨äºè®©å¤šä¸ªå¯¹è±¡æ¥å¤„ç†å•ä¸ªè¯·æ±‚æ—¶ï¼Œæˆ–è€…ç”¨äºé¢„å…ˆä¸çŸ¥é“åº”è¯¥ç”±å“ªä¸ªå¯¹è±¡ï¼ˆæ¥è‡ªæŸä¸ªå¯¹è±¡é“¾ï¼‰æ¥å¤„ç†æŸä¸ªç‰¹å®šè¯·æ±‚æ—¶ã€‚åœ¨æ— æ³•é¢„çŸ¥çŸ¥é“å¤„ç†ç¨‹åºçš„æ•°é‡å’Œç±»å‹æ—¶ï¼Œè¯¥æ¨¡å¼æœ‰åŠ©äºå¯¹è¯·æ±‚ï¼å¤„ç†äº‹æƒ…è¿›è¡Œå»ºæ¨¡ã€‚é€‚åˆä½¿ç”¨è´£ä»»é“¾æ¨¡å¼çš„ç³»ç»Ÿä¾‹å­åŒ…æ‹¬åŸºäºäº‹ä»¶çš„ç³»ç»Ÿã€é‡‡è´­ç³»ç»Ÿå’Œè¿è¾“ç³»ç»Ÿã€‚</p>
<p>ä¸‹é¢æ˜¯ç”¨è´£ä»»é“¾æ¨¡å¼å®ç°ä¸€ä¸ªç®€å•çš„äº‹ä»¶ç³»ç»Ÿã€‚</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">class</span> Event:</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name):</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">        <span class="va">self</span>.name <span class="op">=</span> name</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">    </a>
<a class="sourceLine" id="cb4-5" data-line-number="5">    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">        <span class="cf">return</span> <span class="va">self</span>.name</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">    </a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="kw">class</span> Widget:</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, parent<span class="op">=</span><span class="va">None</span>):</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">        <span class="va">self</span>.parent <span class="op">=</span> parent</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">    </a>
<a class="sourceLine" id="cb4-12" data-line-number="12">    <span class="kw">def</span> handle(<span class="va">self</span>, event):</a>
<a class="sourceLine" id="cb4-13" data-line-number="13">        handler <span class="op">=</span> <span class="st">&#39;handler_</span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(event)</a>
<a class="sourceLine" id="cb4-14" data-line-number="14">        <span class="cf">if</span> <span class="bu">hasattr</span>(<span class="va">self</span>, handler):</a>
<a class="sourceLine" id="cb4-15" data-line-number="15">            method <span class="op">=</span> <span class="bu">getattr</span>(<span class="va">self</span>, handler)</a>
<a class="sourceLine" id="cb4-16" data-line-number="16">            method(event)</a>
<a class="sourceLine" id="cb4-17" data-line-number="17">        <span class="cf">elif</span> <span class="va">self</span>.parent:</a>
<a class="sourceLine" id="cb4-18" data-line-number="18">            <span class="va">self</span>.parent.handler(event)</a>
<a class="sourceLine" id="cb4-19" data-line-number="19">        <span class="cf">elif</span> <span class="bu">hasattr</span>(<span class="va">self</span>, <span class="st">&#39;handler_default&#39;</span>):</a>
<a class="sourceLine" id="cb4-20" data-line-number="20">            <span class="va">self</span>.handler_default(event)</a>
<a class="sourceLine" id="cb4-21" data-line-number="21"></a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="kw">class</span> MainWindow(Widget):</a>
<a class="sourceLine" id="cb4-23" data-line-number="23">    <span class="kw">def</span> handle_close(<span class="va">self</span>, event):</a>
<a class="sourceLine" id="cb4-24" data-line-number="24">        <span class="bu">print</span>(<span class="st">&#39;MainWindow: </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(event))</a>
<a class="sourceLine" id="cb4-25" data-line-number="25">    </a>
<a class="sourceLine" id="cb4-26" data-line-number="26">    <span class="kw">def</span> handler_default(<span class="va">self</span>, event):</a>
<a class="sourceLine" id="cb4-27" data-line-number="27">        <span class="bu">print</span>(<span class="st">&#39;MainWindow: </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(event))</a>
<a class="sourceLine" id="cb4-28" data-line-number="28">        </a>
<a class="sourceLine" id="cb4-29" data-line-number="29"><span class="kw">class</span> SendDialog(Widget):</a>
<a class="sourceLine" id="cb4-30" data-line-number="30">    <span class="kw">def</span> handle_paint(<span class="va">self</span>, event):</a>
<a class="sourceLine" id="cb4-31" data-line-number="31">        <span class="bu">print</span>(<span class="st">&#39;SendDialog: </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(event))</a>
<a class="sourceLine" id="cb4-32" data-line-number="32">        </a>
<a class="sourceLine" id="cb4-33" data-line-number="33"><span class="kw">class</span> MsgText(Widget):</a>
<a class="sourceLine" id="cb4-34" data-line-number="34">    <span class="kw">def</span> handler_down(<span class="va">self</span>, event):</a>
<a class="sourceLine" id="cb4-35" data-line-number="35">        <span class="bu">print</span>(<span class="st">&#39;MsgText: </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(event))</a>
<a class="sourceLine" id="cb4-36" data-line-number="36">        </a>
<a class="sourceLine" id="cb4-37" data-line-number="37"><span class="kw">def</span> main():</a>
<a class="sourceLine" id="cb4-38" data-line-number="38">    mw <span class="op">=</span> MainWindow()</a>
<a class="sourceLine" id="cb4-39" data-line-number="39">    sd <span class="op">=</span> SendDialog(mw)</a>
<a class="sourceLine" id="cb4-40" data-line-number="40">    msg <span class="op">=</span> MsgText(sd)</a>
<a class="sourceLine" id="cb4-41" data-line-number="41">    </a>
<a class="sourceLine" id="cb4-42" data-line-number="42">    <span class="cf">for</span> e <span class="kw">in</span> (<span class="st">&#39;down&#39;</span>, <span class="st">&#39;paint&#39;</span>, <span class="st">&#39;unhandled&#39;</span>, <span class="st">&#39;close&#39;</span>):</a>
<a class="sourceLine" id="cb4-43" data-line-number="43">        evt <span class="op">=</span> Event(e)</a>
<a class="sourceLine" id="cb4-44" data-line-number="44">        <span class="bu">print</span>(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">Sending event -</span><span class="sc">{}</span><span class="st">- to MainWindow&#39;</span>.<span class="bu">format</span>(evt))</a>
<a class="sourceLine" id="cb4-45" data-line-number="45">        mw.handle(evt)</a>
<a class="sourceLine" id="cb4-46" data-line-number="46">        <span class="bu">print</span>(<span class="st">&#39;Sending event -</span><span class="sc">{}</span><span class="st">- to SendDialog&#39;</span>.<span class="bu">format</span>(evt))</a>
<a class="sourceLine" id="cb4-47" data-line-number="47">        sd.handle(evt)</a>
<a class="sourceLine" id="cb4-48" data-line-number="48">        <span class="bu">print</span>(<span class="st">&#39;Sending event -</span><span class="sc">{}</span><span class="st">- to MsgText&#39;</span>.<span class="bu">format</span>(evt))</a>
<a class="sourceLine" id="cb4-49" data-line-number="49">        msg.handle(evt)</a>
<a class="sourceLine" id="cb4-50" data-line-number="50"></a>
<a class="sourceLine" id="cb4-51" data-line-number="51"><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</a>
<a class="sourceLine" id="cb4-52" data-line-number="52">    main()</a></code></pre></div>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/21/ã€ŠPythonè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°ä¸€/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Peter Tsung">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/pandas.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å½¼å¾—çš„åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/21/ã€ŠPythonè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°ä¸€/" itemprop="url">
                  ã€ŠPythonè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°ä¸€
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-07-21T15:40:54+08:00">
                2017-07-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-Notes/" itemprop="url" rel="index">
                    <span itemprop="name">Python_Notes</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è¿™å‘¨å¼€å§‹é˜…è¯»ã€Šç²¾é€šPythonè®¾è®¡æ¨¡å¼ã€‹ï¼Œæœ¬å‘¨çš„å­¦ä¹ è®¡åˆ’æ˜¯é˜…è¯»<code>å·¥å‚æ¨¡å¼</code>ã€<code>å»ºé€ è€…æ¨¡å¼</code>ã€<code>åŸå‹æ¨¡å¼</code>ã€<code>é€‚é…å™¨æ¨¡å¼</code>å’Œ<code>ä¿®é¥°å™¨æ¨¡å¼</code>ã€‚</p>
<p>åœ¨å·¥å‚æ¨¡å¼ä¸­ï¼Œå®¢æˆ·ç«¯å¯ä»¥è¯·æ±‚ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œæ— éœ€çŸ¥é“è¿™ä¸ªå¯¹è±¡æ¥è‡ªå“ªé‡Œï¼›ä¹Ÿå°±æ˜¯ä½¿ç”¨å“ªä¸ªç±»æ¥ç”Ÿæˆè¿™ä¸ªå¯¹è±¡ã€‚å·¥å‚èƒŒåçš„æ€æƒ³æ˜¯ç®€åŒ–å¯¹è±¡çš„åˆ›å»ºï¼ŒåŸºäºä¸€ä¸ªä¸­å¿ƒåŒ–å‡½æ•°æ¥å®ç°ï¼Œæ›´æ˜“äºè¿½è¸ªåˆ›å»ºäº†å“ªäº›å¯¹è±¡ã€‚é€šè¿‡å°†åˆ›å»ºå¯¹è±¡çš„ä»£ç å’Œä½¿ç”¨å¯¹è±¡çš„ä»£ç è§£è€¦ï¼Œå·¥å‚èƒ½å¤Ÿé™ä½åº”ç”¨ç»´æŠ¤çš„å¤æ‚åº¦ã€‚</p>
<p>å·¥å‚é€šå¸¸æœ‰ä¸¤ç§å½¢å¼ï¼šä¸€ç§æ˜¯å·¥å‚æ–¹æ³•(<code>Factory Method</code>)ï¼Œå¯¹ä¸åŒçš„è¾“å…¥å‚æ•°è¿”å›ä¸åŒçš„å¯¹è±¡ï¼›ç¬¬äºŒç§æ˜¯æŠ½è±¡å·¥å‚ï¼Œå®ƒæ˜¯ä¸€ç»„ç”¨äºåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³äº§å“çš„ç³»åˆ—ã€‚</p>
<p>åœ¨å·¥å‚æ–¹æ³•æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬æ‰§è¡Œå•ä¸ªå‡½æ•°ï¼Œä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼ˆæä¾›ä¿¡æ¯è¡¨æ˜æˆ‘ä»¬æƒ³è¦ä»€ä¹ˆï¼‰ï¼Œä½†å¹¶ä¸è¦æ±‚çŸ¥é“ä»»ä½•å…³äºå¯¹è±¡å¦‚ä½•å®ç°ä»¥åŠå¯¹è±¡æ¥è‡ªå“ªé‡Œçš„ç»†èŠ‚ã€‚</p>
<p>ä¸‹é¢æœ‰ä¸€ä¸ªä¾‹å­ï¼Œå°±æ˜¯æœ‰ä¸€äº›è¾“å…¥æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªXMLæ–‡ä»¶å’Œä¸€ä¸ªJSONæ–‡ä»¶ä¸­ï¼Œè¦å¯¹è¿™ä¸¤ä¸ªæ–‡ä»¶è¿›è¡Œè§£æï¼Œè·å–ä¸€äº›ä¿¡æ¯ã€‚åŒæ—¶ï¼Œå¸Œæœ›èƒ½å¤Ÿå¯¹è¿™äº›ï¼ˆä»¥åŠå°†æ¥æ¶‰åŠçš„æ‰€æœ‰ï¼‰å¤–éƒ¨æœåŠ¡è¿›è¡Œé›†ä¸­å¼çš„å®¢æˆ·ç«¯è¿æ¥ã€‚ç„¶ååˆ†åˆ«ä½¿ç”¨<code>Python</code>çš„ä¸¤ä¸ªåº“ï¼ˆ<code>xml.etree.ElementTree</code>å’Œ<code>json</code>ï¼‰æ¥å¤„ç†XMLå’ŒJSONã€‚</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="im">import</span> xml.etree.ElementTree <span class="im">as</span> etree</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="im">import</span> json</a></code></pre></div>
<p>ç±»<code>JSONConnector</code>è§£æJSONæ–‡ä»¶ï¼Œé€šè¿‡<code>parsed_data()</code>æ–¹æ³•ä»¥ä¸€ä¸ªå­—å…¸ï¼ˆ<code>dict</code>ï¼‰çš„å½¢å¼è¿”å›æ•°æ®ã€‚ä¿®é¥°å™¨<code>property</code>ä½¿<code>parsed_data()</code>æ˜¾å¾—æ›´åƒä¸€ä¸ªå¸¸è§„çš„å˜é‡ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ–¹æ³•ã€‚</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">class</span> JSONConnector:</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">    </a>
<a class="sourceLine" id="cb2-3" data-line-number="3">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, filepath):</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">        <span class="va">self</span>.data <span class="op">=</span> <span class="bu">dict</span>()</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">        <span class="cf">with</span> <span class="bu">open</span>(filepath, mode<span class="op">=</span><span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">            <span class="va">self</span>.data <span class="op">=</span> json.load(f)</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">    </a>
<a class="sourceLine" id="cb2-8" data-line-number="8">    <span class="at">@property</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">    <span class="kw">def</span> parsed_data(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">        <span class="cf">return</span> <span class="va">self</span>.data</a></code></pre></div>
<p>ç±»<code>XMLConnector</code>è§£æXMLæ–‡ä»¶ï¼Œé€šè¿‡<code>parsed_data()</code>æ–¹æ³•ä»¥<code>xml.etree.Element</code>åˆ—è¡¨çš„å½¢å¼è¿”å›æ‰€æœ‰æ•°æ®ã€‚</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">class</span> XMLConnector:</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">    </a>
<a class="sourceLine" id="cb3-3" data-line-number="3">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, filepath):</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">        <span class="va">self</span>.tree <span class="op">=</span> etree.parse(filepath)</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">        </a>
<a class="sourceLine" id="cb3-6" data-line-number="6">    <span class="at">@property</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7">    <span class="kw">def</span> parsed_data(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">        <span class="cf">return</span> <span class="va">self</span>.tree</a></code></pre></div>
<p>å‡½æ•°<code>connection_factory</code>æ˜¯ä¸€ä¸ªå·¥å‚æ–¹æ³•ï¼ŒåŸºäºè¾“å…¥æ–‡ä»¶è·¯å¾„çš„æ‰©å±•åè¿”å›ä¸€ä¸ª<code>JSONConnector</code>æˆ–<code>XMLConnector</code>çš„å®ä¾‹ã€‚</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">def</span> connector_factory(filepath):</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">    <span class="cf">if</span> filepath.endswith(<span class="st">&#39;json&#39;</span>):</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">        connector <span class="op">=</span> JSONConnector</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">    <span class="cf">elif</span> filepath.endswith(<span class="st">&#39;xml&#39;</span>):</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">        connector <span class="op">=</span> XMLConnector</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">    <span class="cf">else</span>:</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&#39;Cannot connect to </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(filepath))</a></code></pre></div>
<p>ä¸ºä¾¿äºæ•´ä½“ç†è§£ï¼Œä¸‹é¢ç»™å‡ºå·¥å‚æ–¹æ³•å®ç°çš„å®Œæ•´ä»£ç ã€‚</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="im">import</span> xml.etree.ElementTree <span class="im">as</span> etree</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="im">import</span> json</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="kw">class</span> JSONConnector:</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, filepath):</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">        <span class="va">self</span>.data <span class="op">=</span> <span class="bu">dict</span>()</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">        <span class="cf">with</span> <span class="bu">open</span>(filepath, mode<span class="op">=</span><span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">            <span class="va">self</span>.data <span class="op">=</span> json.load(f)</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">    <span class="at">@property</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10">    <span class="kw">def</span> parsed_data(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">        <span class="cf">return</span> <span class="va">self</span>.data</a>
<a class="sourceLine" id="cb5-12" data-line-number="12"></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="kw">class</span> XMLConnector:</a>
<a class="sourceLine" id="cb5-14" data-line-number="14">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, filepath):</a>
<a class="sourceLine" id="cb5-15" data-line-number="15">        <span class="va">self</span>.tree <span class="op">=</span> etree.parse(filepath)</a>
<a class="sourceLine" id="cb5-16" data-line-number="16">        </a>
<a class="sourceLine" id="cb5-17" data-line-number="17">    <span class="at">@property</span></a>
<a class="sourceLine" id="cb5-18" data-line-number="18">    <span class="kw">def</span> parsed_data(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb5-19" data-line-number="19">        <span class="cf">return</span> <span class="va">self</span>.tree</a>
<a class="sourceLine" id="cb5-20" data-line-number="20"></a>
<a class="sourceLine" id="cb5-21" data-line-number="21"><span class="kw">def</span> connection_factory(filepath):</a>
<a class="sourceLine" id="cb5-22" data-line-number="22">    <span class="cf">if</span> filepath.endswith(<span class="st">&#39;json&#39;</span>):</a>
<a class="sourceLine" id="cb5-23" data-line-number="23">        connector <span class="op">=</span> JSONConnector</a>
<a class="sourceLine" id="cb5-24" data-line-number="24">    <span class="cf">elif</span> filepath.endswith(<span class="st">&#39;xml&#39;</span>):</a>
<a class="sourceLine" id="cb5-25" data-line-number="25">        connector <span class="op">=</span> XMLConnector</a>
<a class="sourceLine" id="cb5-26" data-line-number="26">    <span class="cf">else</span>:</a>
<a class="sourceLine" id="cb5-27" data-line-number="27">        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&#39;Cannot connect to </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(filepath))</a>
<a class="sourceLine" id="cb5-28" data-line-number="28">    <span class="cf">return</span> connector(filepath)</a>
<a class="sourceLine" id="cb5-29" data-line-number="29">                  </a>
<a class="sourceLine" id="cb5-30" data-line-number="30"><span class="kw">def</span> connect_to(filepath):</a>
<a class="sourceLine" id="cb5-31" data-line-number="31">    factory <span class="op">=</span> <span class="va">None</span></a>
<a class="sourceLine" id="cb5-32" data-line-number="32">    <span class="cf">try</span>:</a>
<a class="sourceLine" id="cb5-33" data-line-number="33">        factory <span class="op">=</span> connection_factory(filepath)</a>
<a class="sourceLine" id="cb5-34" data-line-number="34">    <span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> ve:</a>
<a class="sourceLine" id="cb5-35" data-line-number="35">        <span class="bu">print</span>(ve)</a>
<a class="sourceLine" id="cb5-36" data-line-number="36">    <span class="cf">return</span> factory</a>
<a class="sourceLine" id="cb5-37" data-line-number="37"></a>
<a class="sourceLine" id="cb5-38" data-line-number="38"><span class="kw">def</span> main():</a>
<a class="sourceLine" id="cb5-39" data-line-number="39">    sqlite_factory <span class="op">=</span> connect_to(<span class="st">&#39;data/person.sq3&#39;</span>)</a>
<a class="sourceLine" id="cb5-40" data-line-number="40">    <span class="bu">print</span>()</a>
<a class="sourceLine" id="cb5-41" data-line-number="41">    </a>
<a class="sourceLine" id="cb5-42" data-line-number="42">    xml_factory <span class="op">=</span> connect_to(<span class="st">&#39;data/person.xml&#39;</span>)</a>
<a class="sourceLine" id="cb5-43" data-line-number="43">    xml_data <span class="op">=</span> xml_factory.parsed_data</a>
<a class="sourceLine" id="cb5-44" data-line-number="44">    liars <span class="op">=</span> xml_data.findall(<span class="st">&quot;.//</span><span class="sc">{}</span><span class="st">[</span><span class="sc">{}</span><span class="st">=&#39;</span><span class="sc">{}</span><span class="st">&#39;]&quot;</span>.<span class="bu">format</span>(<span class="st">&#39;person&#39;</span>, <span class="st">&#39;lastName&#39;</span>, <span class="st">&#39;Liar&#39;</span>))</a>
<a class="sourceLine" id="cb5-45" data-line-number="45">    <span class="bu">print</span>(<span class="st">&#39;found: </span><span class="sc">{}</span><span class="st"> persons&#39;</span>.<span class="bu">format</span>(<span class="bu">len</span>(liars)))</a>
<a class="sourceLine" id="cb5-46" data-line-number="46">    <span class="cf">for</span> liar <span class="kw">in</span> liars:</a>
<a class="sourceLine" id="cb5-47" data-line-number="47">        <span class="bu">print</span>(<span class="st">&#39;first name: </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(liar.find(<span class="st">&#39;firstName&#39;</span>).text))</a>
<a class="sourceLine" id="cb5-48" data-line-number="48">        <span class="bu">print</span>(<span class="st">&#39;last name: </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(liar.find(<span class="st">&#39;lastName&#39;</span>).text))</a>
<a class="sourceLine" id="cb5-49" data-line-number="49">        [<span class="bu">print</span>(<span class="st">&#39;phone number (</span><span class="sc">{}</span><span class="st">)&#39;</span>.<span class="bu">format</span>(p.attrib[<span class="st">&#39;type&#39;</span>]), p.text) <span class="cf">for</span> p <span class="kw">in</span> liar.find(<span class="st">&#39;phoneNumbers&#39;</span>)]</a>
<a class="sourceLine" id="cb5-50" data-line-number="50">    <span class="bu">print</span>()</a>
<a class="sourceLine" id="cb5-51" data-line-number="51">    </a>
<a class="sourceLine" id="cb5-52" data-line-number="52">    json_factory <span class="op">=</span> connect_to(<span class="st">&#39;data/donut.json&#39;</span>)</a>
<a class="sourceLine" id="cb5-53" data-line-number="53">    json_data <span class="op">=</span> json_factory.parsed_data</a>
<a class="sourceLine" id="cb5-54" data-line-number="54">    <span class="bu">print</span>(<span class="st">&#39;found: </span><span class="sc">{}</span><span class="st"> donuts&#39;</span>.<span class="bu">format</span>(<span class="bu">len</span>(json_data)))</a>
<a class="sourceLine" id="cb5-55" data-line-number="55">    <span class="cf">for</span> donut <span class="kw">in</span> json_data:</a>
<a class="sourceLine" id="cb5-56" data-line-number="56">        <span class="bu">print</span>(<span class="st">&#39;name: </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(donut[<span class="st">&#39;name&#39;</span>]))</a>
<a class="sourceLine" id="cb5-57" data-line-number="57">        <span class="bu">print</span>(<span class="st">&#39;price: $</span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(donut[<span class="st">&#39;ppu&#39;</span>]))</a>
<a class="sourceLine" id="cb5-58" data-line-number="58">        [<span class="bu">print</span>(<span class="st">&#39;topping: </span><span class="sc">{}</span><span class="st"> </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(t[<span class="st">&#39;id&#39;</span>], t[<span class="st">&#39;type&#39;</span>])) <span class="cf">for</span> t <span class="kw">in</span> donut[<span class="st">&#39;topping&#39;</span>]]</a>
<a class="sourceLine" id="cb5-59" data-line-number="59"></a>
<a class="sourceLine" id="cb5-60" data-line-number="60"><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</a>
<a class="sourceLine" id="cb5-61" data-line-number="61">    main()</a></code></pre></div>
<p>å¯¹äºæŠ½è±¡å·¥å‚ï¼Œå®ƒæ‹¥æœ‰å·¥å‚æ–¹æ³•æ¨¡å¼çš„å¥½å¤„ï¼šè®©å¯¹è±¡çš„åˆ›å»ºæ›´å®¹æ˜“è¿½è¸ªï¼›å°†å¯¹è±¡åˆ›å»ºä¸ä½¿ç”¨è§£è€¦ï¼›æä¾›ä¼˜åŒ–å†…å­˜å ç”¨å’Œåº”ç”¨æ€§èƒ½çš„æ½œåŠ›ã€‚è€ŒæŠ½è±¡å·¥å‚æœ‰ä¸€ä¸ªä¼˜ç‚¹ï¼Œå°±æ˜¯åœ¨ä½¿ç”¨å·¥å‚æ–¹æ³•æ—¶ä»ç”¨æˆ·è§†è§’é€šå¸¸æ˜¯çœ‹ä¸åˆ°çš„ï¼Œé‚£å°±æ˜¯æŠ½è±¡å·¥å‚èƒ½å¤Ÿé€šè¿‡æ”¹å˜æ¿€æ´»çš„å·¥å‚æ–¹æ³•åŠ¨æ€åœ°ï¼ˆè¿è¡Œæ—¶ï¼‰æ”¹å˜åº”ç”¨è¡Œä¸ºã€‚</p>
<p>ä¸‹é¢å°è¯•åˆ›å»ºä¸€ä¸ªæ¸¸æˆï¼ŒåŒ…å«ä¸¤ä¸ªæ¸¸æˆï¼Œä¸€ä¸ªé¢å‘å­©å­ï¼Œä¸€ä¸ªé¢å‘æˆäººã€‚åœ¨è¿è¡Œæ—¶ï¼ŒåŸºäºç”¨æˆ·è¾“å…¥ï¼Œå†³å®šè¯¥åˆ›å»ºå“ªä¸ªæ¸¸æˆå¹¶è¿è¡Œã€‚æ¸¸æˆçš„åˆ›å»ºéƒ¨åˆ†ç”±ä¸€ä¸ªæŠ½è±¡å·¥å‚ç»´æŠ¤ã€‚</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">class</span> Frog:</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name):</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">        <span class="va">self</span>.name <span class="op">=</span> name</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">        </a>
<a class="sourceLine" id="cb6-5" data-line-number="5">    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">        <span class="cf">return</span> <span class="va">self</span>.name</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">    </a>
<a class="sourceLine" id="cb6-8" data-line-number="8">    <span class="kw">def</span> interact_with(<span class="va">self</span>, obstacle):</a>
<a class="sourceLine" id="cb6-9" data-line-number="9">        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{}</span><span class="st"> the Frog encounters </span><span class="sc">{}</span><span class="st"> and </span><span class="sc">{}</span><span class="st">!&#39;</span>.<span class="bu">format</span>(<span class="va">self</span>, obstacle, obstacle.action()))</a>
<a class="sourceLine" id="cb6-10" data-line-number="10">        </a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="kw">class</span> Bug:</a>
<a class="sourceLine" id="cb6-12" data-line-number="12">    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb6-13" data-line-number="13">        <span class="cf">return</span> <span class="st">&#39;a bug&#39;</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14">    </a>
<a class="sourceLine" id="cb6-15" data-line-number="15">    <span class="kw">def</span> action(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb6-16" data-line-number="16">        <span class="cf">return</span> <span class="st">&#39;eats it&#39;</span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17">    </a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="kw">class</span> FrogWorld:</a>
<a class="sourceLine" id="cb6-19" data-line-number="19">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name):</a>
<a class="sourceLine" id="cb6-20" data-line-number="20">        <span class="bu">print</span>(<span class="va">self</span>)</a>
<a class="sourceLine" id="cb6-21" data-line-number="21">        <span class="va">self</span>.player_name <span class="op">=</span> name</a>
<a class="sourceLine" id="cb6-22" data-line-number="22">    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb6-23" data-line-number="23">        <span class="cf">return</span> <span class="st">&#39;</span><span class="ch">\n\n\t</span><span class="st">------ Frog World -------&#39;</span></a>
<a class="sourceLine" id="cb6-24" data-line-number="24">    </a>
<a class="sourceLine" id="cb6-25" data-line-number="25">    <span class="kw">def</span> make_character(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb6-26" data-line-number="26">        <span class="cf">return</span> Frog(<span class="va">self</span>.player_name)</a>
<a class="sourceLine" id="cb6-27" data-line-number="27">    </a>
<a class="sourceLine" id="cb6-28" data-line-number="28">    <span class="kw">def</span> make_obstacle(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb6-29" data-line-number="29">        <span class="cf">return</span> Bug()</a>
<a class="sourceLine" id="cb6-30" data-line-number="30"></a>
<a class="sourceLine" id="cb6-31" data-line-number="31"><span class="kw">class</span> Wizard:</a>
<a class="sourceLine" id="cb6-32" data-line-number="32">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name):</a>
<a class="sourceLine" id="cb6-33" data-line-number="33">        <span class="va">self</span>.name <span class="op">=</span> name</a>
<a class="sourceLine" id="cb6-34" data-line-number="34">        </a>
<a class="sourceLine" id="cb6-35" data-line-number="35">    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb6-36" data-line-number="36">        <span class="cf">return</span> <span class="va">self</span>.name</a>
<a class="sourceLine" id="cb6-37" data-line-number="37">    </a>
<a class="sourceLine" id="cb6-38" data-line-number="38">    <span class="kw">def</span> interact_with(<span class="va">self</span>, obstacle):</a>
<a class="sourceLine" id="cb6-39" data-line-number="39">        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{}</span><span class="st"> the Wizard battles against </span><span class="sc">{}</span><span class="st"> and </span><span class="sc">{}</span><span class="st">!&#39;</span>.<span class="bu">format</span>(<span class="va">self</span>, obstacle, obstacle.action()))</a>
<a class="sourceLine" id="cb6-40" data-line-number="40"> </a>
<a class="sourceLine" id="cb6-41" data-line-number="41"><span class="kw">class</span> Ork:</a>
<a class="sourceLine" id="cb6-42" data-line-number="42">    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb6-43" data-line-number="43">        <span class="cf">return</span> <span class="st">&#39;an evil ork&#39;</span></a>
<a class="sourceLine" id="cb6-44" data-line-number="44">    </a>
<a class="sourceLine" id="cb6-45" data-line-number="45">    <span class="kw">def</span> action(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb6-46" data-line-number="46">        <span class="cf">return</span> <span class="st">&#39;kills it&#39;</span></a>
<a class="sourceLine" id="cb6-47" data-line-number="47">    </a>
<a class="sourceLine" id="cb6-48" data-line-number="48"><span class="kw">class</span> WizardWorld:</a>
<a class="sourceLine" id="cb6-49" data-line-number="49">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name):</a>
<a class="sourceLine" id="cb6-50" data-line-number="50">        <span class="bu">print</span>(<span class="va">self</span>)</a>
<a class="sourceLine" id="cb6-51" data-line-number="51">        <span class="va">self</span>.player_name <span class="op">=</span> name</a>
<a class="sourceLine" id="cb6-52" data-line-number="52">        </a>
<a class="sourceLine" id="cb6-53" data-line-number="53">    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb6-54" data-line-number="54">        <span class="cf">return</span> <span class="st">&#39;</span><span class="ch">\n\n\t</span><span class="st"> ----- Wizard World -----&#39;</span></a>
<a class="sourceLine" id="cb6-55" data-line-number="55">    </a>
<a class="sourceLine" id="cb6-56" data-line-number="56">    <span class="kw">def</span> make_character(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb6-57" data-line-number="57">        <span class="cf">return</span> Wizard(<span class="va">self</span>.player_name)</a>
<a class="sourceLine" id="cb6-58" data-line-number="58">    </a>
<a class="sourceLine" id="cb6-59" data-line-number="59">    <span class="kw">def</span> make_obstacle(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb6-60" data-line-number="60">        <span class="cf">return</span> Ork()</a></code></pre></div>
<p>å»ºé€ è€…æ¨¡å¼å’Œå·¥å‚æ¨¡å¼çš„å·®åˆ«å¹¶ä¸å¤ªæ˜ç¡®ã€‚ä¸»è¦çš„åŒºåˆ«åœ¨äºå·¥å‚æ¨¡å¼ä»¥å•ä¸ªæ­¥éª¤åˆ›å»ºå¯¹è±¡ï¼Œè€Œå»ºé€ è€…æ¨¡å¼ä»¥å¤šä¸ªæ­¥éª¤åˆ›å»ºå¯¹è±¡ï¼Œå¹¶ä¸”å‡ ä¹å§‹ç»ˆä¼šä½¿ç”¨ä¸€ä¸ªæŒ‡æŒ¥è€…ã€‚å¦å¤–ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œåœ¨å·¥å‚æ¨¡å¼ä¸‹ï¼Œä¼šç«‹å³è¿”å›ä¸€ä¸ªåˆ›å»ºå¥½çš„å¯¹è±¡ï¼›è€Œåœ¨å»ºé€ è€…æ¨¡å¼ä¸‹ï¼Œä»…åœ¨éœ€è¦æ—¶å®¢æˆ·ç«¯ä»£ç æ‰æ˜¾å¼åœ°è¯·æ±‚æŒ‡æŒ¥è€…è¿”å›æœ€ç»ˆçš„å¯¹è±¡å’Œç½‘é¡µã€‚</p>
<p>ä¸‹é¢ç”¨å»ºé€ è€…è®¾è®¡æ¨¡å¼æ¥å®ç°ä¸€ä¸ªæ¯”è¨è®¢è´­çš„åº”ç”¨ã€‚</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="im">from</span> enum <span class="im">import</span> Enum</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="im">import</span> time</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"></a>
<a class="sourceLine" id="cb7-4" data-line-number="4">PizzaProgress <span class="op">=</span> Enum(<span class="st">&#39;PizzaProgress&#39;</span>, <span class="st">&#39;queued preparation baking ready&#39;</span>)</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">PizzaDough <span class="op">=</span> Enum(<span class="st">&#39;PizzaDough&#39;</span>, <span class="st">&#39;thin thick&#39;</span>)</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">PizzaSauce <span class="op">=</span> Enum(<span class="st">&#39;PizzaSauce&#39;</span>, <span class="st">&#39;tomato creme_fraiche&#39;</span>)</a>
<a class="sourceLine" id="cb7-7" data-line-number="7">PizzaTopping <span class="op">=</span> Enum(<span class="st">&#39;PizzaTopping&#39;</span>, <span class="st">&#39;mozzarella double_mozzarella bacon ham mushrooms red_onion oregano&#39;</span>)</a>
<a class="sourceLine" id="cb7-8" data-line-number="8">STEP_DELAY <span class="op">=</span> <span class="dv">3</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="kw">class</span> Pizza:</a>
<a class="sourceLine" id="cb7-11" data-line-number="11">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name):</a>
<a class="sourceLine" id="cb7-12" data-line-number="12">        <span class="va">self</span>.name <span class="op">=</span> name</a>
<a class="sourceLine" id="cb7-13" data-line-number="13">        <span class="va">self</span>.dough <span class="op">=</span> <span class="va">None</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14">        <span class="va">self</span>.sauce <span class="op">=</span> <span class="va">None</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15">        <span class="va">self</span>.topping <span class="op">=</span> []</a>
<a class="sourceLine" id="cb7-16" data-line-number="16">    </a>
<a class="sourceLine" id="cb7-17" data-line-number="17">    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb7-18" data-line-number="18">        <span class="cf">return</span> <span class="va">self</span>.name</a>
<a class="sourceLine" id="cb7-19" data-line-number="19">    </a>
<a class="sourceLine" id="cb7-20" data-line-number="20">    <span class="kw">def</span> prepare_dough(<span class="va">self</span>, dough):</a>
<a class="sourceLine" id="cb7-21" data-line-number="21">        <span class="va">self</span>.dough <span class="op">=</span> dough</a>
<a class="sourceLine" id="cb7-22" data-line-number="22">        <span class="bu">print</span>(<span class="st">&#39;preparing the </span><span class="sc">{}</span><span class="st"> dough of your </span><span class="sc">{}</span><span class="st">...&#39;</span>.<span class="bu">format</span>(<span class="va">self</span>.dough.name, <span class="va">self</span>))</a>
<a class="sourceLine" id="cb7-23" data-line-number="23">        time.sleep(STEP_DELAY)</a>
<a class="sourceLine" id="cb7-24" data-line-number="24">        <span class="bu">print</span>(<span class="st">&#39;done with the </span><span class="sc">{}</span><span class="st"> dough&#39;</span>.<span class="bu">format</span>(<span class="va">self</span>.dough.name))</a>
<a class="sourceLine" id="cb7-25" data-line-number="25">        </a>
<a class="sourceLine" id="cb7-26" data-line-number="26"><span class="kw">class</span> MargaritaBuilder:</a>
<a class="sourceLine" id="cb7-27" data-line-number="27">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb7-28" data-line-number="28">        <span class="va">self</span>.pizza <span class="op">=</span> Pizza(<span class="st">&#39;Margarita&#39;</span>)</a>
<a class="sourceLine" id="cb7-29" data-line-number="29">        <span class="va">self</span>.progress <span class="op">=</span> PizzaProgress.queued</a>
<a class="sourceLine" id="cb7-30" data-line-number="30">        <span class="va">self</span>.baking_time <span class="op">=</span> <span class="dv">5</span></a>
<a class="sourceLine" id="cb7-31" data-line-number="31">        </a>
<a class="sourceLine" id="cb7-32" data-line-number="32">    <span class="kw">def</span> prepare_dough(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb7-33" data-line-number="33">        <span class="va">self</span>.progress <span class="op">=</span> PizzaProgress.preparation</a>
<a class="sourceLine" id="cb7-34" data-line-number="34">        <span class="va">self</span>.pizza.prepare_dough(PizzaDough.thin)</a>
<a class="sourceLine" id="cb7-35" data-line-number="35">    </a>
<a class="sourceLine" id="cb7-36" data-line-number="36">    <span class="kw">def</span> add_sauce(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb7-37" data-line-number="37">        <span class="bu">print</span>(<span class="st">&#39;adding the tomato sauce to your margarita...&#39;</span>)</a>
<a class="sourceLine" id="cb7-38" data-line-number="38">        <span class="va">self</span>.pizza.sauce <span class="op">=</span> PizzaSauce.tomato</a>
<a class="sourceLine" id="cb7-39" data-line-number="39">        time.sleep(STEP_DELAY)</a>
<a class="sourceLine" id="cb7-40" data-line-number="40">        <span class="bu">print</span>(<span class="st">&#39;done with the tomato sauce&#39;</span>)</a>
<a class="sourceLine" id="cb7-41" data-line-number="41">        </a>
<a class="sourceLine" id="cb7-42" data-line-number="42">    <span class="kw">def</span> add_topping(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb7-43" data-line-number="43">        <span class="bu">print</span>(<span class="st">&#39;adding the topping (double mozzarella, oregano) to your margarita&#39;</span>)</a>
<a class="sourceLine" id="cb7-44" data-line-number="44">        <span class="va">self</span>.pizza.topping.append([i <span class="cf">for</span> i <span class="kw">in</span> (PizzaTopping.double_mozzarella, PizzaTopping.oregano)])</a>
<a class="sourceLine" id="cb7-45" data-line-number="45">        time.sleep(STEP_DELAY)</a>
<a class="sourceLine" id="cb7-46" data-line-number="46">        <span class="bu">print</span>(<span class="st">&#39;done with the topping (double mozzarella, oregano)&#39;</span>)</a>
<a class="sourceLine" id="cb7-47" data-line-number="47">        </a>
<a class="sourceLine" id="cb7-48" data-line-number="48">    <span class="kw">def</span> bake(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb7-49" data-line-number="49">        <span class="va">self</span>.progress <span class="op">=</span> PizzaProgress.baking</a>
<a class="sourceLine" id="cb7-50" data-line-number="50">        <span class="bu">print</span>(<span class="st">&#39;baking your margarita for </span><span class="sc">{}</span><span class="st"> seconds&#39;</span>.<span class="bu">format</span>(<span class="va">self</span>.baking_time))</a>
<a class="sourceLine" id="cb7-51" data-line-number="51">        time.sleep(<span class="va">self</span>.baking_time)</a>
<a class="sourceLine" id="cb7-52" data-line-number="52">        <span class="bu">print</span>(<span class="st">&#39;your margarita is ready&#39;</span>)</a>
<a class="sourceLine" id="cb7-53" data-line-number="53">        </a>
<a class="sourceLine" id="cb7-54" data-line-number="54"><span class="kw">class</span> CreamyBaconBuilder:</a>
<a class="sourceLine" id="cb7-55" data-line-number="55">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb7-56" data-line-number="56">        <span class="va">self</span>.pizza <span class="op">=</span> Pizza(<span class="st">&#39;creamy bacon&#39;</span>)</a>
<a class="sourceLine" id="cb7-57" data-line-number="57">    </a>
<a class="sourceLine" id="cb7-58" data-line-number="58">    <span class="kw">def</span> prepare_dough(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb7-59" data-line-number="59">        <span class="va">self</span>.progress <span class="op">=</span> PizzaProgress.preparation</a>
<a class="sourceLine" id="cb7-60" data-line-number="60">        <span class="va">self</span>.pizza.prepare_dough(PizzaDough.thick)</a>
<a class="sourceLine" id="cb7-61" data-line-number="61">        </a>
<a class="sourceLine" id="cb7-62" data-line-number="62">    <span class="kw">def</span> add_sauce(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb7-63" data-line-number="63">        <span class="bu">print</span>(<span class="st">&#39;adding the cream sauce to your creamy bacon&#39;</span>)</a>
<a class="sourceLine" id="cb7-64" data-line-number="64">        <span class="va">self</span>.pizza.sauce <span class="op">=</span> PizzaSauce.creme_fraiche</a>
<a class="sourceLine" id="cb7-65" data-line-number="65">        time.sleep(STEP_DELAY)</a>
<a class="sourceLine" id="cb7-66" data-line-number="66">        <span class="bu">print</span>(<span class="st">&#39;done with the creme sauce&#39;</span>)</a>
<a class="sourceLine" id="cb7-67" data-line-number="67">    </a>
<a class="sourceLine" id="cb7-68" data-line-number="68">    <span class="kw">def</span> add_topping(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb7-69" data-line-number="69">        <span class="bu">print</span>(<span class="st">&#39;adding the topping (mozzarella, bacon, ham, mushrooms, red onion, oregano) to your creamy bacon&#39;</span>)</a>
<a class="sourceLine" id="cb7-70" data-line-number="70">        <span class="va">self</span>.pizza.topping.append([t <span class="cf">for</span> t <span class="kw">in</span> (PizzaTopping.mozzarella, PizzaTopping.bacon, PizzaTopping.ham, PizzaTopping.mushrooms</a>
<a class="sourceLine" id="cb7-71" data-line-number="71">                                              PizzaTopping.red_onion, PizzaTopping.oregano)])</a>
<a class="sourceLine" id="cb7-72" data-line-number="72">        time.sleep(STEP_DELAY)</a>
<a class="sourceLine" id="cb7-73" data-line-number="73">        <span class="bu">print</span>(<span class="st">&#39;done with the topping (mozzarella, bacon, ham, mushrooms, red onion, oregano)&#39;</span>)</a>
<a class="sourceLine" id="cb7-74" data-line-number="74">        </a>
<a class="sourceLine" id="cb7-75" data-line-number="75">    <span class="kw">def</span> bake(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb7-76" data-line-number="76">        <span class="va">self</span>.progress <span class="op">=</span> PizzaProgress.baking</a>
<a class="sourceLine" id="cb7-77" data-line-number="77">        <span class="bu">print</span>(<span class="st">&#39;baking your creamy bacon for </span><span class="sc">{}</span><span class="st"> seconds&#39;</span>.<span class="bu">format</span>(<span class="va">self</span>.baking_time))</a>
<a class="sourceLine" id="cb7-78" data-line-number="78">        time.sleep(<span class="va">self</span>.baking_time)</a>
<a class="sourceLine" id="cb7-79" data-line-number="79">        <span class="va">self</span>.progress <span class="op">=</span> PizzaProgress.ready</a>
<a class="sourceLine" id="cb7-80" data-line-number="80">        <span class="bu">print</span>(<span class="st">&#39;your creamy bacon is ready&#39;</span>)</a>
<a class="sourceLine" id="cb7-81" data-line-number="81">    </a>
<a class="sourceLine" id="cb7-82" data-line-number="82"><span class="kw">class</span> Waiter:</a>
<a class="sourceLine" id="cb7-83" data-line-number="83">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb7-84" data-line-number="84">        <span class="va">self</span>.buidler <span class="op">=</span> <span class="va">None</span></a>
<a class="sourceLine" id="cb7-85" data-line-number="85">        </a>
<a class="sourceLine" id="cb7-86" data-line-number="86">    <span class="kw">def</span> construct_pizza(<span class="va">self</span>, builder):</a>
<a class="sourceLine" id="cb7-87" data-line-number="87">        <span class="va">self</span>.builder <span class="op">=</span> builder</a>
<a class="sourceLine" id="cb7-88" data-line-number="88">        [step() <span class="cf">for</span> step <span class="kw">in</span> (builder.prepare_dough, builder.add_sauce, builder.add_topping, builder.bake)]</a>
<a class="sourceLine" id="cb7-89" data-line-number="89">        </a>
<a class="sourceLine" id="cb7-90" data-line-number="90">    <span class="at">@property</span></a>
<a class="sourceLine" id="cb7-91" data-line-number="91">    <span class="kw">def</span> pizza(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb7-92" data-line-number="92">        <span class="cf">return</span> <span class="va">self</span>.builder.pizza</a>
<a class="sourceLine" id="cb7-93" data-line-number="93">    </a>
<a class="sourceLine" id="cb7-94" data-line-number="94"><span class="kw">def</span> validate_style(builders):</a>
<a class="sourceLine" id="cb7-95" data-line-number="95">    <span class="cf">try</span>:</a>
<a class="sourceLine" id="cb7-96" data-line-number="96">        pizza_style <span class="op">=</span> <span class="bu">input</span>(<span class="st">&#39;What pizza would you like, [m]argarita or [c]reamy bacon?&#39;</span>)</a>
<a class="sourceLine" id="cb7-97" data-line-number="97">        builder <span class="op">=</span> builders[pizza_style]</a>
<a class="sourceLine" id="cb7-98" data-line-number="98">        valid_input <span class="op">=</span> <span class="va">True</span></a>
<a class="sourceLine" id="cb7-99" data-line-number="99">    <span class="cf">except</span> <span class="pp">KeyError</span> <span class="im">as</span> err:</a>
<a class="sourceLine" id="cb7-100" data-line-number="100">        <span class="bu">print</span>(<span class="st">&#39;Sorry, only margarita (key m) and creamy bacon (key c) are available&#39;</span>)</a>
<a class="sourceLine" id="cb7-101" data-line-number="101">        <span class="cf">return</span> (<span class="va">False</span>, <span class="va">None</span>)</a>
<a class="sourceLine" id="cb7-102" data-line-number="102">    <span class="cf">return</span> (<span class="va">True</span>, builder)</a>
<a class="sourceLine" id="cb7-103" data-line-number="103"></a>
<a class="sourceLine" id="cb7-104" data-line-number="104"><span class="kw">def</span> main():</a>
<a class="sourceLine" id="cb7-105" data-line-number="105">    builders <span class="op">=</span> <span class="bu">dict</span>(m<span class="op">=</span>MargaritaBuilder, c<span class="op">=</span>CreamyBaconBuilder)</a>
<a class="sourceLine" id="cb7-106" data-line-number="106">    valid_input <span class="op">=</span> <span class="va">False</span></a>
<a class="sourceLine" id="cb7-107" data-line-number="107">    <span class="cf">while</span> <span class="kw">not</span> valid_input:</a>
<a class="sourceLine" id="cb7-108" data-line-number="108">        valid_input, builder <span class="op">=</span> validate_style(builders)</a>
<a class="sourceLine" id="cb7-109" data-line-number="109">    <span class="bu">print</span>()</a>
<a class="sourceLine" id="cb7-110" data-line-number="110">    waiter <span class="op">=</span> Waiter()</a>
<a class="sourceLine" id="cb7-111" data-line-number="111">    waiter.construct_pizza(builder)</a>
<a class="sourceLine" id="cb7-112" data-line-number="112">    pizza <span class="op">=</span> waiter.pizza</a>
<a class="sourceLine" id="cb7-113" data-line-number="113">    <span class="bu">print</span>()</a>
<a class="sourceLine" id="cb7-114" data-line-number="114">    <span class="bu">print</span>(<span class="st">&#39;Enjoy your </span><span class="sc">{}</span><span class="st">!&#39;</span>.<span class="bu">format</span>(pizza))</a>
<a class="sourceLine" id="cb7-115" data-line-number="115">    </a>
<a class="sourceLine" id="cb7-116" data-line-number="116"><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</a>
<a class="sourceLine" id="cb7-117" data-line-number="117">    main()</a></code></pre></div>
<p>åœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µä¸‹ï¼Œä¸å·¥å‚æ¨¡å¼ç›¸æ¯”ï¼Œå»ºé€ è€…æ¨¡å¼æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p>
<ul>
<li>æƒ³è¦åˆ›å»ºä¸€ä¸ªå¤æ‚å¯¹è±¡ï¼ˆå¯¹è±¡ç”±å¤šä¸ªéƒ¨åˆ†æ„æˆï¼Œä¸”å¯¹è±¡çš„åˆ›å»ºè¦ç»è¿‡å¤šä¸ªä¸åŒçš„æ­¥éª¤ï¼Œè¿™äº›æ­¥éª¤ä¹Ÿè®¸è¿˜éœ€éµä»ç‰¹å®šçš„é¡ºåºï¼‰</li>
<li>è¦æ±‚ä¸€ä¸ªå¯¹è±¡èƒ½æœ‰ä¸åŒçš„è¡¨ç°ï¼Œå¹¶å¸Œæœ›å°†å¯¹è±¡çš„æ„é€ ä¸è¡¨ç°è§£è€¦</li>
<li>æƒ³è¦åœ¨æŸä¸ªæ—¶é—´ç‚¹åˆ›å»ºå¯¹è±¡ï¼Œä½†åœ¨ç¨åçš„æ—¶é—´ç‚¹å†è®¿é—®</li>
</ul>
<p>åŸå‹è®¾è®¡æ¨¡å¼å¸®åŠ©æˆ‘ä»¬åˆ›å»ºå¯¹è±¡çš„å…‹éš†ï¼Œåœ¨<code>Python</code>ä¸­ï¼Œè¿™å¯ä»¥ç”¨<code>copy.deepcopy()</code>å‡½æ•°æ¥å®Œæˆã€‚åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„å‰¯æœ¬å¯ä»¥æŒ‡ä»£ä»¥ä¸‹ä¸¤ä»¶äº‹æƒ…ã€‚</p>
<ul>
<li>å½“åˆ›å»ºä¸€ä¸ªæµ…å‰¯æœ¬æ—¶ï¼Œå‰¯æœ¬ä»¥æ¥å¼•ç”¨</li>
<li>å½“åˆ›å»ºä¸€ä¸ªæ·±å‰¯æœ¬æ—¶ï¼Œå‰¯æœ¬å¤åˆ¶æ‰€æœ‰ä¸œè¥¿</li>
</ul>
<p>åœ¨ç¬¬ä¸€ç§æƒ…å†µä¸­ï¼Œå…³æ³¨æå‡åº”ç”¨æ€§èƒ½å’Œä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œåœ¨å¯¹è±¡ä¹‹é—´å¼•å…¥æ•°æ®å…±äº«ï¼Œä½†éœ€è¦å°å¿ƒåœ°ä¿®æ”¹æ•°æ®ï¼Œå› ä¸ºæ‰€æœ‰å˜æ›´å¯¹æ‰€æœ‰å‰¯æœ¬éƒ½æ˜¯å¯è§çš„ã€‚</p>
<p>åœ¨ç¬¬äºŒç§æƒ…å†µä¸­ï¼Œå¯¹ä¸€ä¸ªå‰¯æœ¬è¿›è¡Œæ›´æ”¹è€Œä¸ä¼šå½±å“å…¶ä»–å¯¹è±¡ã€‚</p>
<p>é€‚é…å™¨æ¨¡å¼ï¼ˆ<code>Adapter pattern</code>ï¼‰æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå¸®åŠ©æˆ‘ä»¬å®ç°ä¸¤ä¸ªä¸å…¼å®¹æ¥å£ä¹‹é—´çš„å…¼å®¹ã€‚å› ä¸ºä½¿ç”¨é€‚é…å™¨æ¨¡å¼ä¸è¦æ±‚è®¿é—®ä»–æ–¹æ¥å£çš„æºä»£ç ï¼Œè€Œä¸”ä¸è¿åå¼€æ”¾ï¼å°é—­åŸåˆ™ã€‚</p>
<p>å‡è®¾æœ‰ä¸€ä¸ª<code>Computer</code>ç±»ï¼Œç”¨æ¥æ˜¾ç¤ºä¸€å°è®¡ç®—æœºçš„åŸºæœ¬ä¿¡æ¯ã€‚</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">class</span> Computer:</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name):</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">        <span class="va">self</span>.name <span class="op">=</span> name</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">    </a>
<a class="sourceLine" id="cb8-5" data-line-number="5">    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">        <span class="cf">return</span> <span class="st">&#39;the </span><span class="sc">{}</span><span class="st"> computer&#39;</span>.<span class="bu">format</span>(<span class="va">self</span>.name)</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">    </a>
<a class="sourceLine" id="cb8-8" data-line-number="8">    <span class="kw">def</span> execute()</a></code></pre></div>
<p>åœ¨<code>Synthesizer</code>å’Œ<code>Human</code>ä¸¤ä¸ªç±»ä¸­ï¼Œ<code>Synthesizer</code>ä¸»è¦åŠ¨ä½œç”±<code>play()</code>æ–¹æ³•æ‰§è¡Œã€‚<code>Human</code>ä¸»è¦åŠ¨ä½œç”±<code>speak()</code>æ–¹æ³•æ‰§è¡Œã€‚</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">class</span> Synthesizer:</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name):</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">        <span class="va">self</span>.name <span class="op">=</span> name</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">    </a>
<a class="sourceLine" id="cb9-5" data-line-number="5">    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">        <span class="cf">return</span> <span class="st">&#39;the </span><span class="sc">{}</span><span class="st"> synthesizer&#39;</span>.<span class="bu">format</span>(<span class="va">self</span>.name)</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">    </a>
<a class="sourceLine" id="cb9-8" data-line-number="8">    <span class="kw">def</span> play(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">        <span class="cf">return</span> <span class="st">&#39;is playing an electronic song&#39;</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10">    </a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="kw">class</span> Human:</a>
<a class="sourceLine" id="cb9-12" data-line-number="12">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name):</a>
<a class="sourceLine" id="cb9-13" data-line-number="13">        <span class="va">self</span>.name <span class="op">=</span> name</a>
<a class="sourceLine" id="cb9-14" data-line-number="14">        </a>
<a class="sourceLine" id="cb9-15" data-line-number="15">    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb9-16" data-line-number="16">        <span class="cf">return</span> <span class="st">&#39;</span><span class="sc">{}</span><span class="st"> the huamn&#39;</span>.<span class="bu">format</span>(<span class="va">self</span>.name)</a>
<a class="sourceLine" id="cb9-17" data-line-number="17">    </a>
<a class="sourceLine" id="cb9-18" data-line-number="18">    <span class="kw">def</span> speak(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb9-19" data-line-number="19">        <span class="cf">return</span> <span class="st">&#39;says hello&#39;</span></a>
<a class="sourceLine" id="cb9-20" data-line-number="20">    </a>
<a class="sourceLine" id="cb9-21" data-line-number="21"><span class="kw">class</span> Adapter:</a>
<a class="sourceLine" id="cb9-22" data-line-number="22">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, obj, adapted_methods):</a>
<a class="sourceLine" id="cb9-23" data-line-number="23">        <span class="va">self</span>.obj <span class="op">=</span> obj</a>
<a class="sourceLine" id="cb9-24" data-line-number="24">        <span class="va">self</span>.__dict__.update(adapted_methods)</a>
<a class="sourceLine" id="cb9-25" data-line-number="25">    </a>
<a class="sourceLine" id="cb9-26" data-line-number="26">    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb9-27" data-line-number="27">        <span class="cf">return</span> <span class="bu">str</span>(<span class="va">self</span>.obj)</a>
<a class="sourceLine" id="cb9-28" data-line-number="28">    </a>
<a class="sourceLine" id="cb9-29" data-line-number="29"><span class="kw">def</span> main():</a>
<a class="sourceLine" id="cb9-30" data-line-number="30">    objects <span class="op">=</span> [Computer(<span class="st">&#39;Asus&#39;</span>)]</a>
<a class="sourceLine" id="cb9-31" data-line-number="31">    </a>
<a class="sourceLine" id="cb9-32" data-line-number="32">    synth <span class="op">=</span> Synthesizer(<span class="st">&#39;moog&#39;</span>)</a>
<a class="sourceLine" id="cb9-33" data-line-number="33">    objects.append(Adapter(synth, <span class="bu">dict</span>(execute<span class="op">=</span>synth.play)))</a>
<a class="sourceLine" id="cb9-34" data-line-number="34">    </a>
<a class="sourceLine" id="cb9-35" data-line-number="35">    human <span class="op">=</span> Human(<span class="st">&#39;Bob&#39;</span>)</a>
<a class="sourceLine" id="cb9-36" data-line-number="36">    objects.append(Adapter(human, <span class="bu">dict</span>(execute<span class="op">=</span>huamn.speak)))</a>
<a class="sourceLine" id="cb9-37" data-line-number="37">    </a>
<a class="sourceLine" id="cb9-38" data-line-number="38">    <span class="cf">for</span> i <span class="kw">in</span> objects:</a>
<a class="sourceLine" id="cb9-39" data-line-number="39">        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{}</span><span class="st"> </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="bu">str</span>(i), i.execute))</a>
<a class="sourceLine" id="cb9-40" data-line-number="40">        </a>
<a class="sourceLine" id="cb9-41" data-line-number="41"><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</a>
<a class="sourceLine" id="cb9-42" data-line-number="42">    main()</a></code></pre></div>
<p>å…¶å®é€šè¿‡è¿™ä¸ªé€‚é…å™¨çš„è¿™ä¸€ç« èŠ‚çš„ç†è§£ï¼Œæ„Ÿè§‰é€‚é…å™¨å……å½“çš„æ˜¯ä¸€ä¸ªä¸­é—´äººæˆ–è€…è¯´ä¸€ä¸ªé“¾æ¥urlçš„ä½œç”¨ã€‚å°±åƒä¾‹å­ä¸­<code>Computer</code>çš„è¡Œä¸º<code>execute</code>ä¸€æ ·ï¼Œé€‚é…å™¨çš„ä½œç”¨å°±æ˜¯æŠŠ<code>Computer</code>çš„è¡Œä¸º<code>execute</code>å’Œ<code>Human</code>ç±»çš„<code>speak</code>è¡Œä¸ºè”ç³»èµ·æ¥ã€‚</p>
<p>ä¿®é¥°å™¨æ¨¡å¼èƒ½å¤Ÿä»¥é€æ˜çš„æ–¹å¼ï¼ˆä¸ä¼šå½±å“å…¶ä»–å¯¹è±¡ï¼‰åŠ¨æ€åœ°å°†åŠŸèƒ½æ·»åŠ åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ã€‚ä½†å’ŒPythonä¿®é¥°å™¨ä¹‹é—´å¹¶ä¸æ˜¯ä¸€å¯¹ä¸€çš„ç­‰ä»·å…³ç³»ã€‚Pythonä¿®é¥°å™¨èƒ½åšçš„å®é™…ä¸Šæ¯”ä¿®é¥°å™¨æ¨¡å¼å¤šå¾—å¤šï¼Œå…¶ä¸­å°±æ˜¯å®ç°ä¿®é¥°å™¨æ¨¡å¼ã€‚</p>
<p>ä¸‹é¢ç”¨æ–æ³¢é‚£å¥‘æ•°åˆ—ä½œä¸ºä¾‹å­ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬å¯ä»¥ç”¨é€’å½’æ–¹å¼å®ç°æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼Œä½†æ˜¯æ•ˆç‡å’Œé€Ÿåº¦éƒ½å¾ˆä½ã€‚</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">def</span> fibonacci(n):</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">    <span class="cf">assert</span>(n <span class="op">&gt;=</span> <span class="dv">0</span>). <span class="st">&#39;n must be &gt;= 0&#39;</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3">    <span class="cf">return</span> n <span class="cf">if</span> n <span class="kw">in</span> (<span class="dv">0</span>, <span class="dv">1</span>) <span class="cf">else</span> fibonacci(n<span class="dv">-1</span>) <span class="op">+</span> fibonacci(n<span class="dv">-2</span>)</a></code></pre></div>
<p>ç„¶åæˆ‘ä»¬å°è¯•é€šè¿‡ä½¿ç”¨ä¸€ä¸ª<code>dict</code>æ¥ç¼“å­˜æ–æ³¢é‚£å¥‘æ•°åˆ—ä¸­å·²ç»è®¡ç®—å¥½çš„æ•°å€¼æ¥æé«˜æ•ˆç‡ã€‚</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb11-1" data-line-number="1">known <span class="op">=</span> {<span class="dv">0</span>:<span class="dv">0</span>, <span class="dv">1</span>:<span class="dv">1</span>}</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="kw">def</span> fibonacci(n):</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">    <span class="cf">assert</span>(n <span class="op">&gt;=</span> <span class="dv">0</span>), <span class="st">&#39;n must be &gt;= 0&#39;</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5">    <span class="cf">if</span> n <span class="kw">in</span> known:</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">        <span class="cf">return</span> known[n]</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">    res <span class="op">=</span> fibonacci(n<span class="dv">-1</span>) <span class="op">+</span> fibonacci(n<span class="dv">-2</span>)</a>
<a class="sourceLine" id="cb11-8" data-line-number="8">    known[n] <span class="op">=</span> res</a>
<a class="sourceLine" id="cb11-9" data-line-number="9">    <span class="cf">return</span> res</a></code></pre></div>
<p>ä½†å¦‚æœæˆ‘ä»¬å°è¯•æ‰©å±•ä»£ç ï¼ŒåŠ å…¥æ›´å¤šçš„æ•°å­¦å‡½æ•°ï¼Œå¹¶å°†å…¶è½¬å˜ä¸ºä¸€ä¸ªæ¨¡å—ï¼Œä»£ç å°†ä¼šè¶Šæ¥è¶Šå¤æ‚ã€‚å‡è®¾å†³å®šåŠ å…¥çš„æ˜¯<code>nsum()</code>ï¼Œè¯¥å‡½æ•°è¿”å›å‰nä¸ªæ•°å­—çš„å’Œã€‚</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb12-1" data-line-number="1">known_sum <span class="op">=</span> {<span class="dv">0</span>:<span class="dv">0</span>}</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="kw">def</span> nsum(n):</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">    <span class="cf">assert</span>(n <span class="op">&gt;=</span> <span class="dv">0</span>), <span class="st">&#39;n must be &gt;= 0&#39;</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5">    <span class="cf">if</span> n <span class="kw">in</span> known_sum:</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">        <span class="cf">return</span> known_sum[n]</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">    res <span class="op">=</span> n <span class="op">+</span> nsum(n<span class="dv">-1</span>)</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">    known_sum[n] <span class="op">=</span> res</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">    <span class="cf">return</span> res</a></code></pre></div>
<p>ä½¿ç”¨ä¿®é¥°å™¨æ¨¡å¼ï¼Œèƒ½å¤Ÿå°†é€’å½’ä»£ç ä¿æŒä¸æœ´ç´ ç‰ˆæœ¬ä¸€æ ·ç®€å•ï¼Œä½†æ˜¯æ€§èƒ½ä¸Šèƒ½å¤Ÿéå¸¸é«˜æ•ˆã€‚</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="im">import</span> functools</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="kw">def</span> memoize(fn):</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">    known <span class="op">=</span> <span class="bu">dict</span>()</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">    </a>
<a class="sourceLine" id="cb13-6" data-line-number="6">    <span class="at">@functools.wraps</span>(fn)</a>
<a class="sourceLine" id="cb13-7" data-line-number="7">    <span class="kw">def</span> memoizer(<span class="op">*</span>args):</a>
<a class="sourceLine" id="cb13-8" data-line-number="8">        <span class="cf">if</span> args <span class="kw">not</span> <span class="kw">in</span> known:</a>
<a class="sourceLine" id="cb13-9" data-line-number="9">            known[args] <span class="op">=</span> fn(<span class="op">*</span>args)</a>
<a class="sourceLine" id="cb13-10" data-line-number="10">        <span class="cf">return</span> known[args]</a>
<a class="sourceLine" id="cb13-11" data-line-number="11">    </a>
<a class="sourceLine" id="cb13-12" data-line-number="12">    <span class="cf">return</span> memoizer</a></code></pre></div>
<p>é€šè¿‡åº”ç”¨<code>memoize()</code>ä¿®é¥°å™¨ï¼Œèƒ½å¤Ÿä¿æŒä»£ç çš„å¯è¯»æ€§åˆä¸å½±å“æ€§èƒ½ã€‚æ‰€ä»¥ï¼Œä¸Šè¿°çš„ä»£ç å°±å¯ä»¥è¿™æ ·å†™ã€‚</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="at">@memoize</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="kw">def</span> nsum(n):</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">    <span class="cf">assert</span>(n <span class="op">&gt;=</span> <span class="dv">0</span>), <span class="st">&#39;n must be &gt;= 0&#39;</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4">    <span class="cf">return</span> <span class="dv">0</span> <span class="cf">if</span> n <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> n <span class="op">+</span> nsum(n<span class="dv">-1</span>)</a>
<a class="sourceLine" id="cb14-5" data-line-number="5"></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="at">@memoize</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="kw">def</span> fibonacci(n):</a>
<a class="sourceLine" id="cb14-8" data-line-number="8">    <span class="cf">assert</span>(n <span class="op">&gt;=</span> <span class="dv">0</span>), <span class="st">&#39;n must be &gt;= 0&#39;</span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9">    <span class="cf">return</span> n <span class="cf">if</span> n <span class="kw">in</span> (<span class="dv">0</span>, <span class="dv">1</span>) <span class="cf">else</span> fibonacci(n<span class="dv">-1</span>) <span class="op">+</span> fibonacci(n<span class="dv">-2</span>)</a></code></pre></div>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/pandas.jpeg"
               alt="Peter Tsung" />
          <p class="site-author-name" itemprop="name">Peter Tsung</p>
           
              <p class="site-description motion-element" itemprop="description">I Never Save Anything For The Swim Back.</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">35</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Peter Tsung</span>
</div>

<!--
<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>
<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  æœ¬ç«™è®¿å®¢æ•°:<span id="busuanzi_value_site_uv"></span>
</span>
</div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"], linebreaks: { automatic:true }, EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) },
            tex2jax: { inlineMath: [ ["$", "$"], ["\\(","\\)"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno",skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']},
                    TeX: {  noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } }, Macros: { href: "{}" } },
                            messageStyle: "none"
                                }); 
    </script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Queue(function() {
                    var all = MathJax.Hub.getAllJax(), i;
                            for(i=0; i < all.length; i += 1) {
                                            all[i].SourceElement().parentNode.className += ' has-jax';
                                                    }
                                                        });
        </script>
        <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

-->


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  


<!--   <script src="/js/src/prettify.js" type="text/javascript"></script>
  <script type="text/javascript">
    $(window).load(function(){
    $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
     prettyPrint();
    })
  </script> -->
  <script type="text/javascript" src="/js/src/love.js"></script>
</body>
</html>
